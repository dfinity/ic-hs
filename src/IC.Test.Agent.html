<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- |

This module contains function to interact with an Internet Computer instance.

The primary customer here is IC.Test.Spec, i.e the test suite. Therefore, the
functions here give access to varoius levels of abstractions, and gives more control
than a &#8220;normal&#8221; agent library would do.

Also, because of the focus on testing, failures are repoted directly with HUnit&#8217;s 'assertFailure'.

As guidance: This modules does _not_ rely on the universal canister.

-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE ImplicitParams #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-21"></span><span class="hs-pragma">{-# LANGUAGE BlockArguments #-}</span><span>
</span><span id="line-22"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-23"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-24"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-25"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-26"></span><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-27"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-28"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-29"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">IC.Test.Agent</span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-31"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier">HTTPErrOr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier">HasAgentConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#IC00"><span class="hs-identifier">IC00</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#IC00WithCycles"><span class="hs-identifier">IC00WithCycles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#IC00%27"><span class="hs-identifier">IC00'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier">ReqResponse</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier">ReqStatus</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#AgentConfig"><span class="hs-identifier">AgentConfig</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#DelegationCanisterRangeCheck"><span class="hs-identifier">DelegationCanisterRangeCheck</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#addExpiry"><span class="hs-identifier">addExpiry</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#addNonce"><span class="hs-identifier">addNonce</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#addNonceExpiryEnv"><span class="hs-identifier">addNonceExpiryEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#anonymousUser"><span class="hs-identifier">anonymousUser</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#as2Word64"><span class="hs-identifier">as2Word64</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#asWord64Word128"><span class="hs-identifier">asWord64Word128</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#asHex"><span class="hs-identifier">asHex</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#asRight"><span class="hs-identifier">asRight</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#asWord128"><span class="hs-identifier">asWord128</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#asWord32"><span class="hs-identifier">asWord32</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#asWord64"><span class="hs-identifier">asWord64</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#awaitCall%27"><span class="hs-identifier">awaitCall'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#awaitCall"><span class="hs-identifier">awaitCall</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#awaitKnown"><span class="hs-identifier">awaitKnown</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#awaitStatus"><span class="hs-identifier">awaitStatus</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#bothSame"><span class="hs-identifier">bothSame</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#callResponse"><span class="hs-identifier">callResponse</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#certValue"><span class="hs-identifier">certValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#certValueAbsent"><span class="hs-identifier">certValueAbsent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#code202"><span class="hs-identifier">code202</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#code202_or_4xx"><span class="hs-identifier">code202_or_4xx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#code2xx"><span class="hs-identifier">code2xx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#code4xx"><span class="hs-identifier">code4xx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#decodeCert%27"><span class="hs-identifier">decodeCert'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#defaultSK"><span class="hs-identifier">defaultSK</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#defaultUser"><span class="hs-identifier">defaultUser</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#delegationEnv"><span class="hs-identifier">delegationEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#doesn%27tExist"><span class="hs-identifier">doesn'tExist</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#ecdsaSK"><span class="hs-identifier">ecdsaSK</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#ecdsaUser"><span class="hs-identifier">ecdsaUser</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#enum"><span class="hs-identifier">enum</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#envelope"><span class="hs-identifier">envelope</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#envelopeFor"><span class="hs-identifier">envelopeFor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#extractCertData"><span class="hs-identifier">extractCertData</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#getRequestStatus%27"><span class="hs-identifier">getRequestStatus'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#getRequestStatus"><span class="hs-identifier">getRequestStatus</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#getStateCert%27"><span class="hs-identifier">getStateCert'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#getStateCert"><span class="hs-identifier">getStateCert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#ic00"><span class="hs-identifier">ic00</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#ic00as"><span class="hs-identifier">ic00as</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#ic00%27"><span class="hs-identifier">ic00'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#ic00WithSubnetas%27"><span class="hs-identifier">ic00WithSubnetas'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#ingressDelay"><span class="hs-identifier">ingressDelay</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#is2xx"><span class="hs-identifier">is2xx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#isErr4xx"><span class="hs-identifier">isErr4xx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#isErrOrReject"><span class="hs-identifier">isErrOrReject</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#isNoErrReject"><span class="hs-identifier">isNoErrReject</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#isPendingOrProcessing"><span class="hs-identifier">isPendingOrProcessing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#isReject"><span class="hs-identifier">isReject</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#isReply"><span class="hs-identifier">isReply</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#isResponded"><span class="hs-identifier">isResponded</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#okCBOR"><span class="hs-identifier">okCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#otherSK"><span class="hs-identifier">otherSK</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#otherUser"><span class="hs-identifier">otherUser</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#makeAgentConfig"><span class="hs-identifier">makeAgentConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#postCBOR"><span class="hs-identifier">postCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#postCallCBOR"><span class="hs-identifier">postCallCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#postQueryCBOR"><span class="hs-identifier">postQueryCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#postReadStateCBOR"><span class="hs-identifier">postReadStateCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#preFlight"><span class="hs-identifier">preFlight</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#queryCBOR"><span class="hs-identifier">queryCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#queryResponse"><span class="hs-identifier">queryResponse</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#runGet"><span class="hs-identifier">runGet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#secp256k1SK"><span class="hs-identifier">secp256k1SK</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#secp256k1User"><span class="hs-identifier">secp256k1User</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#senderOf"><span class="hs-identifier">senderOf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#shorten"><span class="hs-identifier">shorten</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#submitCall"><span class="hs-identifier">submitCall</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#textual"><span class="hs-identifier">textual</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#validateStateCert"><span class="hs-identifier">validateStateCert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#verifySignature"><span class="hs-identifier">verifySignature</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#waitFor"><span class="hs-identifier">waitFor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#webAuthnECDSASK"><span class="hs-identifier">webAuthnECDSASK</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#webAuthnECDSAUser"><span class="hs-identifier">webAuthnECDSAUser</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#webAuthnRSASK"><span class="hs-identifier">webAuthnRSASK</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#webAuthnRSAUser"><span class="hs-identifier">webAuthnRSAUser</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#withAgentConfig"><span class="hs-identifier">withAgentConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-comment">-- TODO: these are needed by IC.Test.Agent.Calls. Consider moving them to an Internal module</span><span>
</span><span id="line-119"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#callIC"><span class="hs-identifier">callIC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#callIC%27"><span class="hs-identifier">callIC'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#callIC%27%27"><span class="hs-identifier">callIC''</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#callICWithSubnet%27%27"><span class="hs-identifier">callICWithSubnet''</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#callIC%27%27%27"><span class="hs-identifier">callIC'''</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>      </span><span class="annot"><a href="IC.Test.Agent.html#agentConfig"><span class="hs-identifier">agentConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Encoding.html"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Encoding.Error.html"><span class="hs-identifier">Data.Text.Encoding.Error</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/i7ini5k617kyy6apg2mvp4sspvaaqgb7-hex-text-0.1.0.8-doc/share/doc/hex-text-0.1.0.8/html/src/Text.Hex.html"><span class="hs-identifier">Text.Hex</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">H</span></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.html"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Builder.html"><span class="hs-identifier">Data.ByteString.Builder</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/w7y9k4kyfnpkadl1rd8vfgw68z3s3x71-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashMap.Lazy.html"><span class="hs-identifier">Data.HashMap.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/hhnlannilpqy2882lxracq3vn1pz3l0d-x509-store-1.6.9-doc/share/doc/x509-store-1.6.9/html/src/Data.X509.CertificateStore.html"><span class="hs-identifier">Data.X509.CertificateStore</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/24dz98m0ib3qk4dkkssn443452rf7i1s-x509-validation-1.6.12-doc/share/doc/x509-validation-1.6.12/html/src/Data.X509.Validation.html"><span class="hs-identifier">Data.X509.Validation</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/h3w6d4zyy4d0jbn0qfms72mnaxfg4im8-connection-0.3.1-doc/share/doc/connection-0.3.1/html/src/Network.Connection.html"><span class="hs-identifier">Network.Connection</span></a></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/3l67cr8rd2adag77ig30x4pwwyvg2ds4-tls-1.5.8-doc/share/doc/tls-1.5.8/html/src/Network.TLS.html"><span class="hs-identifier">Network.TLS</span></a></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/3l67cr8rd2adag77ig30x4pwwyvg2ds4-tls-1.5.8-doc/share/doc/tls-1.5.8/html/src/Network.TLS.Extra.Cipher.html"><span class="hs-identifier">Network.TLS.Extra.Cipher</span></a></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.html"><span class="hs-identifier">Network.HTTP.Client</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/pamypgvh0gqzbhhcrny0p475asi1iwl3-http-client-tls-0.3.6.1-doc/share/doc/http-client-tls-0.3.6.1/html/src/Network.HTTP.Client.TLS.html"><span class="hs-identifier">Network.HTTP.Client.TLS</span></a></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/lwjn4w0ddfm34a87vly061bh3il1hk19-http-types-0.12.3-doc/share/doc/http-types-0.12.3/html/src/Network.HTTP.Types.html"><span class="hs-identifier">Network.HTTP.Types</span></a></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Numeric.Natural.html"><span class="hs-identifier">Numeric.Natural</span></a></span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Char.html"><span class="hs-identifier">Data.Char</span></a></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.html"><span class="hs-identifier">Test.Tasty.HUnit</span></a></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/5nl5lyfznc78f5v4byqwsc8cnidi0h64-tasty-1.4.3-doc/share/doc/tasty-1.4.3/html/src/Test.Tasty.Options.html"><span class="hs-identifier">Test.Tasty.Options</span></a></span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Except.html"><span class="hs-identifier">Control.Monad.Except</span></a></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Control.Concurrent.html"><span class="hs-identifier">Control.Concurrent</span></a></span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.IO.html#catch"><span class="hs-identifier">catch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Exception.html#throw"><span class="hs-identifier">throw</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier">Exception</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/4h8inihfwkd8f5prpvls0py5693qswhb-data-default-class-0.1.2.0-doc/share/doc/data-default-class-0.1.2.0/html/src/Data.Default.Class.html"><span class="hs-identifier">Data.Default.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/4h8inihfwkd8f5prpvls0py5693qswhb-data-default-class-0.1.2.0-doc/share/doc/data-default-class-0.1.2.0/html/src/Data.Default.Class.html#def"><span class="hs-identifier">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.OldList.html#nub"><span class="hs-identifier">nub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Traversable.html"><span class="hs-identifier">Data.Traversable</span></a></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/4mqfmg1nf403ql59iwhdjfrnszspljb5-wide-word-0.1.5.0-doc/share/doc/wide-word-0.1.5.0/html/src/Data.WideWord.Word128.html"><span class="hs-identifier">Data.WideWord.Word128</span></a></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.TypeLits.html"><span class="hs-identifier">GHC.TypeLits</span></a></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/kwjhvjzd9a4fh4sc1pajfx8br8bc58k5-random-1.2.1.1-doc/share/doc/random-1.2.1.1/html/src/System.Random.html"><span class="hs-identifier">System.Random</span></a></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/System.Exit.html"><span class="hs-identifier">System.Exit</span></a></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/time-1.11.1.1/src/Data.Time.Clock.html"><span class="hs-identifier">Data.Time.Clock</span></a></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/time-1.11.1.1/src/Data.Time.Clock.POSIX.html"><span class="hs-identifier">Data.Time.Clock.POSIX</span></a></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.html"><span class="hs-identifier">Codec.Candid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Data.html#Principal"><span class="hs-identifier">Principal</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Data.html#prettyPrincipal"><span class="hs-identifier">prettyPrincipal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.html"><span class="hs-identifier">Data.Binary</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Get</span></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.html"><span class="hs-identifier">Data.Binary.Get</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Get</span></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.html"><span class="hs-identifier">Codec.Candid</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Candid</span></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.html"><span class="hs-identifier">Data.Row</span></a></span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Variants.html"><span class="hs-identifier">Data.Row.Variants</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/rhiqcd24sdmvg84cxzww8z37wc9fw3bl-haskoin-core-0.21.2-doc/share/doc/haskoin-core-0.21.2/html/src/Haskoin.Crypto.Signature.html"><span class="hs-identifier">Haskoin.Crypto.Signature</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/rhiqcd24sdmvg84cxzww8z37wc9fw3bl-haskoin-core-0.21.2-doc/share/doc/haskoin-core-0.21.2/html/src/Haskoin.html"><span class="hs-identifier">Haskoin</span></a></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/rhiqcd24sdmvg84cxzww8z37wc9fw3bl-haskoin-core-0.21.2-doc/share/doc/haskoin-core-0.21.2/html/src/Haskoin.Crypto.Hash.html"><span class="hs-identifier">Haskoin.Crypto.Hash</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/rhiqcd24sdmvg84cxzww8z37wc9fw3bl-haskoin-core-0.21.2-doc/share/doc/haskoin-core-0.21.2/html/src/Haskoin.html"><span class="hs-identifier">Haskoin</span></a></span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/rhiqcd24sdmvg84cxzww8z37wc9fw3bl-haskoin-core-0.21.2-doc/share/doc/haskoin-core-0.21.2/html/src/Haskoin.Keys.Common.html"><span class="hs-identifier">Haskoin.Keys.Common</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/rhiqcd24sdmvg84cxzww8z37wc9fw3bl-haskoin-core-0.21.2-doc/share/doc/haskoin-core-0.21.2/html/src/Haskoin.html"><span class="hs-identifier">Haskoin</span></a></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/System.Timeout.html"><span class="hs-identifier">System.Timeout</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Version.html"><span class="hs-identifier">IC.Version</span></a></span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html"><span class="hs-identifier">IC.HTTP.GenR</span></a></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.Parse.html"><span class="hs-identifier">IC.HTTP.GenR.Parse</span></a></span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.HTTP.CBOR.html"><span class="hs-identifier">IC.HTTP.CBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.HTTP.CBOR.html#decode"><span class="hs-identifier">decode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.HTTP.CBOR.html#encode"><span class="hs-identifier">encode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.HTTP.RequestId.html"><span class="hs-identifier">IC.HTTP.RequestId</span></a></span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Management.html"><span class="hs-identifier">IC.Management</span></a></span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Crypto.html"><span class="hs-identifier">IC.Crypto</span></a></span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="IC.Crypto.DER.html"><span class="hs-identifier">IC.Crypto.DER</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DER</span></span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="IC.Crypto.DER_BLS.html"><span class="hs-identifier">IC.Crypto.DER_BLS</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DER_BLS</span></span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Id.Forms.html"><span class="hs-identifier">IC.Id.Forms</span></a></span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Id.Fresh.html"><span class="hs-identifier">IC.Id.Fresh</span></a></span><span>
</span><span id="line-184"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Test.Options.html"><span class="hs-identifier">IC.Test.Options</span></a></span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.HashTree.html"><span class="hs-identifier">IC.HashTree</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.HashTree.html#Blob"><span class="hs-identifier">Blob</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.HashTree.html#Label"><span class="hs-identifier">Label</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Certificate.html"><span class="hs-identifier">IC.Certificate</span></a></span><span>
</span><span id="line-187"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Certificate.Value.html"><span class="hs-identifier">IC.Certificate.Value</span></a></span><span>
</span><span id="line-188"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Certificate.CBOR.html"><span class="hs-identifier">IC.Certificate.CBOR</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-comment">-- * Exceptions</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-keyword">data</span><span> </span><span id="DelegationCanisterRangeCheck"><span class="annot"><a href="IC.Test.Agent.html#DelegationCanisterRangeCheck"><span class="hs-identifier hs-var">DelegationCanisterRangeCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DelegationCanisterRangeCheck"><span class="annot"><a href="IC.Test.Agent.html#DelegationCanisterRangeCheck"><span class="hs-identifier hs-var">DelegationCanisterRangeCheck</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679410764"><span id="local-6989586621679410766"><span id="local-6989586621679410773"><span class="annot"><span class="annottext">Int -&gt; DelegationCanisterRangeCheck -&gt; ShowS
[DelegationCanisterRangeCheck] -&gt; ShowS
DelegationCanisterRangeCheck -&gt; [Char]
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [DelegationCanisterRangeCheck] -&gt; ShowS
$cshowList :: [DelegationCanisterRangeCheck] -&gt; ShowS
show :: DelegationCanisterRangeCheck -&gt; [Char]
$cshow :: DelegationCanisterRangeCheck -&gt; [Char]
showsPrec :: Int -&gt; DelegationCanisterRangeCheck -&gt; ShowS
$cshowsPrec :: Int -&gt; DelegationCanisterRangeCheck -&gt; ShowS
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410752"><span id="local-6989586621679410754"><span id="local-6989586621679410756"><span class="annot"><span class="annottext">Show DelegationCanisterRangeCheck
Typeable DelegationCanisterRangeCheck
SomeException -&gt; Maybe DelegationCanisterRangeCheck
DelegationCanisterRangeCheck -&gt; [Char]
DelegationCanisterRangeCheck -&gt; SomeException
forall e.
Typeable e
-&gt; Show e
-&gt; (e -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe e)
-&gt; (e -&gt; [Char])
-&gt; Exception e
displayException :: DelegationCanisterRangeCheck -&gt; [Char]
$cdisplayException :: DelegationCanisterRangeCheck -&gt; [Char]
fromException :: SomeException -&gt; Maybe DelegationCanisterRangeCheck
$cfromException :: SomeException -&gt; Maybe DelegationCanisterRangeCheck
toException :: DelegationCanisterRangeCheck -&gt; SomeException
$ctoException :: DelegationCanisterRangeCheck -&gt; SomeException
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Exception.Type.html#C%3AException"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Exception</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-comment">-- * CBOR decoding</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><a href="IC.Test.Agent.html#asCBORBlobPairList"><span class="hs-identifier hs-type">asCBORBlobPairList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-198"></span><span id="asCBORBlobPairList"><span class="annot"><span class="annottext">asCBORBlobPairList :: Blob -&gt; IO [(Blob, Blob)]
</span><a href="IC.Test.Agent.html#asCBORBlobPairList"><span class="hs-identifier hs-var hs-var">asCBORBlobPairList</span></a></span></span><span> </span><span id="local-6989586621679410749"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410749"><span class="hs-identifier hs-var">blob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621679410748"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410748"><span class="hs-identifier hs-var">decoded</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Either Text a -&gt; IO a
</span><a href="IC.Test.Agent.html#asRight"><span class="hs-identifier hs-var">asRight</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Either Text GenR
</span><a href="IC.HTTP.CBOR.html#decode"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410749"><span class="hs-identifier hs-var">blob</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410748"><span class="hs-identifier hs-var">decoded</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><a href="IC.HTTP.GenR.html#GList"><span class="hs-identifier hs-type">GList</span></a></span><span> </span><span id="local-6989586621679410746"><span class="annot"><span class="annottext">[GenR]
</span><a href="#local-6989586621679410746"><span class="hs-identifier hs-var">list</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">GenR -&gt; IO (Blob, Blob)
</span><a href="IC.Test.Agent.html#cborToBlobPair"><span class="hs-identifier hs-var">cborToBlobPair</span></a></span><span> </span><span class="annot"><span class="annottext">[GenR]
</span><a href="#local-6989586621679410746"><span class="hs-identifier hs-var">list</span></a></span><span>
</span><span id="line-203"></span><span>        </span><span class="annot"><span class="annottext">GenR
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Failed to decode as CBOR encoded list of blob pairs: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410748"><span class="hs-identifier hs-var">decoded</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><a href="IC.Test.Agent.html#cborToBlobPair"><span class="hs-identifier hs-type">cborToBlobPair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span id="cborToBlobPair"><span class="annot"><span class="annottext">cborToBlobPair :: GenR -&gt; IO (Blob, Blob)
</span><a href="IC.Test.Agent.html#cborToBlobPair"><span class="hs-identifier hs-var hs-var">cborToBlobPair</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.HTTP.GenR.html#GList"><span class="hs-identifier hs-type">GList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-type">GBlob</span></a></span><span> </span><span id="local-6989586621679410740"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410740"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-type">GBlob</span></a></span><span> </span><span id="local-6989586621679410739"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410739"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410740"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410739"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span class="annot"><a href="IC.Test.Agent.html#cborToBlobPair"><span class="hs-identifier hs-var">cborToBlobPair</span></a></span><span> </span><span id="local-6989586621679410738"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410738"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected list of pairs, got: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410738"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- * Agent configuration</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-keyword">data</span><span> </span><span id="AgentSubnetConfig"><span class="annot"><a href="IC.Test.Agent.html#AgentSubnetConfig"><span class="hs-identifier hs-var">AgentSubnetConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AgentSubnetConfig"><span class="annot"><a href="IC.Test.Agent.html#AgentSubnetConfig"><span class="hs-identifier hs-var">AgentSubnetConfig</span></a></span></span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="tc_node_addresses"><span class="annot"><span class="annottext">AgentSubnetConfig -&gt; [[Char]]
</span><a href="IC.Test.Agent.html#tc_node_addresses"><span class="hs-identifier hs-var hs-var">tc_node_addresses</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tc_canister_ranges"><span class="annot"><span class="annottext">AgentSubnetConfig -&gt; [(Word64, Word64)]
</span><a href="IC.Test.Agent.html#tc_canister_ranges"><span class="hs-identifier hs-var hs-var">tc_canister_ranges</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">W.Word64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">W.Word64</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-keyword">data</span><span> </span><span id="AgentConfig"><span class="annot"><a href="IC.Test.Agent.html#AgentConfig"><span class="hs-identifier hs-var">AgentConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AgentConfig"><span class="annot"><a href="IC.Test.Agent.html#AgentConfig"><span class="hs-identifier hs-var">AgentConfig</span></a></span></span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="tc_root_key"><span class="annot"><span class="annottext">AgentConfig -&gt; Blob
</span><a href="IC.Test.Agent.html#tc_root_key"><span class="hs-identifier hs-var hs-var">tc_root_key</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tc_manager"><span class="annot"><span class="annottext">AgentConfig -&gt; Manager
</span><a href="IC.Test.Agent.html#tc_manager"><span class="hs-identifier hs-var hs-var">tc_manager</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tc_endPoint"><span class="annot"><span class="annottext">AgentConfig -&gt; [Char]
</span><a href="IC.Test.Agent.html#tc_endPoint"><span class="hs-identifier hs-var hs-var">tc_endPoint</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tc_subnets"><span class="annot"><span class="annottext">AgentConfig -&gt; [AgentSubnetConfig]
</span><a href="IC.Test.Agent.html#tc_subnets"><span class="hs-identifier hs-var hs-var">tc_subnets</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IC.Test.Agent.html#AgentSubnetConfig"><span class="hs-identifier hs-type">AgentSubnetConfig</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tc_httpbin"><span class="annot"><span class="annottext">AgentConfig -&gt; [Char]
</span><a href="IC.Test.Agent.html#tc_httpbin"><span class="hs-identifier hs-var hs-var">tc_httpbin</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tc_timeout"><span class="annot"><span class="annottext">AgentConfig -&gt; Int
</span><a href="IC.Test.Agent.html#tc_timeout"><span class="hs-identifier hs-var hs-var">tc_timeout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><a href="IC.Test.Agent.html#makeAgentConfig"><span class="hs-identifier hs-type">makeAgentConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IC.Test.Agent.html#AgentSubnetConfig"><span class="hs-identifier hs-type">AgentSubnetConfig</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#AgentConfig"><span class="hs-identifier hs-type">AgentConfig</span></a></span><span>
</span><span id="line-226"></span><span id="makeAgentConfig"><span class="annot"><span class="annottext">makeAgentConfig :: Bool
-&gt; [Char] -&gt; [AgentSubnetConfig] -&gt; [Char] -&gt; Int -&gt; IO AgentConfig
</span><a href="IC.Test.Agent.html#makeAgentConfig"><span class="hs-identifier hs-var hs-var">makeAgentConfig</span></a></span></span><span> </span><span id="local-6989586621679410727"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679410727"><span class="hs-identifier hs-var">allow_self_signed_certs</span></a></span></span><span> </span><span id="local-6989586621679410726"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410726"><span class="hs-identifier hs-var">ep'</span></a></span></span><span> </span><span id="local-6989586621679410725"><span class="annot"><span class="annottext">[AgentSubnetConfig]
</span><a href="#local-6989586621679410725"><span class="hs-identifier hs-var">subnets</span></a></span></span><span> </span><span id="local-6989586621679410724"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410724"><span class="hs-identifier hs-var">httpbin'</span></a></span></span><span> </span><span id="local-6989586621679410723"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679410723"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410722"><span class="annot"><span class="annottext">validate :: CertificateStore
-&gt; ValidationCache
-&gt; ServiceID
-&gt; CertificateChain
-&gt; IO [FailedReason]
</span><a href="#local-6989586621679410722"><span class="hs-identifier hs-var hs-var">validate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679410721"><span class="annot"><span class="annottext">CertificateStore
</span><a href="#local-6989586621679410721"><span class="hs-identifier hs-var">ca_store</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679410727"><span class="hs-identifier hs-var">allow_self_signed_certs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ValidationCache
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ServiceID
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CertificateChain
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CertificateStore
-&gt; ValidationCache
-&gt; ServiceID
-&gt; CertificateChain
-&gt; IO [FailedReason]
</span><a href="file:///nix/store/24dz98m0ib3qk4dkkssn443452rf7i1s-x509-validation-1.6.12-doc/share/doc/x509-validation-1.6.12/html/src/Data.X509.Validation.html#validateDefault"><span class="hs-identifier hs-var">C.validateDefault</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SignedCertificate] -&gt; CertificateStore
</span><a href="file:///nix/store/hhnlannilpqy2882lxracq3vn1pz3l0d-x509-store-1.6.9-doc/share/doc/x509-store-1.6.9/html/src/Data.X509.CertificateStore.html#makeCertificateStore"><span class="hs-identifier hs-var">C.makeCertificateStore</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CertificateStore -&gt; [SignedCertificate]
</span><a href="file:///nix/store/hhnlannilpqy2882lxracq3vn1pz3l0d-x509-store-1.6.9-doc/share/doc/x509-store-1.6.9/html/src/Data.X509.CertificateStore.html#listCertificates"><span class="hs-identifier hs-var">C.listCertificates</span></a></span><span> </span><span class="annot"><span class="annottext">CertificateStore
</span><a href="#local-6989586621679410721"><span class="hs-identifier hs-var">ca_store</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410717"><span class="annot"><span class="annottext">client_params :: ClientParams
</span><a href="#local-6989586621679410717"><span class="hs-identifier hs-var hs-var">client_params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; ByteString -&gt; ClientParams
</span><a href="file:///nix/store/3l67cr8rd2adag77ig30x4pwwyvg2ds4-tls-1.5.8-doc/share/doc/tls-1.5.8/html/src/Network.TLS.Parameters.html#defaultParamsClient"><span class="hs-identifier hs-var">defaultParamsClient</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Internal.Type.html#empty"><span class="hs-identifier hs-var">B.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-229"></span><span>          </span><span class="annot"><span class="annottext">clientHooks :: ClientHooks
</span><a href="file:///nix/store/3l67cr8rd2adag77ig30x4pwwyvg2ds4-tls-1.5.8-doc/share/doc/tls-1.5.8/html/src/Network.TLS.Parameters.html#clientHooks"><span class="hs-identifier hs-var">clientHooks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Default a =&gt; a
</span><a href="file:///nix/store/4h8inihfwkd8f5prpvls0py5693qswhb-data-default-class-0.1.2.0-doc/share/doc/data-default-class-0.1.2.0/html/src/Data.Default.Class.html#def"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">onServerCertificate :: CertificateStore
-&gt; ValidationCache
-&gt; ServiceID
-&gt; CertificateChain
-&gt; IO [FailedReason]
</span><a href="file:///nix/store/3l67cr8rd2adag77ig30x4pwwyvg2ds4-tls-1.5.8-doc/share/doc/tls-1.5.8/html/src/Network.TLS.Parameters.html#onServerCertificate"><span class="hs-identifier hs-var">onServerCertificate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertificateStore
-&gt; ValidationCache
-&gt; ServiceID
-&gt; CertificateChain
-&gt; IO [FailedReason]
</span><a href="#local-6989586621679410722"><span class="hs-identifier hs-var">validate</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-230"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clientSupported :: Supported
</span><a href="file:///nix/store/3l67cr8rd2adag77ig30x4pwwyvg2ds4-tls-1.5.8-doc/share/doc/tls-1.5.8/html/src/Network.TLS.Parameters.html#clientSupported"><span class="hs-identifier hs-var">clientSupported</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Default a =&gt; a
</span><a href="file:///nix/store/4h8inihfwkd8f5prpvls0py5693qswhb-data-default-class-0.1.2.0-doc/share/doc/data-default-class-0.1.2.0/html/src/Data.Default.Class.html#def"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">supportedCiphers :: [Cipher]
</span><a href="file:///nix/store/3l67cr8rd2adag77ig30x4pwwyvg2ds4-tls-1.5.8-doc/share/doc/tls-1.5.8/html/src/Network.TLS.Parameters.html#supportedCiphers"><span class="hs-identifier hs-var">supportedCiphers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Cipher]
</span><a href="file:///nix/store/3l67cr8rd2adag77ig30x4pwwyvg2ds4-tls-1.5.8-doc/share/doc/tls-1.5.8/html/src/Network.TLS.Extra.Cipher.html#ciphersuite_default"><span class="hs-identifier hs-var">ciphersuite_default</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410709"><span class="annot"><span class="annottext">manager_settings :: ManagerSettings
</span><a href="#local-6989586621679410709"><span class="hs-identifier hs-var hs-var">manager_settings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings -&gt; Maybe SockSettings -&gt; ManagerSettings
</span><a href="file:///nix/store/pamypgvh0gqzbhhcrny0p475asi1iwl3-http-client-tls-0.3.6.1-doc/share/doc/http-client-tls-0.3.6.1/html/src/Network.HTTP.Client.TLS.html#mkManagerSettings"><span class="hs-identifier hs-var">mkManagerSettings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientParams -&gt; TLSSettings
</span><a href="file:///nix/store/h3w6d4zyy4d0jbn0qfms72mnaxfg4im8-connection-0.3.1-doc/share/doc/connection-0.3.1/html/src/Network.Connection.Types.html#TLSSettings"><span class="hs-identifier hs-var">TLSSettings</span></a></span><span> </span><span class="annot"><span class="annottext">ClientParams
</span><a href="#local-6989586621679410717"><span class="hs-identifier hs-var">client_params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621679410706"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679410706"><span class="hs-identifier hs-var">manager</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadIO m =&gt; ManagerSettings -&gt; m Manager
</span><a href="file:///nix/store/pamypgvh0gqzbhhcrny0p475asi1iwl3-http-client-tls-0.3.6.1-doc/share/doc/http-client-tls-0.3.6.1/html/src/Network.HTTP.Client.TLS.html#newTlsManagerWith"><span class="hs-identifier hs-var">newTlsManagerWith</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ManagerSettings
</span><a href="#local-6989586621679410709"><span class="hs-identifier hs-var">manager_settings</span></a></span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">managerResponseTimeout :: ResponseTimeout
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#managerResponseTimeout"><span class="hs-identifier hs-var">managerResponseTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ResponseTimeout
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.html#responseTimeoutMicro"><span class="hs-identifier hs-var">responseTimeoutMicro</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">300_000_000</span></span><span> </span><span class="hs-comment">-- 300s</span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621679410702"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679410702"><span class="hs-identifier hs-var">request</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadThrow m =&gt; [Char] -&gt; m Request
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Request.html#parseRequest"><span class="hs-identifier hs-var">parseRequest</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410700"><span class="hs-identifier hs-var">ep</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;/api/v2/status&quot;</span></span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/System.IO.html#putStrLn"><span class="hs-identifier hs-var">putStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Fetching endpoint status from &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410700"><span class="hs-identifier hs-var">ep</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;...&quot;</span></span><span>
</span><span id="line-238"></span><span>    </span><span id="local-6989586621679410698"><span class="annot"><span class="annottext">StatusResponse
</span><a href="#local-6989586621679410698"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; Manager -&gt; IO (Response Blob)
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Core.html#httpLbs"><span class="hs-identifier hs-var">httpLbs</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679410702"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679410706"><span class="hs-identifier hs-var">manager</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Response Blob -&gt; IO GenR
</span><a href="IC.Test.Agent.html#okCBOR"><span class="hs-identifier hs-var">okCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; GenR -&gt; IO StatusResponse
</span><a href="IC.Test.Agent.html#statusResonse"><span class="hs-identifier hs-var">statusResonse</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.IO.html#catch"><span class="hs-operator hs-var">`catch`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#HUnitFailure"><span class="hs-identifier hs-type">HUnitFailure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679410694"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410694"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/System.IO.html#putStrLn"><span class="hs-identifier hs-var">putStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410694"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IO a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/System.Exit.html#exitFailure"><span class="hs-identifier hs-var">exitFailure</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/System.IO.html#putStrLn"><span class="hs-identifier hs-var">putStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Spec version tested:  &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="IC.Version.html#specVersion"><span class="hs-identifier hs-var">specVersion</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/System.IO.html#putStrLn"><span class="hs-identifier hs-var">putStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Spec version claimed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatusResponse -&gt; Text
</span><a href="IC.Test.Agent.html#status_api_version"><span class="hs-identifier hs-var">status_api_version</span></a></span><span> </span><span class="annot"><span class="annottext">StatusResponse
</span><a href="#local-6989586621679410698"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#AgentConfig"><span class="hs-identifier hs-type">AgentConfig</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tc_root_key :: Blob
</span><a href="IC.Test.Agent.html#tc_root_key"><span class="hs-identifier hs-var">tc_root_key</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusResponse -&gt; Blob
</span><a href="IC.Test.Agent.html#status_root_key"><span class="hs-identifier hs-var">status_root_key</span></a></span><span> </span><span class="annot"><span class="annottext">StatusResponse
</span><a href="#local-6989586621679410698"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tc_manager :: Manager
</span><a href="IC.Test.Agent.html#tc_manager"><span class="hs-identifier hs-var">tc_manager</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679410706"><span class="hs-identifier hs-var">manager</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tc_endPoint :: [Char]
</span><a href="IC.Test.Agent.html#tc_endPoint"><span class="hs-identifier hs-var">tc_endPoint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410700"><span class="hs-identifier hs-var">ep</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tc_subnets :: [AgentSubnetConfig]
</span><a href="IC.Test.Agent.html#tc_subnets"><span class="hs-identifier hs-var">tc_subnets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AgentSubnetConfig]
</span><a href="#local-6989586621679410725"><span class="hs-identifier hs-var">subnets</span></a></span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tc_httpbin :: [Char]
</span><a href="IC.Test.Agent.html#tc_httpbin"><span class="hs-identifier hs-var">tc_httpbin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410688"><span class="hs-identifier hs-var">httpbin</span></a></span><span>
</span><span id="line-250"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tc_timeout :: Int
</span><a href="IC.Test.Agent.html#tc_timeout"><span class="hs-identifier hs-var">tc_timeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679410723"><span class="hs-identifier hs-var">to</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-comment">-- strip trailing slash</span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621679410700"><span class="annot"><span class="annottext">ep :: [Char]
</span><a href="#local-6989586621679410700"><span class="hs-identifier hs-var hs-var">ep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
</span><a href="IC.Test.Agent.html#fixUrl"><span class="hs-identifier hs-var">fixUrl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;endpoint&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410726"><span class="hs-identifier hs-var">ep'</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621679410688"><span class="annot"><span class="annottext">httpbin :: [Char]
</span><a href="#local-6989586621679410688"><span class="hs-identifier hs-var hs-var">httpbin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
</span><a href="IC.Test.Agent.html#fixUrl"><span class="hs-identifier hs-var">fixUrl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;httpbin&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410724"><span class="hs-identifier hs-var">httpbin'</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="annot"><a href="IC.Test.Agent.html#fixUrl"><span class="hs-identifier hs-type">fixUrl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-258"></span><span id="fixUrl"><span class="annot"><span class="annottext">fixUrl :: [Char] -&gt; ShowS
</span><a href="IC.Test.Agent.html#fixUrl"><span class="hs-identifier hs-var hs-var">fixUrl</span></a></span></span><span> </span><span id="local-6989586621679410686"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410686"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679410685"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410685"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410685"><span class="hs-identifier hs-var">x</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;empty &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410686"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410685"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.List.html#init"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410685"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410685"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="annot"><a href="IC.Test.Agent.html#preFlight"><span class="hs-identifier hs-type">preFlight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/5nl5lyfznc78f5v4byqwsc8cnidi0h64-tasty-1.4.3-doc/share/doc/tasty-1.4.3/html/src/Test.Tasty.Options.html#OptionSet"><span class="hs-identifier hs-type">OptionSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#AgentConfig"><span class="hs-identifier hs-type">AgentConfig</span></a></span><span>
</span><span id="line-264"></span><span id="preFlight"><span class="annot"><span class="annottext">preFlight :: OptionSet -&gt; IO AgentConfig
</span><a href="IC.Test.Agent.html#preFlight"><span class="hs-identifier hs-var hs-var">preFlight</span></a></span></span><span> </span><span id="local-6989586621679410680"><span class="annot"><span class="annottext">OptionSet
</span><a href="#local-6989586621679410680"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="IC.Test.Options.html#Endpoint"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span id="local-6989586621679410678"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410678"><span class="hs-identifier hs-var">ep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. IsOption v =&gt; OptionSet -&gt; v
</span><a href="file:///nix/store/5nl5lyfznc78f5v4byqwsc8cnidi0h64-tasty-1.4.3-doc/share/doc/tasty-1.4.3/html/src/Test.Tasty.Options.html#lookupOption"><span class="hs-identifier hs-var">lookupOption</span></a></span><span> </span><span class="annot"><span class="annottext">OptionSet
</span><a href="#local-6989586621679410680"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="IC.Test.Options.html#Httpbin"><span class="hs-identifier hs-type">Httpbin</span></a></span><span> </span><span id="local-6989586621679410675"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410675"><span class="hs-identifier hs-var">httpbin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. IsOption v =&gt; OptionSet -&gt; v
</span><a href="file:///nix/store/5nl5lyfznc78f5v4byqwsc8cnidi0h64-tasty-1.4.3-doc/share/doc/tasty-1.4.3/html/src/Test.Tasty.Options.html#lookupOption"><span class="hs-identifier hs-var">lookupOption</span></a></span><span> </span><span class="annot"><span class="annottext">OptionSet
</span><a href="#local-6989586621679410680"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="IC.Test.Options.html#PollTimeout"><span class="hs-identifier hs-type">PollTimeout</span></a></span><span> </span><span id="local-6989586621679410673"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679410673"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. IsOption v =&gt; OptionSet -&gt; v
</span><a href="file:///nix/store/5nl5lyfznc78f5v4byqwsc8cnidi0h64-tasty-1.4.3-doc/share/doc/tasty-1.4.3/html/src/Test.Tasty.Options.html#lookupOption"><span class="hs-identifier hs-var">lookupOption</span></a></span><span> </span><span class="annot"><span class="annottext">OptionSet
</span><a href="#local-6989586621679410680"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="IC.Test.Options.html#AllowSelfSignedCerts"><span class="hs-identifier hs-type">AllowSelfSignedCerts</span></a></span><span> </span><span id="local-6989586621679410671"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679410671"><span class="hs-identifier hs-var">allow_self_signed_certs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. IsOption v =&gt; OptionSet -&gt; v
</span><a href="file:///nix/store/5nl5lyfznc78f5v4byqwsc8cnidi0h64-tasty-1.4.3-doc/share/doc/tasty-1.4.3/html/src/Test.Tasty.Options.html#lookupOption"><span class="hs-identifier hs-var">lookupOption</span></a></span><span> </span><span class="annot"><span class="annottext">OptionSet
</span><a href="#local-6989586621679410680"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="IC.Test.Options.html#TestSubnet"><span class="hs-identifier hs-type">TestSubnet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityId
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubnetType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410669"><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><a href="#local-6989586621679410669"><span class="hs-identifier hs-var">test_ranges</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410668"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679410668"><span class="hs-identifier hs-var">test_nodes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. IsOption v =&gt; OptionSet -&gt; v
</span><a href="file:///nix/store/5nl5lyfznc78f5v4byqwsc8cnidi0h64-tasty-1.4.3-doc/share/doc/tasty-1.4.3/html/src/Test.Tasty.Options.html#lookupOption"><span class="hs-identifier hs-var">lookupOption</span></a></span><span> </span><span class="annot"><span class="annottext">OptionSet
</span><a href="#local-6989586621679410680"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410667"><span class="annot"><span class="annottext">test_agent_subnet_config :: AgentSubnetConfig
</span><a href="#local-6989586621679410667"><span class="hs-identifier hs-var hs-var">test_agent_subnet_config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [(Word64, Word64)] -&gt; AgentSubnetConfig
</span><a href="IC.Test.Agent.html#AgentSubnetConfig"><span class="hs-identifier hs-var">AgentSubnetConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
</span><a href="IC.Test.Agent.html#fixUrl"><span class="hs-identifier hs-var">fixUrl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;node&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679410668"><span class="hs-identifier hs-var">test_nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><a href="#local-6989586621679410669"><span class="hs-identifier hs-var">test_ranges</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="IC.Test.Options.html#PeerSubnet"><span class="hs-identifier hs-type">PeerSubnet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityId
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubnetType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410665"><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><a href="#local-6989586621679410665"><span class="hs-identifier hs-var">peer_ranges</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410664"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679410664"><span class="hs-identifier hs-var">peer_nodes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. IsOption v =&gt; OptionSet -&gt; v
</span><a href="file:///nix/store/5nl5lyfznc78f5v4byqwsc8cnidi0h64-tasty-1.4.3-doc/share/doc/tasty-1.4.3/html/src/Test.Tasty.Options.html#lookupOption"><span class="hs-identifier hs-var">lookupOption</span></a></span><span> </span><span class="annot"><span class="annottext">OptionSet
</span><a href="#local-6989586621679410680"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410663"><span class="annot"><span class="annottext">peer_agent_subnet_config :: AgentSubnetConfig
</span><a href="#local-6989586621679410663"><span class="hs-identifier hs-var hs-var">peer_agent_subnet_config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [(Word64, Word64)] -&gt; AgentSubnetConfig
</span><a href="IC.Test.Agent.html#AgentSubnetConfig"><span class="hs-identifier hs-var">AgentSubnetConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
</span><a href="IC.Test.Agent.html#fixUrl"><span class="hs-identifier hs-var">fixUrl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;node&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679410664"><span class="hs-identifier hs-var">peer_nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><a href="#local-6989586621679410665"><span class="hs-identifier hs-var">peer_ranges</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; [Char] -&gt; [AgentSubnetConfig] -&gt; [Char] -&gt; Int -&gt; IO AgentConfig
</span><a href="IC.Test.Agent.html#makeAgentConfig"><span class="hs-identifier hs-var">makeAgentConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679410671"><span class="hs-identifier hs-var">allow_self_signed_certs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410678"><span class="hs-identifier hs-var">ep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AgentSubnetConfig
</span><a href="#local-6989586621679410667"><span class="hs-identifier hs-var">test_agent_subnet_config</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AgentSubnetConfig
</span><a href="#local-6989586621679410663"><span class="hs-identifier hs-var">peer_agent_subnet_config</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410675"><span class="hs-identifier hs-var">httpbin</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679410673"><span class="hs-identifier hs-var">to</span></a></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">-- Yes, implicit arguments are frowned upon. But they are also very useful.</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-keyword">type</span><span> </span><span id="HasAgentConfig"><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-var">HasAgentConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="">?agentConfig</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#AgentConfig"><span class="hs-identifier hs-type">AgentConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span id="local-6989586621679411393"><span class="annot"><a href="IC.Test.Agent.html#withAgentConfig"><span class="hs-identifier hs-type">withAgentConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679411393"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#AgentConfig"><span class="hs-identifier hs-type">AgentConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679411393"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-281"></span><span id="withAgentConfig"><span class="annot"><span class="annottext">withAgentConfig :: forall a. (HasAgentConfig =&gt; a) -&gt; AgentConfig -&gt; a
</span><a href="IC.Test.Agent.html#withAgentConfig"><span class="hs-identifier hs-var hs-var">withAgentConfig</span></a></span></span><span> </span><span id="local-6989586621679410662"><span class="annot"><span class="annottext">HasAgentConfig =&gt; a
</span><a href="#local-6989586621679410662"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span id="local-6989586621679410661"><span class="annot"><span class="annottext">AgentConfig
</span><a href="#local-6989586621679410661"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="">?agentConfig</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AgentConfig
</span><a href="#local-6989586621679410661"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; a
</span><a href="#local-6989586621679410662"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="annot"><a href="IC.Test.Agent.html#agentConfig"><span class="hs-identifier hs-type">agentConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#AgentConfig"><span class="hs-identifier hs-type">AgentConfig</span></a></span><span>
</span><span id="line-284"></span><span id="agentConfig"><span class="annot"><span class="annottext">agentConfig :: HasAgentConfig =&gt; AgentConfig
</span><a href="IC.Test.Agent.html#agentConfig"><span class="hs-identifier hs-var hs-var">agentConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasAgentConfig
</span><a href="#local-6989586621679410657"><span class="hs-var">?agentConfig</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="annot"><a href="IC.Test.Agent.html#endPoint"><span class="hs-identifier hs-type">endPoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-287"></span><span id="endPoint"><span class="annot"><span class="annottext">endPoint :: HasAgentConfig =&gt; [Char]
</span><a href="IC.Test.Agent.html#endPoint"><span class="hs-identifier hs-var hs-var">endPoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AgentConfig -&gt; [Char]
</span><a href="IC.Test.Agent.html#tc_endPoint"><span class="hs-identifier hs-var">tc_endPoint</span></a></span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; AgentConfig
</span><a href="IC.Test.Agent.html#agentConfig"><span class="hs-identifier hs-var">agentConfig</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="annot"><a href="IC.Test.Agent.html#subnets"><span class="hs-identifier hs-type">subnets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IC.Test.Agent.html#AgentSubnetConfig"><span class="hs-identifier hs-type">AgentSubnetConfig</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-290"></span><span id="subnets"><span class="annot"><span class="annottext">subnets :: HasAgentConfig =&gt; [AgentSubnetConfig]
</span><a href="IC.Test.Agent.html#subnets"><span class="hs-identifier hs-var hs-var">subnets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AgentConfig -&gt; [AgentSubnetConfig]
</span><a href="IC.Test.Agent.html#tc_subnets"><span class="hs-identifier hs-var">tc_subnets</span></a></span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; AgentConfig
</span><a href="IC.Test.Agent.html#agentConfig"><span class="hs-identifier hs-var">agentConfig</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="annot"><a href="IC.Test.Agent.html#agentManager"><span class="hs-identifier hs-type">agentManager</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span>
</span><span id="line-293"></span><span id="agentManager"><span class="annot"><span class="annottext">agentManager :: HasAgentConfig =&gt; Manager
</span><a href="IC.Test.Agent.html#agentManager"><span class="hs-identifier hs-var hs-var">agentManager</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AgentConfig -&gt; Manager
</span><a href="IC.Test.Agent.html#tc_manager"><span class="hs-identifier hs-var">tc_manager</span></a></span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; AgentConfig
</span><a href="IC.Test.Agent.html#agentConfig"><span class="hs-identifier hs-var">agentConfig</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- * Test data for some hardcoded user names</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="annot"><a href="IC.Test.Agent.html#doesn%27tExist"><span class="hs-identifier hs-type">doesn'tExist</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-298"></span><span id="doesn%27tExist"><span class="annot"><span class="annottext">doesn'tExist :: Blob
</span><a href="IC.Test.Agent.html#doesn%27tExist"><span class="hs-identifier hs-var hs-var">doesn'tExist</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;\xDE\xAD\xBE\xEF&quot;</span></span><span> </span><span class="hs-comment">-- hopefully no such canister/user exists</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="annot"><a href="IC.Test.Agent.html#defaultSK"><span class="hs-identifier hs-type">defaultSK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Crypto.html#SecretKey"><span class="hs-identifier hs-type">SecretKey</span></a></span><span>
</span><span id="line-301"></span><span id="defaultSK"><span class="annot"><span class="annottext">defaultSK :: SecretKey
</span><a href="IC.Test.Agent.html#defaultSK"><span class="hs-identifier hs-var hs-var">defaultSK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; SecretKey
</span><a href="IC.Crypto.html#createSecretKeyEd25519"><span class="hs-identifier hs-var">createSecretKeyEd25519</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;fixed32byteseedfortesting&quot;</span></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="annot"><a href="IC.Test.Agent.html#otherSK"><span class="hs-identifier hs-type">otherSK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Crypto.html#SecretKey"><span class="hs-identifier hs-type">SecretKey</span></a></span><span>
</span><span id="line-304"></span><span id="otherSK"><span class="annot"><span class="annottext">otherSK :: SecretKey
</span><a href="IC.Test.Agent.html#otherSK"><span class="hs-identifier hs-var hs-var">otherSK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; SecretKey
</span><a href="IC.Crypto.html#createSecretKeyEd25519"><span class="hs-identifier hs-var">createSecretKeyEd25519</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;anotherfixed32byteseedfortesting&quot;</span></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="annot"><a href="IC.Test.Agent.html#webAuthnECDSASK"><span class="hs-identifier hs-type">webAuthnECDSASK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Crypto.html#SecretKey"><span class="hs-identifier hs-type">SecretKey</span></a></span><span>
</span><span id="line-307"></span><span id="webAuthnECDSASK"><span class="annot"><span class="annottext">webAuthnECDSASK :: SecretKey
</span><a href="IC.Test.Agent.html#webAuthnECDSASK"><span class="hs-identifier hs-var hs-var">webAuthnECDSASK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; SecretKey
</span><a href="IC.Crypto.html#createSecretKeyWebAuthnECDSA"><span class="hs-identifier hs-var">createSecretKeyWebAuthnECDSA</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;webauthnseed&quot;</span></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="annot"><a href="IC.Test.Agent.html#webAuthnRSASK"><span class="hs-identifier hs-type">webAuthnRSASK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Crypto.html#SecretKey"><span class="hs-identifier hs-type">SecretKey</span></a></span><span>
</span><span id="line-310"></span><span id="webAuthnRSASK"><span class="annot"><span class="annottext">webAuthnRSASK :: SecretKey
</span><a href="IC.Test.Agent.html#webAuthnRSASK"><span class="hs-identifier hs-var hs-var">webAuthnRSASK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; SecretKey
</span><a href="IC.Crypto.html#createSecretKeyWebAuthnRSA"><span class="hs-identifier hs-var">createSecretKeyWebAuthnRSA</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;webauthnseed&quot;</span></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="annot"><a href="IC.Test.Agent.html#ecdsaSK"><span class="hs-identifier hs-type">ecdsaSK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Crypto.html#SecretKey"><span class="hs-identifier hs-type">SecretKey</span></a></span><span>
</span><span id="line-313"></span><span id="ecdsaSK"><span class="annot"><span class="annottext">ecdsaSK :: SecretKey
</span><a href="IC.Test.Agent.html#ecdsaSK"><span class="hs-identifier hs-var hs-var">ecdsaSK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; SecretKey
</span><a href="IC.Crypto.html#createSecretKeyECDSA"><span class="hs-identifier hs-var">createSecretKeyECDSA</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;ecdsaseed&quot;</span></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="annot"><a href="IC.Test.Agent.html#secp256k1SK"><span class="hs-identifier hs-type">secp256k1SK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Crypto.html#SecretKey"><span class="hs-identifier hs-type">SecretKey</span></a></span><span>
</span><span id="line-316"></span><span id="secp256k1SK"><span class="annot"><span class="annottext">secp256k1SK :: SecretKey
</span><a href="IC.Test.Agent.html#secp256k1SK"><span class="hs-identifier hs-var hs-var">secp256k1SK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; SecretKey
</span><a href="IC.Crypto.html#createSecretKeySecp256k1"><span class="hs-identifier hs-var">createSecretKeySecp256k1</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;secp256k1seed&quot;</span></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="annot"><a href="IC.Test.Agent.html#defaultUser"><span class="hs-identifier hs-type">defaultUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-319"></span><span id="defaultUser"><span class="annot"><span class="annottext">defaultUser :: Blob
</span><a href="IC.Test.Agent.html#defaultUser"><span class="hs-identifier hs-var hs-var">defaultUser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Blob
</span><a href="IC.Id.Forms.html#mkSelfAuthenticatingId"><span class="hs-identifier hs-var">mkSelfAuthenticatingId</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; Blob
</span><a href="IC.Crypto.html#toPublicKey"><span class="hs-identifier hs-var">toPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="IC.Test.Agent.html#defaultSK"><span class="hs-identifier hs-var">defaultSK</span></a></span><span>
</span><span id="line-320"></span><span class="annot"><a href="IC.Test.Agent.html#otherUser"><span class="hs-identifier hs-type">otherUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-321"></span><span id="otherUser"><span class="annot"><span class="annottext">otherUser :: Blob
</span><a href="IC.Test.Agent.html#otherUser"><span class="hs-identifier hs-var hs-var">otherUser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Blob
</span><a href="IC.Id.Forms.html#mkSelfAuthenticatingId"><span class="hs-identifier hs-var">mkSelfAuthenticatingId</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; Blob
</span><a href="IC.Crypto.html#toPublicKey"><span class="hs-identifier hs-var">toPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="IC.Test.Agent.html#otherSK"><span class="hs-identifier hs-var">otherSK</span></a></span><span>
</span><span id="line-322"></span><span class="annot"><a href="IC.Test.Agent.html#webAuthnECDSAUser"><span class="hs-identifier hs-type">webAuthnECDSAUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-323"></span><span id="webAuthnECDSAUser"><span class="annot"><span class="annottext">webAuthnECDSAUser :: Blob
</span><a href="IC.Test.Agent.html#webAuthnECDSAUser"><span class="hs-identifier hs-var hs-var">webAuthnECDSAUser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Blob
</span><a href="IC.Id.Forms.html#mkSelfAuthenticatingId"><span class="hs-identifier hs-var">mkSelfAuthenticatingId</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; Blob
</span><a href="IC.Crypto.html#toPublicKey"><span class="hs-identifier hs-var">toPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="IC.Test.Agent.html#webAuthnECDSASK"><span class="hs-identifier hs-var">webAuthnECDSASK</span></a></span><span>
</span><span id="line-324"></span><span class="annot"><a href="IC.Test.Agent.html#webAuthnRSAUser"><span class="hs-identifier hs-type">webAuthnRSAUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-325"></span><span id="webAuthnRSAUser"><span class="annot"><span class="annottext">webAuthnRSAUser :: Blob
</span><a href="IC.Test.Agent.html#webAuthnRSAUser"><span class="hs-identifier hs-var hs-var">webAuthnRSAUser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Blob
</span><a href="IC.Id.Forms.html#mkSelfAuthenticatingId"><span class="hs-identifier hs-var">mkSelfAuthenticatingId</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; Blob
</span><a href="IC.Crypto.html#toPublicKey"><span class="hs-identifier hs-var">toPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="IC.Test.Agent.html#webAuthnRSASK"><span class="hs-identifier hs-var">webAuthnRSASK</span></a></span><span>
</span><span id="line-326"></span><span class="annot"><a href="IC.Test.Agent.html#ecdsaUser"><span class="hs-identifier hs-type">ecdsaUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-327"></span><span id="ecdsaUser"><span class="annot"><span class="annottext">ecdsaUser :: Blob
</span><a href="IC.Test.Agent.html#ecdsaUser"><span class="hs-identifier hs-var hs-var">ecdsaUser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Blob
</span><a href="IC.Id.Forms.html#mkSelfAuthenticatingId"><span class="hs-identifier hs-var">mkSelfAuthenticatingId</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; Blob
</span><a href="IC.Crypto.html#toPublicKey"><span class="hs-identifier hs-var">toPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="IC.Test.Agent.html#ecdsaSK"><span class="hs-identifier hs-var">ecdsaSK</span></a></span><span>
</span><span id="line-328"></span><span class="annot"><a href="IC.Test.Agent.html#secp256k1User"><span class="hs-identifier hs-type">secp256k1User</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-329"></span><span id="secp256k1User"><span class="annot"><span class="annottext">secp256k1User :: Blob
</span><a href="IC.Test.Agent.html#secp256k1User"><span class="hs-identifier hs-var hs-var">secp256k1User</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Blob
</span><a href="IC.Id.Forms.html#mkSelfAuthenticatingId"><span class="hs-identifier hs-var">mkSelfAuthenticatingId</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; Blob
</span><a href="IC.Crypto.html#toPublicKey"><span class="hs-identifier hs-var">toPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="IC.Test.Agent.html#secp256k1SK"><span class="hs-identifier hs-var">secp256k1SK</span></a></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="annot"><a href="IC.Test.Agent.html#anonymousUser"><span class="hs-identifier hs-type">anonymousUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-332"></span><span id="anonymousUser"><span class="annot"><span class="annottext">anonymousUser :: Blob
</span><a href="IC.Test.Agent.html#anonymousUser"><span class="hs-identifier hs-var hs-var">anonymousUser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;\x04&quot;</span></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="hs-comment">-- * Request envelopes</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span id="local-6989586621679411390"><span class="annot"><a href="IC.Test.Agent.html#addIfNotThere"><span class="hs-identifier hs-type">addIfNotThere</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411390"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">T.Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679411390"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679411390"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span></span><span>
</span><span id="line-337"></span><span id="addIfNotThere"><span class="annot"><span class="annottext">addIfNotThere :: forall (m :: * -&gt; *). Monad m =&gt; Text -&gt; m GenR -&gt; GenR -&gt; m GenR
</span><a href="IC.Test.Agent.html#addIfNotThere"><span class="hs-identifier hs-var hs-var">addIfNotThere</span></a></span></span><span> </span><span id="local-6989586621679410629"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679410629"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">m GenR
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.HTTP.GenR.html#GRec"><span class="hs-identifier hs-type">GRec</span></a></span><span> </span><span id="local-6989586621679410627"><span class="annot"><span class="annottext">HashMap Text GenR
</span><a href="#local-6989586621679410627"><span class="hs-identifier hs-var">hm</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679410629"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. (Eq k, Hashable k) =&gt; k -&gt; HashMap k a -&gt; Bool
</span><a href="file:///nix/store/w7y9k4kyfnpkadl1rd8vfgw68z3s3x71-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashMap.Internal.html#member"><span class="hs-operator hs-var">`HM.member`</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text GenR
</span><a href="#local-6989586621679410627"><span class="hs-identifier hs-var">hm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap Text GenR -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GRec"><span class="hs-identifier hs-var">GRec</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text GenR
</span><a href="#local-6989586621679410627"><span class="hs-identifier hs-var">hm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span class="annot"><a href="IC.Test.Agent.html#addIfNotThere"><span class="hs-identifier hs-var">addIfNotThere</span></a></span><span> </span><span id="local-6989586621679410625"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679410625"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679410624"><span class="annot"><span class="annottext">m GenR
</span><a href="#local-6989586621679410624"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.HTTP.GenR.html#GRec"><span class="hs-identifier hs-type">GRec</span></a></span><span> </span><span id="local-6989586621679410623"><span class="annot"><span class="annottext">HashMap Text GenR
</span><a href="#local-6989586621679410623"><span class="hs-identifier hs-var">hm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>  </span><span id="local-6989586621679410622"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410622"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m GenR
</span><a href="#local-6989586621679410624"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text GenR -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GRec"><span class="hs-identifier hs-var">GRec</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><a href="file:///nix/store/w7y9k4kyfnpkadl1rd8vfgw68z3s3x71-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashMap.Internal.html#insert"><span class="hs-identifier hs-var">HM.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679410625"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410622"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text GenR
</span><a href="#local-6989586621679410623"><span class="hs-identifier hs-var">hm</span></a></span><span>
</span><span id="line-341"></span><span class="annot"><a href="IC.Test.Agent.html#addIfNotThere"><span class="hs-identifier hs-var">addIfNotThere</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">m GenR
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GenR
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;addIfNotThere: not a record&quot;</span></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="annot"><a href="IC.Test.Agent.html#addNonce"><span class="hs-identifier hs-type">addNonce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span>
</span><span id="line-344"></span><span id="addNonce"><span class="annot"><span class="annottext">addNonce :: GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#addNonce"><span class="hs-identifier hs-var hs-var">addNonce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; Text -&gt; m GenR -&gt; GenR -&gt; m GenR
</span><a href="IC.Test.Agent.html#addIfNotThere"><span class="hs-identifier hs-var">addIfNotThere</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;nonce&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IO Blob
</span><a href="IC.Test.Agent.html#getRand8Bytes"><span class="hs-identifier hs-var">getRand8Bytes</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="annot"><a href="IC.Test.Agent.html#getRand8Bytes"><span class="hs-identifier hs-type">getRand8Bytes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span>
</span><span id="line-348"></span><span id="getRand8Bytes"><span class="annot"><span class="annottext">getRand8Bytes :: IO Blob
</span><a href="IC.Test.Agent.html#getRand8Bytes"><span class="hs-identifier hs-var hs-var">getRand8Bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; Blob
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.html#pack"><span class="hs-identifier hs-var">BS.pack</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Control.Monad.html#replicateM"><span class="hs-identifier hs-var">replicateM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *). (Random a, MonadIO m) =&gt; m a
</span><a href="file:///nix/store/kwjhvjzd9a4fh4sc1pajfx8br8bc58k5-random-1.2.1.1-doc/share/doc/random-1.2.1.1/html/src/System.Random.html#randomIO"><span class="hs-identifier hs-var">randomIO</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="hs-comment">-- Adds expiry 5 minutes</span><span>
</span><span id="line-351"></span><span class="annot"><a href="IC.Test.Agent.html#addExpiry"><span class="hs-identifier hs-type">addExpiry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span>
</span><span id="line-352"></span><span id="addExpiry"><span class="annot"><span class="annottext">addExpiry :: GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#addExpiry"><span class="hs-identifier hs-var hs-var">addExpiry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; Text -&gt; m GenR -&gt; GenR -&gt; m GenR
</span><a href="IC.Test.Agent.html#addIfNotThere"><span class="hs-identifier hs-var">addIfNotThere</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ingress_expiry&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-353"></span><span>    </span><span id="local-6989586621679410614"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679410614"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO POSIXTime
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/time-1.11.1.1/src/Data.Time.Clock.POSIX.html#getPOSIXTime"><span class="hs-identifier hs-var">getPOSIXTime</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GNat"><span class="hs-identifier hs-var">GNat</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Real.html#round"><span class="hs-identifier hs-var">round</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679410614"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">5</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">1000_000_000</span></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span class="annot"><a href="IC.Test.Agent.html#envelope"><span class="hs-identifier hs-type">envelope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Crypto.html#SecretKey"><span class="hs-identifier hs-type">SecretKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span>
</span><span id="line-357"></span><span id="envelope"><span class="annot"><span class="annottext">envelope :: SecretKey -&gt; GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#envelope"><span class="hs-identifier hs-var hs-var">envelope</span></a></span></span><span> </span><span id="local-6989586621679410608"><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621679410608"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; [(SecretKey, Maybe [Blob])] -&gt; GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#delegationEnv"><span class="hs-identifier hs-var">delegationEnv</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621679410608"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="annot"><a href="IC.Test.Agent.html#delegationEnv"><span class="hs-identifier hs-type">delegationEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Crypto.html#SecretKey"><span class="hs-identifier hs-type">SecretKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="IC.Crypto.html#SecretKey"><span class="hs-identifier hs-type">SecretKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span>
</span><span id="line-360"></span><span id="delegationEnv"><span class="annot"><span class="annottext">delegationEnv :: SecretKey -&gt; [(SecretKey, Maybe [Blob])] -&gt; GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#delegationEnv"><span class="hs-identifier hs-var hs-var">delegationEnv</span></a></span></span><span> </span><span id="local-6989586621679410607"><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621679410607"><span class="hs-identifier hs-var">sk1</span></a></span></span><span> </span><span id="local-6989586621679410606"><span class="annot"><span class="annottext">[(SecretKey, Maybe [Blob])]
</span><a href="#local-6989586621679410606"><span class="hs-identifier hs-var">dels</span></a></span></span><span> </span><span id="local-6989586621679410605"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410605"><span class="hs-identifier hs-var">content</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410604"><span class="annot"><span class="annottext">sks :: [SecretKey]
</span><a href="#local-6989586621679410604"><span class="hs-identifier hs-var hs-var">sks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621679410607"><span class="hs-identifier hs-var">sk1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(SecretKey, Maybe [Blob])]
</span><a href="#local-6989586621679410606"><span class="hs-identifier hs-var">dels</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621679410603"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679410603"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO POSIXTime
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/time-1.11.1.1/src/Data.Time.Clock.POSIX.html#getPOSIXTime"><span class="hs-identifier hs-var">getPOSIXTime</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410602"><span class="annot"><span class="annottext">expiry :: Natural
</span><a href="#local-6989586621679410602"><span class="hs-identifier hs-var hs-var">expiry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Real.html#round"><span class="hs-identifier hs-var">round</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679410603"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">60</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">1000_000_000</span></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>    </span><span id="local-6989586621679410601"><span class="annot"><span class="annottext">[GenR]
</span><a href="#local-6989586621679410601"><span class="hs-identifier hs-var">delegations</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Traversable.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[SecretKey]
</span><a href="#local-6989586621679410604"><span class="hs-identifier hs-var">sks</span></a></span><span> </span><span class="annot"><span class="annottext">[(SecretKey, Maybe [Blob])]
</span><a href="#local-6989586621679410606"><span class="hs-identifier hs-var">dels</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679410599"><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621679410599"><span class="hs-identifier hs-var">sk1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679410598"><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621679410598"><span class="hs-identifier hs-var">sk2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679410597"><span class="annot"><span class="annottext">Maybe [Blob]
</span><a href="#local-6989586621679410597"><span class="hs-identifier hs-var">targets</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410596"><span class="annot"><span class="annottext">delegation :: GenR
</span><a href="#local-6989586621679410596"><span class="hs-identifier hs-var hs-var">delegation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashMap Text GenR] -&gt; GenR
</span><a href="IC.HTTP.GenR.html#rec"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-367"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pubkey&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SecretKey -&gt; Blob
</span><a href="IC.Crypto.html#toPublicKey"><span class="hs-identifier hs-var">toPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621679410598"><span class="hs-identifier hs-var">sk2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;expiration&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GNat"><span class="hs-identifier hs-var">GNat</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679410602"><span class="hs-identifier hs-var">expiry</span></a></span><span>
</span><span id="line-369"></span><span>            </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-370"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;targets&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">[GenR] -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GList"><span class="hs-identifier hs-var">GList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410593"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679410593"><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410593"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Blob]
</span><a href="#local-6989586621679410597"><span class="hs-identifier hs-var">targets</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-371"></span><span>      </span><span id="local-6989586621679410592"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410592"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; SecretKey -&gt; Blob -&gt; IO Blob
</span><a href="IC.Crypto.html#sign"><span class="hs-identifier hs-var">sign</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;ic-request-auth-delegation&quot;</span></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621679410599"><span class="hs-identifier hs-var">sk1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenR -&gt; Blob
</span><a href="IC.HTTP.RequestId.html#requestId"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410596"><span class="hs-identifier hs-var">delegation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[HashMap Text GenR] -&gt; GenR
</span><a href="IC.HTTP.GenR.html#rec"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;delegation&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410596"><span class="hs-identifier hs-var">delegation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;signature&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410592"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-373"></span><span>    </span><span id="local-6989586621679410589"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410589"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; SecretKey -&gt; Blob -&gt; IO Blob
</span><a href="IC.Crypto.html#sign"><span class="hs-identifier hs-var">sign</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;ic-request&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="annot"><span class="annottext">[SecretKey]
</span><a href="#local-6989586621679410604"><span class="hs-identifier hs-var">sks</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenR -&gt; Blob
</span><a href="IC.HTTP.RequestId.html#requestId"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410605"><span class="hs-identifier hs-var">content</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[HashMap Text GenR] -&gt; GenR
</span><a href="IC.HTTP.GenR.html#rec"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-375"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sender_pubkey&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SecretKey -&gt; Blob
</span><a href="IC.Crypto.html#toPublicKey"><span class="hs-identifier hs-var">toPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621679410607"><span class="hs-identifier hs-var">sk1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sender_sig&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410589"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-377"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;content&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410605"><span class="hs-identifier hs-var">content</span></a></span><span>
</span><span id="line-378"></span><span>      </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-379"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sender_delegation&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">[GenR] -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GList"><span class="hs-identifier hs-var">GList</span></a></span><span> </span><span class="annot"><span class="annottext">[GenR]
</span><a href="#local-6989586621679410601"><span class="hs-identifier hs-var">delegations</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[GenR]
</span><a href="#local-6989586621679410601"><span class="hs-identifier hs-var">delegations</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="hs-comment">-- a little bit of smartness in our combinators: Adding correct envelope, nonce</span><span>
</span><span id="line-382"></span><span class="hs-comment">-- and expiry if it is not already there</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="annot"><a href="IC.Test.Agent.html#senderOf"><span class="hs-identifier hs-type">senderOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-385"></span><span id="senderOf"><span class="annot"><span class="annottext">senderOf :: GenR -&gt; Blob
</span><a href="IC.Test.Agent.html#senderOf"><span class="hs-identifier hs-var hs-var">senderOf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.HTTP.GenR.html#GRec"><span class="hs-identifier hs-type">GRec</span></a></span><span> </span><span id="local-6989586621679410587"><span class="annot"><span class="annottext">HashMap Text GenR
</span><a href="#local-6989586621679410587"><span class="hs-identifier hs-var">hm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-type">GBlob</span></a></span><span> </span><span id="local-6989586621679410586"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410586"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><a href="file:///nix/store/w7y9k4kyfnpkadl1rd8vfgw68z3s3x71-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashMap.Internal.html#lookup"><span class="hs-identifier hs-var">HM.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sender&quot;</span></span><span> </span><span class="annot"><span class="annottext">HashMap Text GenR
</span><a href="#local-6989586621679410587"><span class="hs-identifier hs-var">hm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410586"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-386"></span><span class="annot"><a href="IC.Test.Agent.html#senderOf"><span class="hs-identifier hs-var">senderOf</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="IC.Test.Agent.html#anonymousUser"><span class="hs-identifier hs-var">anonymousUser</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="annot"><a href="IC.Test.Agent.html#addNonceExpiryEnv"><span class="hs-identifier hs-type">addNonceExpiryEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span>
</span><span id="line-389"></span><span id="addNonceExpiryEnv"><span class="annot"><span class="annottext">addNonceExpiryEnv :: GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#addNonceExpiryEnv"><span class="hs-identifier hs-var hs-var">addNonceExpiryEnv</span></a></span></span><span> </span><span id="local-6989586621679410584"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410584"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><span class="annottext">GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#addNonce"><span class="hs-identifier hs-var">addNonce</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410584"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#addExpiry"><span class="hs-identifier hs-var">addExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#envelopeFor"><span class="hs-identifier hs-var">envelopeFor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenR -&gt; Blob
</span><a href="IC.Test.Agent.html#senderOf"><span class="hs-identifier hs-var">senderOf</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410584"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="annot"><a href="IC.Test.Agent.html#envelopeFor"><span class="hs-identifier hs-type">envelopeFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span>
</span><span id="line-393"></span><span id="envelopeFor"><span class="annot"><span class="annottext">envelopeFor :: Blob -&gt; GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#envelopeFor"><span class="hs-identifier hs-var hs-var">envelopeFor</span></a></span></span><span> </span><span id="local-6989586621679410583"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410583"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679410582"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410582"><span class="hs-identifier hs-var">content</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410583"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="IC.Test.Agent.html#anonymousUser"><span class="hs-identifier hs-var">anonymousUser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[HashMap Text GenR] -&gt; GenR
</span><a href="IC.HTTP.GenR.html#rec"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;content&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410582"><span class="hs-identifier hs-var">content</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span class="annot"><a href="IC.Test.Agent.html#envelopeFor"><span class="hs-identifier hs-var">envelopeFor</span></a></span><span> </span><span id="local-6989586621679410581"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410581"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679410580"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410580"><span class="hs-identifier hs-var">content</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#envelope"><span class="hs-identifier hs-var">envelope</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621679410579"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410580"><span class="hs-identifier hs-var">content</span></a></span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><a href="#local-6989586621679410579"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="IC.Crypto.html#SecretKey"><span class="hs-identifier hs-type">SecretKey</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621679410579"><span class="annot"><span class="annottext">key :: SecretKey
</span><a href="#local-6989586621679410579"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410581"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="IC.Test.Agent.html#defaultUser"><span class="hs-identifier hs-var">defaultUser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="IC.Test.Agent.html#defaultSK"><span class="hs-identifier hs-var">defaultSK</span></a></span><span>
</span><span id="line-398"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410581"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="IC.Test.Agent.html#otherUser"><span class="hs-identifier hs-var">otherUser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="IC.Test.Agent.html#otherSK"><span class="hs-identifier hs-var">otherSK</span></a></span><span>
</span><span id="line-399"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410581"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="IC.Test.Agent.html#webAuthnECDSAUser"><span class="hs-identifier hs-var">webAuthnECDSAUser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="IC.Test.Agent.html#webAuthnECDSASK"><span class="hs-identifier hs-var">webAuthnECDSASK</span></a></span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410581"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="IC.Test.Agent.html#webAuthnRSAUser"><span class="hs-identifier hs-var">webAuthnRSAUser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="IC.Test.Agent.html#webAuthnRSASK"><span class="hs-identifier hs-var">webAuthnRSASK</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410581"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="IC.Test.Agent.html#ecdsaUser"><span class="hs-identifier hs-var">ecdsaUser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="IC.Test.Agent.html#ecdsaSK"><span class="hs-identifier hs-var">ecdsaSK</span></a></span><span>
</span><span id="line-402"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410581"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="IC.Test.Agent.html#secp256k1User"><span class="hs-identifier hs-var">secp256k1User</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="IC.Test.Agent.html#secp256k1SK"><span class="hs-identifier hs-var">secp256k1SK</span></a></span><span>
</span><span id="line-403"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410581"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="IC.Test.Agent.html#anonymousUser"><span class="hs-identifier hs-var">anonymousUser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;No key for the anonymous user&quot;</span></span><span>
</span><span id="line-404"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Don't know key for user &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410581"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="hs-comment">-- * HUnit error reporting integration</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span id="local-6989586621679411451"><span class="annot"><a href="IC.Test.Agent.html#asRight"><span class="hs-identifier hs-type">asRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">T.Text</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411451"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411451"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-409"></span><span id="asRight"><span class="annot"><span class="annottext">asRight :: forall a. HasCallStack =&gt; Either Text a -&gt; IO a
</span><a href="IC.Test.Agent.html#asRight"><span class="hs-identifier hs-var hs-var">asRight</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679410574"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679410574"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679410574"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span class="annot"><a href="IC.Test.Agent.html#asRight"><span class="hs-identifier hs-var">asRight</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679410573"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410573"><span class="hs-identifier hs-var">gr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410573"><span class="hs-identifier hs-var">gr</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span id="local-6989586621679411360"><span class="annot"><a href="IC.Test.Agent.html#asExceptT"><span class="hs-identifier hs-type">asExceptT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/transformers-0.5.6.2/src/Control.Monad.Trans.Except.html#ExceptT"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">T.Text</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411360"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411360"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-413"></span><span id="asExceptT"><span class="annot"><span class="annottext">asExceptT :: forall a. HasCallStack =&gt; ExceptT Text IO a -&gt; IO a
</span><a href="IC.Test.Agent.html#asExceptT"><span class="hs-identifier hs-var hs-var">asExceptT</span></a></span></span><span> </span><span id="local-6989586621679410567"><span class="annot"><span class="annottext">ExceptT Text IO a
</span><a href="#local-6989586621679410567"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/transformers-0.5.6.2/src/Control.Monad.Trans.Except.html#runExceptT"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT Text IO a
</span><a href="#local-6989586621679410567"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Either Text a -&gt; IO a
</span><a href="IC.Test.Agent.html#asRight"><span class="hs-identifier hs-var">asRight</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span class="hs-comment">-- * Requests</span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="hs-comment">-- | Posting a CBOR request, returning a raw bytestring</span><span>
</span><span id="line-418"></span><span class="annot"><a href="IC.Test.Agent.html#postCBOR%27"><span class="hs-identifier hs-type">postCBOR'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span id="postCBOR%27"><span class="annot"><span class="annottext">postCBOR' :: (HasCallStack, HasAgentConfig) =&gt;
[Char] -&gt; [Char] -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postCBOR%27"><span class="hs-identifier hs-var hs-var">postCBOR'</span></a></span></span><span> </span><span id="local-6989586621679410548"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410548"><span class="hs-identifier hs-var">ep</span></a></span></span><span> </span><span id="local-6989586621679410547"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410547"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621679410546"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410546"><span class="hs-identifier hs-var">gr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-420"></span><span>    </span><span id="local-6989586621679410545"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679410545"><span class="hs-identifier hs-var">request</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadThrow m =&gt; [Char] -&gt; m Request
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Request.html#parseRequest"><span class="hs-identifier hs-var">parseRequest</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410548"><span class="hs-identifier hs-var">ep</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410547"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-421"></span><span>    </span><span id="local-6989586621679410544"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679410544"><span class="hs-identifier hs-var">request</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679410545"><span class="hs-identifier hs-var">request</span></a></span><span>
</span><span id="line-422"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">method :: ByteString
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#method"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;POST&quot;</span></span><span>
</span><span id="line-423"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">requestBody :: RequestBody
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#requestBody"><span class="hs-identifier hs-var">requestBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; RequestBody
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#RequestBodyLBS"><span class="hs-identifier hs-var">RequestBodyLBS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Blob
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Builder.html#toLazyByteString"><span class="hs-identifier hs-var">BS.toLazyByteString</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenR -&gt; Builder
</span><a href="IC.HTTP.CBOR.html#encode"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410546"><span class="hs-identifier hs-var">gr</span></a></span><span>
</span><span id="line-424"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">requestHeaders :: RequestHeaders
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#requestHeaders"><span class="hs-identifier hs-var">requestHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><a href="file:///nix/store/lwjn4w0ddfm34a87vly061bh3il1hk19-http-types-0.12.3-doc/share/doc/http-types-0.12.3/html/src/Network.HTTP.Types.Header.html#hContentType"><span class="hs-identifier hs-var">hContentType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;application/cbor&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-425"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><span class="annottext">forall a. HasAgentConfig =&gt; IO (Maybe a) -&gt; IO a
</span><a href="IC.Test.Agent.html#waitFor"><span class="hs-identifier hs-var">waitFor</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-427"></span><span>      </span><span id="local-6989586621679410537"><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679410537"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Manager -&gt; IO (Response Blob)
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Core.html#httpLbs"><span class="hs-identifier hs-var">httpLbs</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679410544"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; Manager
</span><a href="IC.Test.Agent.html#agentManager"><span class="hs-identifier hs-var">agentManager</span></a></span><span>
</span><span id="line-428"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall body. Response body -&gt; Status
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#responseStatus"><span class="hs-identifier hs-var">responseStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679410537"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="file:///nix/store/lwjn4w0ddfm34a87vly061bh3il1hk19-http-types-0.12.3-doc/share/doc/http-types-0.12.3/html/src/Network.HTTP.Types.Status.html#tooManyRequests429"><span class="hs-identifier hs-var">tooManyRequests429</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-429"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679410537"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-comment">-- | postCBOR with url based on effective canister id</span><span>
</span><span id="line-432"></span><span class="annot"><a href="IC.Test.Agent.html#postCBOR"><span class="hs-identifier hs-type">postCBOR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span id="postCBOR"><span class="annot"><span class="annottext">postCBOR :: (HasCallStack, HasAgentConfig) =&gt;
[Char] -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postCBOR"><span class="hs-identifier hs-var hs-var">postCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
[Char] -&gt; [Char] -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postCBOR%27"><span class="hs-identifier hs-var">postCBOR'</span></a></span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; [Char]
</span><a href="IC.Test.Agent.html#endPoint"><span class="hs-identifier hs-var">endPoint</span></a></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span class="annot"><a href="IC.Test.Agent.html#postReadStateCBOR%27"><span class="hs-identifier hs-type">postReadStateCBOR'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span id="postReadStateCBOR%27"><span class="annot"><span class="annottext">postReadStateCBOR' :: (HasCallStack, HasAgentConfig) =&gt;
[Char] -&gt; Blob -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postReadStateCBOR%27"><span class="hs-identifier hs-var hs-var">postReadStateCBOR'</span></a></span></span><span> </span><span id="local-6989586621679410520"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410520"><span class="hs-identifier hs-var">ep</span></a></span></span><span> </span><span id="local-6989586621679410519"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410519"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
[Char] -&gt; [Char] -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postCBOR%27"><span class="hs-identifier hs-var">postCBOR'</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410520"><span class="hs-identifier hs-var">ep</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;/api/v2/canister/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#textual"><span class="hs-identifier hs-var">textual</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410519"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;/read_state&quot;</span></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="annot"><a href="IC.Test.Agent.html#postCallCBOR"><span class="hs-identifier hs-type">postCallCBOR</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#postQueryCBOR"><span class="hs-identifier hs-type">postQueryCBOR</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#postReadStateCBOR"><span class="hs-identifier hs-type">postReadStateCBOR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span id="postCallCBOR"><span class="annot"><span class="annottext">postCallCBOR :: (HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postCallCBOR"><span class="hs-identifier hs-var hs-var">postCallCBOR</span></a></span></span><span> </span><span id="local-6989586621679410509"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410509"><span class="hs-identifier hs-var">cid</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679410508"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410508"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; Blob -&gt; IO [()]
</span><a href="IC.Test.Agent.html#sync_height"><span class="hs-identifier hs-var">sync_height</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410509"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
[Char] -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postCBOR"><span class="hs-identifier hs-var">postCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;/api/v2/canister/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#textual"><span class="hs-identifier hs-var">textual</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410509"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;/call&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410508"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span id="postQueryCBOR"><span class="annot"><span class="annottext">postQueryCBOR :: (HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postQueryCBOR"><span class="hs-identifier hs-var hs-var">postQueryCBOR</span></a></span></span><span> </span><span id="local-6989586621679410497"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410497"><span class="hs-identifier hs-var">cid</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679410496"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410496"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; Blob -&gt; IO [()]
</span><a href="IC.Test.Agent.html#sync_height"><span class="hs-identifier hs-var">sync_height</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410497"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
[Char] -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postCBOR"><span class="hs-identifier hs-var">postCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;/api/v2/canister/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#textual"><span class="hs-identifier hs-var">textual</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410497"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;/query&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410496"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span id="postReadStateCBOR"><span class="annot"><span class="annottext">postReadStateCBOR :: (HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postReadStateCBOR"><span class="hs-identifier hs-var hs-var">postReadStateCBOR</span></a></span></span><span> </span><span id="local-6989586621679410487"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410487"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679410486"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410486"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; Blob -&gt; IO [()]
</span><a href="IC.Test.Agent.html#sync_height"><span class="hs-identifier hs-var">sync_height</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410487"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
[Char] -&gt; Blob -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postReadStateCBOR%27"><span class="hs-identifier hs-var">postReadStateCBOR'</span></a></span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; [Char]
</span><a href="IC.Test.Agent.html#endPoint"><span class="hs-identifier hs-var">endPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410487"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410486"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span id="local-6989586621679411350"><span class="annot"><a href="IC.Test.Agent.html#waitFor"><span class="hs-identifier hs-type">waitFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411350"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411350"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-444"></span><span id="waitFor"><span class="annot"><span class="annottext">waitFor :: forall a. HasAgentConfig =&gt; IO (Maybe a) -&gt; IO a
</span><a href="IC.Test.Agent.html#waitFor"><span class="hs-identifier hs-var hs-var">waitFor</span></a></span></span><span> </span><span id="local-6989586621679410472"><span class="annot"><span class="annottext">IO (Maybe a)
</span><a href="#local-6989586621679410472"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-445"></span><span>    </span><span id="local-6989586621679410471"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679410471"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; IO a -&gt; IO (Maybe a)
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/System.Timeout.html#timeout"><span class="hs-identifier hs-var">timeout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AgentConfig -&gt; Int
</span><a href="IC.Test.Agent.html#tc_timeout"><span class="hs-identifier hs-var">tc_timeout</span></a></span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; AgentConfig
</span><a href="IC.Test.Agent.html#agentConfig"><span class="hs-identifier hs-var">agentConfig</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-glyph">::</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Real.html#%5E"><span class="hs-operator hs-var">^</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span class="hs-glyph">::</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679410468"><span class="hs-identifier hs-var">doActUntil</span></a></span><span>
</span><span id="line-446"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679410471"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Polling timed out&quot;</span></span><span>
</span><span id="line-447"></span><span>                   </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679410467"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410467"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410467"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-449"></span><span>    </span><span id="local-6989586621679410468"><span class="annot"><span class="annottext">doActUntil :: IO a
</span><a href="#local-6989586621679410468"><span class="hs-identifier hs-var hs-var">doActUntil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-450"></span><span>      </span><span id="local-6989586621679410466"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679410466"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe a)
</span><a href="#local-6989586621679410472"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-451"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679410466"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Conc.IO.html#threadDelay"><span class="hs-identifier hs-var">threadDelay</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679410468"><span class="hs-identifier hs-var">doActUntil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>                  </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679410464"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410464"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410464"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="annot"><a href="IC.Test.Agent.html#sync_height"><span class="hs-identifier hs-type">sync_height</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-455"></span><span id="sync_height"><span class="annot"><span class="annottext">sync_height :: HasAgentConfig =&gt; Blob -&gt; IO [()]
</span><a href="IC.Test.Agent.html#sync_height"><span class="hs-identifier hs-var hs-var">sync_height</span></a></span></span><span> </span><span id="local-6989586621679410423"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410423"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; [AgentSubnetConfig]
</span><a href="IC.Test.Agent.html#subnets"><span class="hs-identifier hs-var">subnets</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679410421"><span class="annot"><span class="annottext">AgentSubnetConfig
</span><a href="#local-6989586621679410421"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410420"><span class="annot"><span class="annottext">ranges :: [(Blob, Blob)]
</span><a href="#local-6989586621679410420"><span class="hs-identifier hs-var hs-var">ranges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679410419"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679410419"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410418"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679410418"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Blob
</span><a href="IC.Id.Fresh.html#wordToId%27"><span class="hs-identifier hs-var">wordToId'</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679410419"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Blob
</span><a href="IC.Id.Fresh.html#wordToId%27"><span class="hs-identifier hs-var">wordToId'</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679410418"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AgentSubnetConfig -&gt; [(Word64, Word64)]
</span><a href="IC.Test.Agent.html#tc_canister_ranges"><span class="hs-identifier hs-var">tc_canister_ranges</span></a></span><span> </span><span class="annot"><span class="annottext">AgentSubnetConfig
</span><a href="#local-6989586621679410421"><span class="hs-identifier hs-var">sub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679410414"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410414"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410413"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410413"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410414"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410423"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410423"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410413"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Blob, Blob)]
</span><a href="#local-6989586621679410420"><span class="hs-identifier hs-var">ranges</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-458"></span><span>    </span><span id="local-6989586621679410410"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679410410"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; IO [Natural]
</span><a href="#local-6989586621679410409"><span class="hs-identifier hs-var">get_heights</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AgentSubnetConfig -&gt; [[Char]]
</span><a href="IC.Test.Agent.html#tc_node_addresses"><span class="hs-identifier hs-var">tc_node_addresses</span></a></span><span> </span><span class="annot"><span class="annottext">AgentSubnetConfig
</span><a href="#local-6989586621679410421"><span class="hs-identifier hs-var">sub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410408"><span class="annot"><span class="annottext">h :: Natural
</span><a href="#local-6989586621679410408"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Foldable.html#maximum"><span class="hs-identifier hs-var">maximum</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679410410"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-460"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.OldList.html#nub"><span class="hs-identifier hs-var">nub</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679410410"><span class="hs-identifier hs-var">hs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-461"></span><span>      </span><span class="annot"><span class="annottext">forall a. HasAgentConfig =&gt; IO (Maybe a) -&gt; IO a
</span><a href="IC.Test.Agent.html#waitFor"><span class="hs-identifier hs-var">waitFor</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-462"></span><span>        </span><span id="local-6989586621679410404"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679410404"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; IO [Natural]
</span><a href="#local-6989586621679410409"><span class="hs-identifier hs-var">get_heights</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AgentSubnetConfig -&gt; [[Char]]
</span><a href="IC.Test.Agent.html#tc_node_addresses"><span class="hs-identifier hs-var">tc_node_addresses</span></a></span><span> </span><span class="annot"><span class="annottext">AgentSubnetConfig
</span><a href="#local-6989586621679410421"><span class="hs-identifier hs-var">sub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679410408"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Foldable.html#minimum"><span class="hs-identifier hs-var">minimum</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679410404"><span class="hs-identifier hs-var">hs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-465"></span><span>    </span><span id="local-6989586621679410409"><span class="annot"><span class="annottext">get_heights :: [[Char]] -&gt; IO [Natural]
</span><a href="#local-6989586621679410409"><span class="hs-identifier hs-var hs-var">get_heights</span></a></span></span><span> </span><span id="local-6989586621679410402"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679410402"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679410401"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410401"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-466"></span><span>      </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679410400"><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410400"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
[Char]
-&gt; Blob
-&gt; Blob
-&gt; [[Blob]]
-&gt; IO (Either (Int, [Char]) Certificate)
</span><a href="IC.Test.Agent.html#getStateCert%27%27"><span class="hs-identifier hs-var">getStateCert''</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410401"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="IC.Test.Agent.html#defaultUser"><span class="hs-identifier hs-var">defaultUser</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410423"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;time&quot;</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-467"></span><span>      </span><span class="annot"><span class="annottext">forall a.
(HasCallStack, CertVal a) =&gt;
Certificate -&gt; [Blob] -&gt; IO a
</span><a href="IC.Test.Agent.html#certValue"><span class="hs-identifier hs-var">certValue</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-bignum-1.2/src/GHC.Num.Natural.html#Natural"><span class="hs-identifier hs-type">Natural</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410400"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;time&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679410402"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span class="hs-comment">-- | Add envelope to CBOR request, add a nonce and expiry if it is not there,</span><span>
</span><span id="line-470"></span><span class="hs-comment">-- post to &quot;read&quot;, return decoded CBOR</span><span>
</span><span id="line-471"></span><span class="annot"><a href="IC.Test.Agent.html#queryCBOR"><span class="hs-identifier hs-type">queryCBOR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span>
</span><span id="line-472"></span><span id="queryCBOR"><span class="annot"><span class="annottext">queryCBOR :: (HasCallStack, HasAgentConfig) =&gt; Blob -&gt; GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#queryCBOR"><span class="hs-identifier hs-var hs-var">queryCBOR</span></a></span></span><span> </span><span id="local-6989586621679410389"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410389"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621679410388"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410388"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-473"></span><span>  </span><span class="annot"><span class="annottext">GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#addNonceExpiryEnv"><span class="hs-identifier hs-var">addNonceExpiryEnv</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410388"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postQueryCBOR"><span class="hs-identifier hs-var">postQueryCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410389"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Response Blob -&gt; IO GenR
</span><a href="IC.Test.Agent.html#okCBOR"><span class="hs-identifier hs-var">okCBOR</span></a></span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span class="hs-keyword">type</span><span> </span><span id="HTTPErrOr"><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-var">HTTPErrOr</span></a></span></span><span> </span><span id="local-6989586621679410387"><span class="annot"><a href="#local-6989586621679410387"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679410387"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span class="hs-comment">-- | Add envelope to CBOR, and a nonce and expiry if not there, post to</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- &quot;submit&quot;. Returns either a HTTP Error code, or if the status is 2xx, the</span><span>
</span><span id="line-479"></span><span class="hs-comment">-- request id.</span><span>
</span><span id="line-480"></span><span class="annot"><a href="IC.Test.Agent.html#submitCall%27"><span class="hs-identifier hs-type">submitCall'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-type">ReqStatus</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span id="submitCall%27"><span class="annot"><span class="annottext">submitCall' :: (HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; GenR -&gt; IO (HTTPErrOr (IO (HTTPErrOr ReqStatus)))
</span><a href="IC.Test.Agent.html#submitCall%27"><span class="hs-identifier hs-var hs-var">submitCall'</span></a></span></span><span> </span><span id="local-6989586621679410359"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410359"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621679410358"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410358"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-482"></span><span>  </span><span id="local-6989586621679410357"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410357"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#addNonce"><span class="hs-identifier hs-var">addNonce</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410358"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-483"></span><span>  </span><span id="local-6989586621679410356"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410356"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#addExpiry"><span class="hs-identifier hs-var">addExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410357"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-484"></span><span>  </span><span id="local-6989586621679410355"><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679410355"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#envelopeFor"><span class="hs-identifier hs-var">envelopeFor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenR -&gt; Blob
</span><a href="IC.Test.Agent.html#senderOf"><span class="hs-identifier hs-var">senderOf</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410356"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410356"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postCallCBOR"><span class="hs-identifier hs-var">postCallCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410359"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410354"><span class="annot"><span class="annottext">code :: Int
</span><a href="#local-6989586621679410354"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status -&gt; Int
</span><a href="file:///nix/store/lwjn4w0ddfm34a87vly061bh3il1hk19-http-types-0.12.3-doc/share/doc/http-types-0.12.3/html/src/Network.HTTP.Types.Status.html#statusCode"><span class="hs-identifier hs-var">statusCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall body. Response body -&gt; Status
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#responseStatus"><span class="hs-identifier hs-var">responseStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679410355"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">200</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679410354"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679410354"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">300</span></span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-488"></span><span>     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.html#null"><span class="hs-identifier hs-var">BS.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall body. Response body -&gt; body
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier hs-var">responseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679410355"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-489"></span><span>       </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; Blob -&gt; Blob -&gt; IO (HTTPErrOr ReqStatus)
</span><a href="IC.Test.Agent.html#getRequestStatus%27"><span class="hs-identifier hs-var">getRequestStatus'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenR -&gt; Blob
</span><a href="IC.Test.Agent.html#senderOf"><span class="hs-identifier hs-var">senderOf</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410356"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410359"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenR -&gt; Blob
</span><a href="IC.HTTP.RequestId.html#requestId"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410356"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-491"></span><span>       </span><span id="local-6989586621679410349"><span class="annot"><span class="annottext">ReqResponse
</span><a href="#local-6989586621679410349"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Either Text a -&gt; IO a
</span><a href="IC.Test.Agent.html#asRight"><span class="hs-identifier hs-var">asRight</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Either Text GenR
</span><a href="IC.HTTP.CBOR.html#decode"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall body. Response body -&gt; body
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier hs-var">responseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679410355"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">GenR -&gt; IO ReqResponse
</span><a href="IC.Test.Agent.html#callResponse"><span class="hs-identifier hs-var">callResponse</span></a></span><span>
</span><span id="line-492"></span><span>       </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ReqResponse -&gt; ReqStatus
</span><a href="IC.Test.Agent.html#Responded"><span class="hs-identifier hs-var">Responded</span></a></span><span> </span><span class="annot"><span class="annottext">ReqResponse
</span><a href="#local-6989586621679410349"><span class="hs-identifier hs-var">resp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-494"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410347"><span class="annot"><span class="annottext">msg :: [Char]
</span><a href="#local-6989586621679410347"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OnDecodeError -&gt; ByteString -&gt; Text
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Encoding.html#decodeUtf8With"><span class="hs-identifier hs-var">T.decodeUtf8With</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Encoding.Error.html#lenientDecode"><span class="hs-identifier hs-var">T.lenientDecode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blob -&gt; ByteString
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.Internal.html#toStrict"><span class="hs-identifier hs-var">BS.toStrict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Blob -&gt; Blob
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.html#take"><span class="hs-identifier hs-var">BS.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1000</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall body. Response body -&gt; body
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier hs-var">responseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679410355"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679410354"><span class="hs-identifier hs-var">code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410347"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="annot"><a href="IC.Test.Agent.html#submitCall"><span class="hs-identifier hs-type">submitCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-type">ReqStatus</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span id="submitCall"><span class="annot"><span class="annottext">submitCall :: (HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; GenR -&gt; IO (IO (HTTPErrOr ReqStatus))
</span><a href="IC.Test.Agent.html#submitCall"><span class="hs-identifier hs-var hs-var">submitCall</span></a></span></span><span> </span><span id="local-6989586621679410334"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410334"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621679410333"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410333"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; GenR -&gt; IO (HTTPErrOr (IO (HTTPErrOr ReqStatus)))
</span><a href="IC.Test.Agent.html#submitCall%27"><span class="hs-identifier hs-var">submitCall'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410334"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410333"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; HTTPErrOr a -&gt; IO a
</span><a href="IC.Test.Agent.html#is2xx"><span class="hs-identifier hs-var">is2xx</span></a></span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span class="hs-comment">-- | Add envelope to CBOR, and a nonce and expiry if not there, post to</span><span>
</span><span id="line-501"></span><span class="hs-comment">-- &quot;submit&quot;. Returns either a HTTP Error code, or if the status is 2xx, poll</span><span>
</span><span id="line-502"></span><span class="hs-comment">-- for the request response, and return decoded CBOR</span><span>
</span><span id="line-503"></span><span class="annot"><a href="IC.Test.Agent.html#awaitCall%27"><span class="hs-identifier hs-type">awaitCall'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span id="awaitCall%27"><span class="annot"><span class="annottext">awaitCall' :: (HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; GenR -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#awaitCall%27"><span class="hs-identifier hs-var hs-var">awaitCall'</span></a></span></span><span> </span><span id="local-6989586621679410324"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410324"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621679410323"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410323"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-505"></span><span>  </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; GenR -&gt; IO (HTTPErrOr (IO (HTTPErrOr ReqStatus)))
</span><a href="IC.Test.Agent.html#submitCall%27"><span class="hs-identifier hs-var">submitCall'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410324"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410323"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-506"></span><span>    </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679410322"><span class="annot"><span class="annottext">(Int, [Char])
</span><a href="#local-6989586621679410322"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, [Char])
</span><a href="#local-6989586621679410322"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>    </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679410321"><span class="annot"><span class="annottext">IO (HTTPErrOr ReqStatus)
</span><a href="#local-6989586621679410321"><span class="hs-identifier hs-var">getStatus</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt;
IO (HTTPErrOr ReqStatus) -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#awaitStatus%27"><span class="hs-identifier hs-var">awaitStatus'</span></a></span><span> </span><span class="annot"><span class="annottext">IO (HTTPErrOr ReqStatus)
</span><a href="#local-6989586621679410321"><span class="hs-identifier hs-var">getStatus</span></a></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span class="hs-comment">-- | Add envelope to CBOR, and a nonce and expiry if not there, post to</span><span>
</span><span id="line-510"></span><span class="hs-comment">-- &quot;submit&quot;, poll for the request response, and return decoded CBOR</span><span>
</span><span id="line-511"></span><span class="annot"><a href="IC.Test.Agent.html#awaitCall"><span class="hs-identifier hs-type">awaitCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span>
</span><span id="line-512"></span><span id="awaitCall"><span class="annot"><span class="annottext">awaitCall :: (HasCallStack, HasAgentConfig) =&gt; Blob -&gt; GenR -&gt; IO ReqResponse
</span><a href="IC.Test.Agent.html#awaitCall"><span class="hs-identifier hs-var hs-var">awaitCall</span></a></span></span><span> </span><span id="local-6989586621679410311"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410311"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621679410310"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410310"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; GenR -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#awaitCall%27"><span class="hs-identifier hs-var">awaitCall'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410311"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410310"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; HTTPErrOr a -&gt; IO a
</span><a href="IC.Test.Agent.html#is2xx"><span class="hs-identifier hs-var">is2xx</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span id="local-6989586621679411324"><span class="annot"><a href="IC.Test.Agent.html#is2xx"><span class="hs-identifier hs-type">is2xx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411324"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411324"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-515"></span><span id="is2xx"><span class="annot"><span class="annottext">is2xx :: forall a. HasCallStack =&gt; HTTPErrOr a -&gt; IO a
</span><a href="IC.Test.Agent.html#is2xx"><span class="hs-identifier hs-var hs-var">is2xx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-516"></span><span>    </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679410301"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679410301"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679410300"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410300"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Status &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679410301"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; is not 2xx:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410300"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-517"></span><span>    </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679410299"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410299"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410299"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="annot"><a href="IC.Test.Agent.html#getStateCert%27"><span class="hs-identifier hs-type">getStateCert'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Certificate.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span id="getStateCert%27"><span class="annot"><span class="annottext">getStateCert' :: (HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; Blob -&gt; [[Blob]] -&gt; IO (Either (Int, [Char]) Certificate)
</span><a href="IC.Test.Agent.html#getStateCert%27"><span class="hs-identifier hs-var hs-var">getStateCert'</span></a></span></span><span> </span><span id="local-6989586621679410289"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410289"><span class="hs-identifier hs-var">sender</span></a></span></span><span> </span><span id="local-6989586621679410288"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410288"><span class="hs-identifier hs-var">ecid</span></a></span></span><span> </span><span id="local-6989586621679410287"><span class="annot"><span class="annottext">[[Blob]]
</span><a href="#local-6989586621679410287"><span class="hs-identifier hs-var">paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-521"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; Blob -&gt; IO [()]
</span><a href="IC.Test.Agent.html#sync_height"><span class="hs-identifier hs-var">sync_height</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410288"><span class="hs-identifier hs-var">ecid</span></a></span><span>
</span><span id="line-522"></span><span>  </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
[Char]
-&gt; Blob
-&gt; Blob
-&gt; [[Blob]]
-&gt; IO (Either (Int, [Char]) Certificate)
</span><a href="IC.Test.Agent.html#getStateCert%27%27"><span class="hs-identifier hs-var">getStateCert''</span></a></span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; [Char]
</span><a href="IC.Test.Agent.html#endPoint"><span class="hs-identifier hs-var">endPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410289"><span class="hs-identifier hs-var">sender</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410288"><span class="hs-identifier hs-var">ecid</span></a></span><span> </span><span class="annot"><span class="annottext">[[Blob]]
</span><a href="#local-6989586621679410287"><span class="hs-identifier hs-var">paths</span></a></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="annot"><a href="IC.Test.Agent.html#decodeCert%27"><span class="hs-identifier hs-type">decodeCert'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Certificate.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a></span><span>
</span><span id="line-525"></span><span id="decodeCert%27"><span class="annot"><span class="annottext">decodeCert' :: HasCallStack =&gt; Blob -&gt; IO Certificate
</span><a href="IC.Test.Agent.html#decodeCert%27"><span class="hs-identifier hs-var hs-var">decodeCert'</span></a></span></span><span> </span><span id="local-6989586621679410281"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410281"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Either Text Certificate
</span><a href="IC.Certificate.CBOR.html#decodeCert"><span class="hs-identifier hs-var">decodeCert</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410281"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span class="annot"><a href="IC.Test.Agent.html#getStateCert%27%27"><span class="hs-identifier hs-type">getStateCert''</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Certificate.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span id="getStateCert%27%27"><span class="annot"><span class="annottext">getStateCert'' :: (HasCallStack, HasAgentConfig) =&gt;
[Char]
-&gt; Blob
-&gt; Blob
-&gt; [[Blob]]
-&gt; IO (Either (Int, [Char]) Certificate)
</span><a href="IC.Test.Agent.html#getStateCert%27%27"><span class="hs-identifier hs-var hs-var">getStateCert''</span></a></span></span><span> </span><span id="local-6989586621679410234"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410234"><span class="hs-identifier hs-var">ep</span></a></span></span><span> </span><span id="local-6989586621679410233"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410233"><span class="hs-identifier hs-var">sender</span></a></span></span><span> </span><span id="local-6989586621679410232"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410232"><span class="hs-identifier hs-var">ecid</span></a></span></span><span> </span><span id="local-6989586621679410231"><span class="annot"><span class="annottext">[[Blob]]
</span><a href="#local-6989586621679410231"><span class="hs-identifier hs-var">paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-529"></span><span>    </span><span id="local-6989586621679410230"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410230"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#addExpiry"><span class="hs-identifier hs-var">addExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[HashMap Text GenR] -&gt; GenR
</span><a href="IC.HTTP.GenR.html#rec"><span class="hs-identifier hs-var">rec</span></a></span><span>
</span><span id="line-530"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;request_type&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GText"><span class="hs-identifier hs-var">GText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;read_state&quot;</span></span><span>
</span><span id="line-531"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sender&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410233"><span class="hs-identifier hs-var">sender</span></a></span><span>
</span><span id="line-532"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;paths&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">[GenR] -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GList"><span class="hs-identifier hs-var">GList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenR] -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GList"><span class="hs-identifier hs-var">GList</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Blob]]
</span><a href="#local-6989586621679410231"><span class="hs-identifier hs-var">paths</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-534"></span><span>    </span><span id="local-6989586621679410228"><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679410228"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR -&gt; IO GenR
</span><a href="IC.Test.Agent.html#envelopeFor"><span class="hs-identifier hs-var">envelopeFor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenR -&gt; Blob
</span><a href="IC.Test.Agent.html#senderOf"><span class="hs-identifier hs-var">senderOf</span></a></span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410230"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410230"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
[Char] -&gt; Blob -&gt; GenR -&gt; IO (Response Blob)
</span><a href="IC.Test.Agent.html#postReadStateCBOR%27"><span class="hs-identifier hs-var">postReadStateCBOR'</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410234"><span class="hs-identifier hs-var">ep</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410232"><span class="hs-identifier hs-var">ecid</span></a></span><span>
</span><span id="line-535"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410227"><span class="annot"><span class="annottext">c :: Int
</span><a href="#local-6989586621679410227"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status -&gt; Int
</span><a href="file:///nix/store/lwjn4w0ddfm34a87vly061bh3il1hk19-http-types-0.12.3-doc/share/doc/http-types-0.12.3/html/src/Network.HTTP.Types.Status.html#statusCode"><span class="hs-identifier hs-var">statusCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall body. Response body -&gt; Status
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#responseStatus"><span class="hs-identifier hs-var">responseStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679410228"><span class="hs-identifier hs-var">response</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">200</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679410227"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679410227"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">300</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679410227"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Read_state request failed.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-538"></span><span>      </span><span id="local-6989586621679410226"><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410226"><span class="hs-identifier hs-var">gr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Response Blob -&gt; IO GenR
</span><a href="IC.Test.Agent.html#okCBOR"><span class="hs-identifier hs-var">okCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679410228"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-539"></span><span>      </span><span id="local-6989586621679410225"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410225"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; ExceptT Text IO a -&gt; IO a
</span><a href="IC.Test.Agent.html#asExceptT"><span class="hs-identifier hs-var">asExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
RecordM m a -&gt; GenR -&gt; m a
</span><a href="IC.HTTP.GenR.Parse.html#record"><span class="hs-identifier hs-var">record</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m a
</span><a href="IC.HTTP.GenR.Parse.html#field"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">Field Blob
</span><a href="IC.HTTP.GenR.Parse.html#blob"><span class="hs-identifier hs-var">blob</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;certificate&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenR
</span><a href="#local-6989586621679410226"><span class="hs-identifier hs-var">gr</span></a></span><span>
</span><span id="line-540"></span><span>      </span><span id="local-6989586621679410216"><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410216"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Blob -&gt; IO Certificate
</span><a href="IC.Test.Agent.html#decodeCert%27"><span class="hs-identifier hs-var">decodeCert'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410225"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-541"></span><span>      </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt; Blob -&gt; Certificate -&gt; IO ()
</span><a href="IC.Test.Agent.html#validateStateCert"><span class="hs-identifier hs-var">validateStateCert</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410232"><span class="hs-identifier hs-var">ecid</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410216"><span class="hs-identifier hs-var">cert</span></a></span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashTree -&gt; Either [Char] ()
</span><a href="IC.HashTree.html#wellFormed"><span class="hs-identifier hs-var">wellFormed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certificate -&gt; HashTree
</span><a href="IC.Certificate.html#cert_tree"><span class="hs-identifier hs-var">cert_tree</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410216"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-544"></span><span>          </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679410213"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410213"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Hash tree not well formed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410213"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-545"></span><span>          </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410216"><span class="hs-identifier hs-var">cert</span></a></span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span class="annot"><a href="IC.Test.Agent.html#getStateCert"><span class="hs-identifier hs-type">getStateCert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Certificate.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a></span><span>
</span><span id="line-550"></span><span id="getStateCert"><span class="annot"><span class="annottext">getStateCert :: (HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; Blob -&gt; [[Blob]] -&gt; IO Certificate
</span><a href="IC.Test.Agent.html#getStateCert"><span class="hs-identifier hs-var hs-var">getStateCert</span></a></span></span><span> </span><span id="local-6989586621679410204"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410204"><span class="hs-identifier hs-var">sender</span></a></span></span><span> </span><span id="local-6989586621679410203"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410203"><span class="hs-identifier hs-var">ecid</span></a></span></span><span> </span><span id="local-6989586621679410202"><span class="annot"><span class="annottext">[[Blob]]
</span><a href="#local-6989586621679410202"><span class="hs-identifier hs-var">paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; Blob -&gt; [[Blob]] -&gt; IO (Either (Int, [Char]) Certificate)
</span><a href="IC.Test.Agent.html#getStateCert%27"><span class="hs-identifier hs-var">getStateCert'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410204"><span class="hs-identifier hs-var">sender</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410203"><span class="hs-identifier hs-var">ecid</span></a></span><span> </span><span class="annot"><span class="annottext">[[Blob]]
</span><a href="#local-6989586621679410202"><span class="hs-identifier hs-var">paths</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; HTTPErrOr a -&gt; IO a
</span><a href="IC.Test.Agent.html#is2xx"><span class="hs-identifier hs-var">is2xx</span></a></span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="annot"><a href="IC.Test.Agent.html#extractCertData"><span class="hs-identifier hs-type">extractCertData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-553"></span><span id="extractCertData"><span class="annot"><span class="annottext">extractCertData :: Blob -&gt; Blob -&gt; IO Blob
</span><a href="IC.Test.Agent.html#extractCertData"><span class="hs-identifier hs-var hs-var">extractCertData</span></a></span></span><span> </span><span id="local-6989586621679410201"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410201"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621679410200"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410200"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-554"></span><span>  </span><span id="local-6989586621679410199"><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410199"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Blob -&gt; IO Certificate
</span><a href="IC.Test.Agent.html#decodeCert%27"><span class="hs-identifier hs-var">decodeCert'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410200"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-555"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashTree -&gt; Either [Char] ()
</span><a href="IC.HashTree.html#wellFormed"><span class="hs-identifier hs-var">wellFormed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certificate -&gt; HashTree
</span><a href="IC.Certificate.html#cert_tree"><span class="hs-identifier hs-var">cert_tree</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410199"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-556"></span><span>      </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679410198"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410198"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Hash tree not well formed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410198"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-557"></span><span>      </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>  </span><span class="annot"><span class="annottext">forall a.
(HasCallStack, CertVal a) =&gt;
Certificate -&gt; [Blob] -&gt; IO a
</span><a href="IC.Test.Agent.html#certValue"><span class="hs-identifier hs-var">certValue</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410199"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;canister&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410201"><span class="hs-identifier hs-var">cid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;certified_data&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span class="annot"><a href="IC.Test.Agent.html#verboseVerify"><span class="hs-identifier hs-type">verboseVerify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span id="verboseVerify"><span class="annot"><span class="annottext">verboseVerify :: [Char] -&gt; Blob -&gt; Blob -&gt; Blob -&gt; Blob -&gt; IO ()
</span><a href="IC.Test.Agent.html#verboseVerify"><span class="hs-identifier hs-var hs-var">verboseVerify</span></a></span></span><span> </span><span id="local-6989586621679410196"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410196"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621679410195"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410195"><span class="hs-identifier hs-var">domain_sep</span></a></span></span><span> </span><span id="local-6989586621679410194"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410194"><span class="hs-identifier hs-var">pk</span></a></span></span><span> </span><span id="local-6989586621679410193"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410193"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679410192"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410192"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-562"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Blob -&gt; Blob -&gt; Blob -&gt; Either Text ()
</span><a href="IC.Crypto.DER_BLS.html#verify"><span class="hs-identifier hs-var">DER_BLS.verify</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410195"><span class="hs-identifier hs-var">domain_sep</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410194"><span class="hs-identifier hs-var">pk</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410193"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410192"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-563"></span><span>        </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679410190"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679410190"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.OldList.html#unlines"><span class="hs-identifier hs-var">unlines</span></a></span><span>
</span><span id="line-564"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Signature verification failed on &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410196"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-565"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679410190"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-566"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Domain separator:   &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#prettyBlob"><span class="hs-identifier hs-var">prettyBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410195"><span class="hs-identifier hs-var">domain_sep</span></a></span><span>
</span><span id="line-567"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Public key (DER):   &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#asHex"><span class="hs-identifier hs-var">asHex</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410194"><span class="hs-identifier hs-var">pk</span></a></span><span>
</span><span id="line-568"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Public key decoded: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-569"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Either Text (Suite, Blob)
</span><a href="IC.Crypto.DER.html#decode"><span class="hs-identifier hs-var">DER.decode</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410194"><span class="hs-identifier hs-var">pk</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-570"></span><span>                 </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679410186"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679410186"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679410186"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-571"></span><span>                 </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679410185"><span class="annot"><span class="annottext">Suite
</span><a href="#local-6989586621679410185"><span class="hs-identifier hs-var">suite</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410184"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410184"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#asHex"><span class="hs-identifier hs-var">asHex</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410184"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; (&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Suite
</span><a href="#local-6989586621679410185"><span class="hs-identifier hs-var">suite</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-572"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Signature:          &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#asHex"><span class="hs-identifier hs-var">asHex</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410192"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-573"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Checked message:    &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#prettyBlob"><span class="hs-identifier hs-var">prettyBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410193"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-574"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-575"></span><span>        </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span class="annot"><a href="IC.Test.Agent.html#validateDelegation"><span class="hs-identifier hs-type">validateDelegation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="IC.Certificate.html#Delegation"><span class="hs-identifier hs-type">Delegation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-578"></span><span id="validateDelegation"><span class="annot"><span class="annottext">validateDelegation :: (HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; Maybe Delegation -&gt; IO Blob
</span><a href="IC.Test.Agent.html#validateDelegation"><span class="hs-identifier hs-var hs-var">validateDelegation</span></a></span></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Delegation
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AgentConfig -&gt; Blob
</span><a href="IC.Test.Agent.html#tc_root_key"><span class="hs-identifier hs-var">tc_root_key</span></a></span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; AgentConfig
</span><a href="IC.Test.Agent.html#agentConfig"><span class="hs-identifier hs-var">agentConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span class="annot"><a href="IC.Test.Agent.html#validateDelegation"><span class="hs-identifier hs-var">validateDelegation</span></a></span><span> </span><span id="local-6989586621679410151"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410151"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679410150"><span class="annot"><span class="annottext">Delegation
</span><a href="#local-6989586621679410150"><span class="hs-identifier hs-var">del</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-580"></span><span>    </span><span id="local-6989586621679410149"><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410149"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Blob -&gt; IO Certificate
</span><a href="IC.Test.Agent.html#decodeCert%27"><span class="hs-identifier hs-var">decodeCert'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delegation -&gt; Blob
</span><a href="IC.Certificate.html#del_certificate"><span class="hs-identifier hs-var">del_certificate</span></a></span><span> </span><span class="annot"><span class="annottext">Delegation
</span><a href="#local-6989586621679410150"><span class="hs-identifier hs-var">del</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashTree -&gt; Either [Char] ()
</span><a href="IC.HashTree.html#wellFormed"><span class="hs-identifier hs-var">wellFormed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certificate -&gt; HashTree
</span><a href="IC.Certificate.html#cert_tree"><span class="hs-identifier hs-var">cert_tree</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410149"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-582"></span><span>        </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679410147"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410147"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Hash tree not well formed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410147"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-583"></span><span>        </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
[Char] -&gt; Blob -&gt; Certificate -&gt; IO ()
</span><a href="IC.Test.Agent.html#validateStateCert%27"><span class="hs-identifier hs-var">validateStateCert'</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;certificate delegation&quot;</span></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410151"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410149"><span class="hs-identifier hs-var">cert</span></a></span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span>    </span><span id="local-6989586621679410145"><span class="annot"><span class="annottext">[(Blob, Blob)]
</span><a href="#local-6989586621679410145"><span class="hs-identifier hs-var">ranges</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
(HasCallStack, CertVal a) =&gt;
Certificate -&gt; [Blob] -&gt; IO a
</span><a href="IC.Test.Agent.html#certValue"><span class="hs-identifier hs-var">certValue</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410149"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;subnet&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Delegation -&gt; Blob
</span><a href="IC.Certificate.html#del_subnet_id"><span class="hs-identifier hs-var">del_subnet_id</span></a></span><span> </span><span class="annot"><span class="annottext">Delegation
</span><a href="#local-6989586621679410150"><span class="hs-identifier hs-var">del</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;canister_ranges&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; IO [(Blob, Blob)]
</span><a href="IC.Test.Agent.html#asCBORBlobPairList"><span class="hs-identifier hs-var">asCBORBlobPairList</span></a></span><span>
</span><span id="line-587"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Blob, Blob)] -&gt; Blob -&gt; Bool
</span><a href="IC.Id.Fresh.html#checkCanisterIdInRanges%27"><span class="hs-identifier hs-var">checkCanisterIdInRanges'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Blob, Blob)]
</span><a href="#local-6989586621679410145"><span class="hs-identifier hs-var">ranges</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410151"><span class="hs-identifier hs-var">cid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a e. Exception e =&gt; e -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Exception.html#throw"><span class="hs-identifier hs-var">throw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Blob, Blob)] -&gt; Blob -&gt; DelegationCanisterRangeCheck
</span><a href="IC.Test.Agent.html#DelegationCanisterRangeCheck"><span class="hs-identifier hs-var">DelegationCanisterRangeCheck</span></a></span><span> </span><span class="annot"><span class="annottext">[(Blob, Blob)]
</span><a href="#local-6989586621679410145"><span class="hs-identifier hs-var">ranges</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410151"><span class="hs-identifier hs-var">cid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span>    </span><span class="annot"><span class="annottext">forall a.
(HasCallStack, CertVal a) =&gt;
Certificate -&gt; [Blob] -&gt; IO a
</span><a href="IC.Test.Agent.html#certValue"><span class="hs-identifier hs-var">certValue</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410149"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;subnet&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Delegation -&gt; Blob
</span><a href="IC.Certificate.html#del_subnet_id"><span class="hs-identifier hs-var">del_subnet_id</span></a></span><span> </span><span class="annot"><span class="annottext">Delegation
</span><a href="#local-6989586621679410150"><span class="hs-identifier hs-var">del</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;public_key&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span class="annot"><a href="IC.Test.Agent.html#validateStateCert%27"><span class="hs-identifier hs-type">validateStateCert'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Certificate.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span id="validateStateCert%27"><span class="annot"><span class="annottext">validateStateCert' :: (HasCallStack, HasAgentConfig) =&gt;
[Char] -&gt; Blob -&gt; Certificate -&gt; IO ()
</span><a href="IC.Test.Agent.html#validateStateCert%27"><span class="hs-identifier hs-var hs-var">validateStateCert'</span></a></span></span><span> </span><span id="local-6989586621679410135"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410135"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621679410134"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410134"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621679410133"><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410133"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-593"></span><span>    </span><span id="local-6989586621679410132"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410132"><span class="hs-identifier hs-var">pk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; Maybe Delegation -&gt; IO Blob
</span><a href="IC.Test.Agent.html#validateDelegation"><span class="hs-identifier hs-var">validateDelegation</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410134"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certificate -&gt; Maybe Delegation
</span><a href="IC.Certificate.html#cert_delegation"><span class="hs-identifier hs-var">cert_delegation</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410133"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-594"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Blob -&gt; Blob -&gt; Blob -&gt; Blob -&gt; IO ()
</span><a href="IC.Test.Agent.html#verboseVerify"><span class="hs-identifier hs-var">verboseVerify</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410135"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;ic-state-root&quot;</span></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410132"><span class="hs-identifier hs-var">pk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashTree -&gt; Blob
</span><a href="IC.HashTree.html#reconstruct"><span class="hs-identifier hs-var">reconstruct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certificate -&gt; HashTree
</span><a href="IC.Certificate.html#cert_tree"><span class="hs-identifier hs-var">cert_tree</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410133"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certificate -&gt; Blob
</span><a href="IC.Certificate.html#cert_sig"><span class="hs-identifier hs-var">cert_sig</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410133"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span class="annot"><a href="IC.Test.Agent.html#validateStateCert"><span class="hs-identifier hs-type">validateStateCert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Certificate.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span id="validateStateCert"><span class="annot"><span class="annottext">validateStateCert :: (HasCallStack, HasAgentConfig) =&gt; Blob -&gt; Certificate -&gt; IO ()
</span><a href="IC.Test.Agent.html#validateStateCert"><span class="hs-identifier hs-var hs-var">validateStateCert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
[Char] -&gt; Blob -&gt; Certificate -&gt; IO ()
</span><a href="IC.Test.Agent.html#validateStateCert%27"><span class="hs-identifier hs-var">validateStateCert'</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;certificate&quot;</span></span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span class="hs-keyword">data</span><span> </span><span id="ReqResponse"><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-var">ReqResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Reply"><span class="annot"><a href="IC.Test.Agent.html#Reply"><span class="hs-identifier hs-var">Reply</span></a></span></span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Reject"><span class="annot"><a href="IC.Test.Agent.html#Reject"><span class="hs-identifier hs-var">Reject</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-bignum-1.2/src/GHC.Num.Natural.html#Natural"><span class="hs-identifier hs-type">Natural</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">T.Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">T.Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679410113"><span id="local-6989586621679410120"><span class="annot"><span class="annottext">ReqResponse -&gt; ReqResponse -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ReqResponse -&gt; ReqResponse -&gt; Bool
$c/= :: ReqResponse -&gt; ReqResponse -&gt; Bool
== :: ReqResponse -&gt; ReqResponse -&gt; Bool
$c== :: ReqResponse -&gt; ReqResponse -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410098"><span id="local-6989586621679410100"><span id="local-6989586621679410110"><span class="annot"><span class="annottext">Int -&gt; ReqResponse -&gt; ShowS
[ReqResponse] -&gt; ShowS
ReqResponse -&gt; [Char]
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ReqResponse] -&gt; ShowS
$cshowList :: [ReqResponse] -&gt; ShowS
show :: ReqResponse -&gt; [Char]
$cshow :: ReqResponse -&gt; [Char]
showsPrec :: Int -&gt; ReqResponse -&gt; ShowS
$cshowsPrec :: Int -&gt; ReqResponse -&gt; ShowS
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span class="hs-keyword">data</span><span> </span><span id="ReqStatus"><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-var">ReqStatus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Processing"><span class="annot"><a href="IC.Test.Agent.html#Processing"><span class="hs-identifier hs-var">Processing</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Pending"><span class="annot"><a href="IC.Test.Agent.html#Pending"><span class="hs-identifier hs-var">Pending</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Responded"><span class="annot"><a href="IC.Test.Agent.html#Responded"><span class="hs-identifier hs-var">Responded</span></a></span></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="UnknownStatus"><span class="annot"><a href="IC.Test.Agent.html#UnknownStatus"><span class="hs-identifier hs-var">UnknownStatus</span></a></span></span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679410090"><span id="local-6989586621679410093"><span class="annot"><span class="annottext">ReqStatus -&gt; ReqStatus -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ReqStatus -&gt; ReqStatus -&gt; Bool
$c/= :: ReqStatus -&gt; ReqStatus -&gt; Bool
== :: ReqStatus -&gt; ReqStatus -&gt; Bool
$c== :: ReqStatus -&gt; ReqStatus -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410082"><span id="local-6989586621679410084"><span id="local-6989586621679410088"><span class="annot"><span class="annottext">Int -&gt; ReqStatus -&gt; ShowS
[ReqStatus] -&gt; ShowS
ReqStatus -&gt; [Char]
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ReqStatus] -&gt; ShowS
$cshowList :: [ReqStatus] -&gt; ShowS
show :: ReqStatus -&gt; [Char]
$cshow :: ReqStatus -&gt; [Char]
showsPrec :: Int -&gt; ReqStatus -&gt; ShowS
$cshowsPrec :: Int -&gt; ReqStatus -&gt; ShowS
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span class="annot"><a href="IC.Test.Agent.html#prettyPath"><span class="hs-identifier hs-type">prettyPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-605"></span><span id="prettyPath"><span class="annot"><span class="annottext">prettyPath :: [Blob] -&gt; [Char]
</span><a href="IC.Test.Agent.html#prettyPath"><span class="hs-identifier hs-var hs-var">prettyPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ShowS
</span><a href="IC.Test.Agent.html#shorten"><span class="hs-identifier hs-var">shorten</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#prettyBlob"><span class="hs-identifier hs-var">prettyBlob</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span class="annot"><a href="IC.Test.Agent.html#prettyBlob"><span class="hs-identifier hs-type">prettyBlob</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-608"></span><span id="prettyBlob"><span class="annot"><span class="annottext">prettyBlob :: Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#prettyBlob"><span class="hs-identifier hs-var hs-var">prettyBlob</span></a></span></span><span> </span><span id="local-6989586621679410079"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410079"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-609"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410078"><span class="annot"><span class="annottext">s :: [Char]
</span><a href="#local-6989586621679410078"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Char.html#chr"><span class="hs-identifier hs-var">chr</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blob -&gt; [Word8]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.html#unpack"><span class="hs-identifier hs-var">BS.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410079"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-610"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Unicode.html#isPrint"><span class="hs-identifier hs-var">isPrint</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410078"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679410078"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#asHex"><span class="hs-identifier hs-var">asHex</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410079"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span id="local-6989586621679411295"><span class="annot"><a href="IC.Test.Agent.html#maybeCertValue"><span class="hs-identifier hs-type">maybeCertValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Certificate.Value.html#CertVal"><span class="hs-identifier hs-type">CertVal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411295"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Certificate.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411295"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-613"></span><span id="maybeCertValue"><span class="annot"><span class="annottext">maybeCertValue :: forall a.
(HasCallStack, CertVal a) =&gt;
Certificate -&gt; [Blob] -&gt; IO (Maybe a)
</span><a href="IC.Test.Agent.html#maybeCertValue"><span class="hs-identifier hs-var hs-var">maybeCertValue</span></a></span></span><span> </span><span id="local-6989586621679410056"><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410056"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679410055"><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410055"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashTree -&gt; [Blob] -&gt; Res
</span><a href="IC.HashTree.html#lookupPath"><span class="hs-identifier hs-var">lookupPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certificate -&gt; HashTree
</span><a href="IC.Certificate.html#cert_tree"><span class="hs-identifier hs-var">cert_tree</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410056"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410055"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-614"></span><span>    </span><span class="annot"><a href="IC.HashTree.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span id="local-6989586621679410052"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410052"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. CertVal a =&gt; Blob -&gt; Maybe a
</span><a href="IC.Certificate.Value.html#fromCertVal"><span class="hs-identifier hs-var">fromCertVal</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410052"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-615"></span><span>      </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679410050"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410050"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410050"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>      </span><span class="annot"><span class="annottext">Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot parse &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Blob] -&gt; [Char]
</span><a href="IC.Test.Agent.html#prettyPath"><span class="hs-identifier hs-var">prettyPath</span></a></span><span> </span><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410055"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; from &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410052"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-617"></span><span>    </span><span class="annot"><span class="annottext">Res
</span><a href="IC.HashTree.html#Absent"><span class="hs-identifier hs-var">Absent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-618"></span><span>    </span><span id="local-6989586621679410048"><span class="annot"><span class="annottext">Res
</span><a href="#local-6989586621679410048"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected to find &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Blob] -&gt; [Char]
</span><a href="IC.Test.Agent.html#prettyPath"><span class="hs-identifier hs-var">prettyPath</span></a></span><span> </span><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410055"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;, but got &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Res
</span><a href="#local-6989586621679410048"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span id="local-6989586621679411330"><span class="annot"><a href="IC.Test.Agent.html#certValue"><span class="hs-identifier hs-type">certValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Certificate.Value.html#CertVal"><span class="hs-identifier hs-type">CertVal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411330"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Certificate.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411330"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-621"></span><span id="certValue"><span class="annot"><span class="annottext">certValue :: forall a.
(HasCallStack, CertVal a) =&gt;
Certificate -&gt; [Blob] -&gt; IO a
</span><a href="IC.Test.Agent.html#certValue"><span class="hs-identifier hs-var hs-var">certValue</span></a></span></span><span> </span><span id="local-6989586621679410033"><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410033"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679410032"><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410032"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashTree -&gt; [Blob] -&gt; Res
</span><a href="IC.HashTree.html#lookupPath"><span class="hs-identifier hs-var">lookupPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certificate -&gt; HashTree
</span><a href="IC.Certificate.html#cert_tree"><span class="hs-identifier hs-var">cert_tree</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410033"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410032"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-622"></span><span>    </span><span class="annot"><a href="IC.HashTree.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span id="local-6989586621679410031"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410031"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. CertVal a =&gt; Blob -&gt; Maybe a
</span><a href="IC.Certificate.Value.html#fromCertVal"><span class="hs-identifier hs-var">fromCertVal</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410031"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-623"></span><span>      </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679410030"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410030"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410030"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-624"></span><span>      </span><span class="annot"><span class="annottext">Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot parse &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Blob] -&gt; [Char]
</span><a href="IC.Test.Agent.html#prettyPath"><span class="hs-identifier hs-var">prettyPath</span></a></span><span> </span><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410032"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; from &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679410031"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-625"></span><span>    </span><span id="local-6989586621679410029"><span class="annot"><span class="annottext">Res
</span><a href="#local-6989586621679410029"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected to find &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Blob] -&gt; [Char]
</span><a href="IC.Test.Agent.html#prettyPath"><span class="hs-identifier hs-var">prettyPath</span></a></span><span> </span><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410032"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;, but got &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Res
</span><a href="#local-6989586621679410029"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span class="annot"><a href="IC.Test.Agent.html#certValueAbsent"><span class="hs-identifier hs-type">certValueAbsent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Certificate.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span id="certValueAbsent"><span class="annot"><span class="annottext">certValueAbsent :: HasCallStack =&gt; Certificate -&gt; [Blob] -&gt; IO ()
</span><a href="IC.Test.Agent.html#certValueAbsent"><span class="hs-identifier hs-var hs-var">certValueAbsent</span></a></span></span><span> </span><span id="local-6989586621679410021"><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410021"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679410020"><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410020"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashTree -&gt; [Blob] -&gt; Res
</span><a href="IC.HashTree.html#lookupPath"><span class="hs-identifier hs-var">lookupPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certificate -&gt; HashTree
</span><a href="IC.Certificate.html#cert_tree"><span class="hs-identifier hs-var">cert_tree</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679410021"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410020"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-629"></span><span>    </span><span class="annot"><span class="annottext">Res
</span><a href="IC.HashTree.html#Absent"><span class="hs-identifier hs-var">Absent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>    </span><span id="local-6989586621679410019"><span class="annot"><span class="annottext">Res
</span><a href="#local-6989586621679410019"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Path &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Blob] -&gt; [Char]
</span><a href="IC.Test.Agent.html#prettyPath"><span class="hs-identifier hs-var">prettyPath</span></a></span><span> </span><span class="annot"><span class="annottext">[Blob]
</span><a href="#local-6989586621679410020"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; should be absent, but got &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Res
</span><a href="#local-6989586621679410019"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span class="annot"><a href="IC.Test.Agent.html#getRequestStatus%27"><span class="hs-identifier hs-type">getRequestStatus'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-type">ReqStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span id="getRequestStatus%27"><span class="annot"><span class="annottext">getRequestStatus' :: (HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; Blob -&gt; Blob -&gt; IO (HTTPErrOr ReqStatus)
</span><a href="IC.Test.Agent.html#getRequestStatus%27"><span class="hs-identifier hs-var hs-var">getRequestStatus'</span></a></span></span><span> </span><span id="local-6989586621679409946"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409946"><span class="hs-identifier hs-var">sender</span></a></span></span><span> </span><span id="local-6989586621679409945"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409945"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621679409944"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409944"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-634"></span><span>    </span><span id="local-6989586621679409943"><span class="annot"><span class="annottext">Either (Int, [Char]) Certificate
</span><a href="#local-6989586621679409943"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; Blob -&gt; [[Blob]] -&gt; IO (Either (Int, [Char]) Certificate)
</span><a href="IC.Test.Agent.html#getStateCert%27"><span class="hs-identifier hs-var">getStateCert'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409946"><span class="hs-identifier hs-var">sender</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409945"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;request_status&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409944"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-635"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (Int, [Char]) Certificate
</span><a href="#local-6989586621679409943"><span class="hs-identifier hs-var">response</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-636"></span><span>      </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679409942"><span class="annot"><span class="annottext">(Int, [Char])
</span><a href="#local-6989586621679409942"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, [Char])
</span><a href="#local-6989586621679409942"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-637"></span><span>      </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679409941"><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679409941"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashTree -&gt; [Blob] -&gt; Res
</span><a href="IC.HashTree.html#lookupPath"><span class="hs-identifier hs-var">lookupPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certificate -&gt; HashTree
</span><a href="IC.Certificate.html#cert_tree"><span class="hs-identifier hs-var">cert_tree</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679409941"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;request_status&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409944"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;status&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-640"></span><span>          </span><span class="annot"><span class="annottext">Res
</span><a href="IC.HashTree.html#Absent"><span class="hs-identifier hs-var">Absent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ReqStatus
</span><a href="IC.Test.Agent.html#UnknownStatus"><span class="hs-identifier hs-var">UnknownStatus</span></a></span><span>
</span><span id="line-641"></span><span>          </span><span class="annot"><a href="IC.HashTree.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;processing&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ReqStatus
</span><a href="IC.Test.Agent.html#Processing"><span class="hs-identifier hs-var">Processing</span></a></span><span>
</span><span id="line-642"></span><span>          </span><span class="annot"><a href="IC.HashTree.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;received&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ReqStatus
</span><a href="IC.Test.Agent.html#Pending"><span class="hs-identifier hs-var">Pending</span></a></span><span>
</span><span id="line-643"></span><span>          </span><span class="annot"><a href="IC.HashTree.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;replied&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-644"></span><span>            </span><span id="local-6989586621679409940"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409940"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
(HasCallStack, CertVal a) =&gt;
Certificate -&gt; [Blob] -&gt; IO a
</span><a href="IC.Test.Agent.html#certValue"><span class="hs-identifier hs-var">certValue</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679409941"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;request_status&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409944"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;reply&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-645"></span><span>            </span><span class="annot"><span class="annottext">HasCallStack =&gt; Certificate -&gt; [Blob] -&gt; IO ()
</span><a href="IC.Test.Agent.html#certValueAbsent"><span class="hs-identifier hs-var">certValueAbsent</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679409941"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;request_status&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409944"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;reject_code&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-646"></span><span>            </span><span class="annot"><span class="annottext">HasCallStack =&gt; Certificate -&gt; [Blob] -&gt; IO ()
</span><a href="IC.Test.Agent.html#certValueAbsent"><span class="hs-identifier hs-var">certValueAbsent</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679409941"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;request_status&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409944"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;reject_message&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-647"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ReqResponse -&gt; ReqStatus
</span><a href="IC.Test.Agent.html#Responded"><span class="hs-identifier hs-var">Responded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blob -&gt; ReqResponse
</span><a href="IC.Test.Agent.html#Reply"><span class="hs-identifier hs-var">Reply</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409940"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>          </span><span class="annot"><a href="IC.HashTree.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;rejected&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-649"></span><span>            </span><span class="annot"><span class="annottext">HasCallStack =&gt; Certificate -&gt; [Blob] -&gt; IO ()
</span><a href="IC.Test.Agent.html#certValueAbsent"><span class="hs-identifier hs-var">certValueAbsent</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679409941"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;request_status&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409944"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;reply&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-650"></span><span>            </span><span id="local-6989586621679409939"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409939"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
(HasCallStack, CertVal a) =&gt;
Certificate -&gt; [Blob] -&gt; IO a
</span><a href="IC.Test.Agent.html#certValue"><span class="hs-identifier hs-var">certValue</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679409941"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;request_status&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409944"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;reject_code&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-651"></span><span>            </span><span id="local-6989586621679409938"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409938"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
(HasCallStack, CertVal a) =&gt;
Certificate -&gt; [Blob] -&gt; IO a
</span><a href="IC.Test.Agent.html#certValue"><span class="hs-identifier hs-var">certValue</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679409941"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;request_status&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409944"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;reject_message&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-652"></span><span>            </span><span id="local-6989586621679409937"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679409937"><span class="hs-identifier hs-var">errorCode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
(HasCallStack, CertVal a) =&gt;
Certificate -&gt; [Blob] -&gt; IO (Maybe a)
</span><a href="IC.Test.Agent.html#maybeCertValue"><span class="hs-identifier hs-var">maybeCertValue</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679409941"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;request_status&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409944"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;error_code&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-653"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ReqResponse -&gt; ReqStatus
</span><a href="IC.Test.Agent.html#Responded"><span class="hs-identifier hs-var">Responded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Text -&gt; Maybe Text -&gt; ReqResponse
</span><a href="IC.Test.Agent.html#Reject"><span class="hs-identifier hs-var">Reject</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409939"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409938"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679409937"><span class="hs-identifier hs-var">errorCode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>          </span><span class="annot"><a href="IC.HashTree.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span id="local-6989586621679409936"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409936"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Unexpected status &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409936"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-655"></span><span>          </span><span class="hs-comment">-- This case should not happen with a compliant IC, but let</span><span>
</span><span id="line-656"></span><span>          </span><span class="hs-comment">-- us be liberal here, and strict in a dedicated test</span><span>
</span><span id="line-657"></span><span>          </span><span class="annot"><span class="annottext">Res
</span><a href="IC.HashTree.html#Unknown"><span class="hs-identifier hs-var">Unknown</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ReqStatus
</span><a href="IC.Test.Agent.html#UnknownStatus"><span class="hs-identifier hs-var">UnknownStatus</span></a></span><span>
</span><span id="line-658"></span><span>          </span><span id="local-6989586621679409934"><span class="annot"><span class="annottext">Res
</span><a href="#local-6989586621679409934"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Unexpected request status, got &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Res
</span><a href="#local-6989586621679409934"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span class="annot"><a href="IC.Test.Agent.html#getRequestStatus"><span class="hs-identifier hs-type">getRequestStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-type">ReqStatus</span></a></span><span>
</span><span id="line-661"></span><span id="getRequestStatus"><span class="annot"><span class="annottext">getRequestStatus :: (HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; Blob -&gt; Blob -&gt; IO ReqStatus
</span><a href="IC.Test.Agent.html#getRequestStatus"><span class="hs-identifier hs-var hs-var">getRequestStatus</span></a></span></span><span> </span><span id="local-6989586621679409925"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409925"><span class="hs-identifier hs-var">sender</span></a></span></span><span> </span><span id="local-6989586621679409924"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409924"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621679409923"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409923"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; Blob -&gt; Blob -&gt; IO (HTTPErrOr ReqStatus)
</span><a href="IC.Test.Agent.html#getRequestStatus%27"><span class="hs-identifier hs-var">getRequestStatus'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409925"><span class="hs-identifier hs-var">sender</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409924"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409923"><span class="hs-identifier hs-var">rid</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; HTTPErrOr a -&gt; IO a
</span><a href="IC.Test.Agent.html#is2xx"><span class="hs-identifier hs-var">is2xx</span></a></span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="annot"><a href="IC.Test.Agent.html#isResponded"><span class="hs-identifier hs-type">isResponded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-type">ReqStatus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#Assertion"><span class="hs-identifier hs-type">Assertion</span></a></span><span>
</span><span id="line-664"></span><span id="isResponded"><span class="annot"><span class="annottext">isResponded :: ReqStatus -&gt; IO ()
</span><a href="IC.Test.Agent.html#isResponded"><span class="hs-identifier hs-var hs-var">isResponded</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#Responded"><span class="hs-identifier hs-type">Responded</span></a></span><span> </span><span class="annot"><span class="annottext">ReqResponse
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span class="annot"><a href="IC.Test.Agent.html#isResponded"><span class="hs-identifier hs-var">isResponded</span></a></span><span> </span><span class="annot"><span class="annottext">ReqStatus
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Request must be responded&quot;</span></span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span id="local-6989586621679411290"><span class="annot"><a href="IC.Test.Agent.html#loop%27"><span class="hs-identifier hs-type">loop'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411290"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411290"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-668"></span><span id="loop%27"><span class="annot"><span class="annottext">loop' :: forall a.
(HasCallStack, HasAgentConfig) =&gt;
IO (HTTPErrOr (Maybe a)) -&gt; IO (HTTPErrOr a)
</span><a href="IC.Test.Agent.html#loop%27"><span class="hs-identifier hs-var hs-var">loop'</span></a></span></span><span> </span><span id="local-6989586621679409906"><span class="annot"><span class="annottext">IO (HTTPErrOr (Maybe a))
</span><a href="#local-6989586621679409906"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/time-1.11.1.1/src/Data.Time.Clock.POSIX.html#getCurrentTime"><span class="hs-identifier hs-var">getCurrentTime</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; IO (HTTPErrOr a)
</span><a href="#local-6989586621679409904"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-670"></span><span>    </span><span id="local-6989586621679409904"><span class="annot"><span class="annottext">go :: UTCTime -&gt; IO (HTTPErrOr a)
</span><a href="#local-6989586621679409904"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679409903"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679409903"><span class="hs-identifier hs-var">init</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (HTTPErrOr (Maybe a))
</span><a href="#local-6989586621679409906"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-671"></span><span>      </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679409902"><span class="annot"><span class="annottext">(Int, [Char])
</span><a href="#local-6989586621679409902"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, [Char])
</span><a href="#local-6989586621679409902"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-672"></span><span>      </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679409901"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409901"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409901"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-673"></span><span>      </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-674"></span><span>        </span><span id="local-6989586621679409900"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679409900"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/time-1.11.1.1/src/Data.Time.Clock.POSIX.html#getCurrentTime"><span class="hs-identifier hs-var">getCurrentTime</span></a></span><span>
</span><span id="line-675"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; POSIXTime
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/time-1.11.1.1/src/Data.Time.Clock.Internal.UTCDiff.html#diffUTCTime"><span class="hs-identifier hs-var">diffUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679409900"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679409903"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AgentConfig -&gt; Int
</span><a href="IC.Test.Agent.html#tc_timeout"><span class="hs-identifier hs-var">tc_timeout</span></a></span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt; AgentConfig
</span><a href="IC.Test.Agent.html#agentConfig"><span class="hs-identifier hs-var">agentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Polling timed out&quot;</span></span><span>
</span><span id="line-676"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; IO (HTTPErrOr a)
</span><a href="#local-6989586621679409904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679409903"><span class="hs-identifier hs-var">init</span></a></span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span class="annot"><a href="IC.Test.Agent.html#awaitStatus%27"><span class="hs-identifier hs-type">awaitStatus'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-type">ReqStatus</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span id="awaitStatus%27"><span class="annot"><span class="annottext">awaitStatus' :: HasAgentConfig =&gt;
IO (HTTPErrOr ReqStatus) -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#awaitStatus%27"><span class="hs-identifier hs-var hs-var">awaitStatus'</span></a></span></span><span> </span><span id="local-6989586621679409888"><span class="annot"><span class="annottext">IO (HTTPErrOr ReqStatus)
</span><a href="#local-6989586621679409888"><span class="hs-identifier hs-var">get_status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(HasCallStack, HasAgentConfig) =&gt;
IO (HTTPErrOr (Maybe a)) -&gt; IO (HTTPErrOr a)
</span><a href="IC.Test.Agent.html#loop%27"><span class="hs-identifier hs-var">loop'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="IC.Test.Agent.html#pollDelay"><span class="hs-identifier hs-var">pollDelay</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IO (HTTPErrOr ReqStatus)
</span><a href="#local-6989586621679409888"><span class="hs-identifier hs-var">get_status</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-680"></span><span>  </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679409886"><span class="annot"><span class="annottext">(Int, [Char])
</span><a href="#local-6989586621679409886"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, [Char])
</span><a href="#local-6989586621679409886"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-681"></span><span>  </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#Responded"><span class="hs-identifier hs-type">Responded</span></a></span><span> </span><span id="local-6989586621679409885"><span class="annot"><span class="annottext">ReqResponse
</span><a href="#local-6989586621679409885"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ReqResponse
</span><a href="#local-6989586621679409885"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-682"></span><span>  </span><span class="annot"><span class="annottext">HTTPErrOr ReqStatus
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span class="annot"><a href="IC.Test.Agent.html#awaitStatus"><span class="hs-identifier hs-type">awaitStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-type">ReqStatus</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span>
</span><span id="line-685"></span><span id="awaitStatus"><span class="annot"><span class="annottext">awaitStatus :: HasAgentConfig =&gt; IO (HTTPErrOr ReqStatus) -&gt; IO ReqResponse
</span><a href="IC.Test.Agent.html#awaitStatus"><span class="hs-identifier hs-var hs-var">awaitStatus</span></a></span></span><span> </span><span id="local-6989586621679409879"><span class="annot"><span class="annottext">IO (HTTPErrOr ReqStatus)
</span><a href="#local-6989586621679409879"><span class="hs-identifier hs-var">get_status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt;
IO (HTTPErrOr ReqStatus) -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#awaitStatus%27"><span class="hs-identifier hs-var">awaitStatus'</span></a></span><span> </span><span class="annot"><span class="annottext">IO (HTTPErrOr ReqStatus)
</span><a href="#local-6989586621679409879"><span class="hs-identifier hs-var">get_status</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; HTTPErrOr a -&gt; IO a
</span><a href="IC.Test.Agent.html#is2xx"><span class="hs-identifier hs-var">is2xx</span></a></span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span class="hs-comment">-- Polls until status is not Unknown any more, and returns that status</span><span>
</span><span id="line-688"></span><span class="hs-comment">-- even if Pending or Processing</span><span>
</span><span id="line-689"></span><span class="annot"><a href="IC.Test.Agent.html#awaitKnown%27"><span class="hs-identifier hs-type">awaitKnown'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-type">ReqStatus</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-type">ReqStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span id="awaitKnown%27"><span class="annot"><span class="annottext">awaitKnown' :: HasAgentConfig =&gt;
IO (HTTPErrOr ReqStatus) -&gt; IO (HTTPErrOr ReqStatus)
</span><a href="IC.Test.Agent.html#awaitKnown%27"><span class="hs-identifier hs-var hs-var">awaitKnown'</span></a></span></span><span> </span><span id="local-6989586621679409868"><span class="annot"><span class="annottext">IO (HTTPErrOr ReqStatus)
</span><a href="#local-6989586621679409868"><span class="hs-identifier hs-var">get_status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(HasCallStack, HasAgentConfig) =&gt;
IO (HTTPErrOr (Maybe a)) -&gt; IO (HTTPErrOr a)
</span><a href="IC.Test.Agent.html#loop%27"><span class="hs-identifier hs-var">loop'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="IC.Test.Agent.html#pollDelay"><span class="hs-identifier hs-var">pollDelay</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IO (HTTPErrOr ReqStatus)
</span><a href="#local-6989586621679409868"><span class="hs-identifier hs-var">get_status</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-691"></span><span>  </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679409867"><span class="annot"><span class="annottext">(Int, [Char])
</span><a href="#local-6989586621679409867"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, [Char])
</span><a href="#local-6989586621679409867"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-692"></span><span>  </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ReqStatus
</span><a href="IC.Test.Agent.html#UnknownStatus"><span class="hs-identifier hs-var">UnknownStatus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-693"></span><span>  </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679409866"><span class="annot"><span class="annottext">ReqStatus
</span><a href="#local-6989586621679409866"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ReqStatus
</span><a href="#local-6989586621679409866"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span class="annot"><a href="IC.Test.Agent.html#awaitKnown"><span class="hs-identifier hs-type">awaitKnown</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-type">ReqStatus</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-type">ReqStatus</span></a></span><span>
</span><span id="line-696"></span><span id="awaitKnown"><span class="annot"><span class="annottext">awaitKnown :: HasAgentConfig =&gt; IO (HTTPErrOr ReqStatus) -&gt; IO ReqStatus
</span><a href="IC.Test.Agent.html#awaitKnown"><span class="hs-identifier hs-var hs-var">awaitKnown</span></a></span></span><span> </span><span id="local-6989586621679409860"><span class="annot"><span class="annottext">IO (HTTPErrOr ReqStatus)
</span><a href="#local-6989586621679409860"><span class="hs-identifier hs-var">get_status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt;
IO (HTTPErrOr ReqStatus) -&gt; IO (HTTPErrOr ReqStatus)
</span><a href="IC.Test.Agent.html#awaitKnown%27"><span class="hs-identifier hs-var">awaitKnown'</span></a></span><span> </span><span class="annot"><span class="annottext">IO (HTTPErrOr ReqStatus)
</span><a href="#local-6989586621679409860"><span class="hs-identifier hs-var">get_status</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; HTTPErrOr a -&gt; IO a
</span><a href="IC.Test.Agent.html#is2xx"><span class="hs-identifier hs-var">is2xx</span></a></span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span class="annot"><a href="IC.Test.Agent.html#isPendingOrProcessing"><span class="hs-identifier hs-type">isPendingOrProcessing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqStatus"><span class="hs-identifier hs-type">ReqStatus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span id="isPendingOrProcessing"><span class="annot"><span class="annottext">isPendingOrProcessing :: ReqStatus -&gt; IO ()
</span><a href="IC.Test.Agent.html#isPendingOrProcessing"><span class="hs-identifier hs-var hs-var">isPendingOrProcessing</span></a></span></span><span> </span><span class="annot"><span class="annottext">ReqStatus
</span><a href="IC.Test.Agent.html#Pending"><span class="hs-identifier hs-var">Pending</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span class="annot"><a href="IC.Test.Agent.html#isPendingOrProcessing"><span class="hs-identifier hs-var">isPendingOrProcessing</span></a></span><span> </span><span class="annot"><span class="annottext">ReqStatus
</span><a href="IC.Test.Agent.html#Processing"><span class="hs-identifier hs-var">Processing</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span class="annot"><a href="IC.Test.Agent.html#isPendingOrProcessing"><span class="hs-identifier hs-var">isPendingOrProcessing</span></a></span><span> </span><span id="local-6989586621679409859"><span class="annot"><span class="annottext">ReqStatus
</span><a href="#local-6989586621679409859"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected pending or processing, got &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">ReqStatus
</span><a href="#local-6989586621679409859"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span class="annot"><a href="IC.Test.Agent.html#pollDelay"><span class="hs-identifier hs-type">pollDelay</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-704"></span><span id="pollDelay"><span class="annot"><span class="annottext">pollDelay :: IO ()
</span><a href="IC.Test.Agent.html#pollDelay"><span class="hs-identifier hs-var hs-var">pollDelay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Conc.IO.html#threadDelay"><span class="hs-identifier hs-var">threadDelay</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span> </span><span class="hs-comment">-- 10 milliseonds</span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span class="hs-comment">-- How long to wait before checking if a request that should _not_ show up on</span><span>
</span><span id="line-707"></span><span class="hs-comment">-- the system indeed did not show up</span><span>
</span><span id="line-708"></span><span class="annot"><a href="IC.Test.Agent.html#ingressDelay"><span class="hs-identifier hs-type">ingressDelay</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span id="ingressDelay"><span class="annot"><span class="annottext">ingressDelay :: IO ()
</span><a href="IC.Test.Agent.html#ingressDelay"><span class="hs-identifier hs-var hs-var">ingressDelay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Conc.IO.html#threadDelay"><span class="hs-identifier hs-var">threadDelay</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span> </span><span class="hs-comment">-- 2 seconds</span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span class="hs-comment">-- * HTTP Response predicates</span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span class="annot"><a href="IC.Test.Agent.html#codePred"><span class="hs-identifier hs-type">codePred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span id="codePred"><span class="annot"><span class="annottext">codePred :: HasCallStack =&gt; [Char] -&gt; (Int -&gt; Bool) -&gt; Response Blob -&gt; IO ()
</span><a href="IC.Test.Agent.html#codePred"><span class="hs-identifier hs-var hs-var">codePred</span></a></span></span><span> </span><span id="local-6989586621679409849"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409849"><span class="hs-identifier hs-var">expt</span></a></span></span><span> </span><span id="local-6989586621679409848"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679409848"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621679409847"><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679409847"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; [Char] -&gt; Bool -&gt; IO ()
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertBool"><span class="hs-identifier hs-var">assertBool</span></a></span><span>
</span><span id="line-716"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Status &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409845"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; is not &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409849"><span class="hs-identifier hs-var">expt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409844"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679409848"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409845"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-719"></span><span>    </span><span id="local-6989586621679409845"><span class="annot"><span class="annottext">c :: Int
</span><a href="#local-6989586621679409845"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status -&gt; Int
</span><a href="file:///nix/store/lwjn4w0ddfm34a87vly061bh3il1hk19-http-types-0.12.3-doc/share/doc/http-types-0.12.3/html/src/Network.HTTP.Types.Status.html#statusCode"><span class="hs-identifier hs-var">statusCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall body. Response body -&gt; Status
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#responseStatus"><span class="hs-identifier hs-var">responseStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679409847"><span class="hs-identifier hs-var">response</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>    </span><span id="local-6989586621679409844"><span class="annot"><span class="annottext">msg :: [Char]
</span><a href="#local-6989586621679409844"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OnDecodeError -&gt; ByteString -&gt; Text
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Encoding.html#decodeUtf8With"><span class="hs-identifier hs-var">T.decodeUtf8With</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Encoding.Error.html#lenientDecode"><span class="hs-identifier hs-var">T.lenientDecode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blob -&gt; ByteString
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.Internal.html#toStrict"><span class="hs-identifier hs-var">BS.toStrict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Blob -&gt; Blob
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.html#take"><span class="hs-identifier hs-var">BS.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1000</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall body. Response body -&gt; body
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier hs-var">responseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679409847"><span class="hs-identifier hs-var">response</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-721"></span><span>
</span><span id="line-722"></span><span class="annot"><a href="IC.Test.Agent.html#code2xx"><span class="hs-identifier hs-type">code2xx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#code202"><span class="hs-identifier hs-type">code202</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#code4xx"><span class="hs-identifier hs-type">code4xx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#code202_or_4xx"><span class="hs-identifier hs-type">code202_or_4xx</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span id="code2xx"><span class="annot"><span class="annottext">code2xx :: HasCallStack =&gt; Response Blob -&gt; IO ()
</span><a href="IC.Test.Agent.html#code2xx"><span class="hs-identifier hs-var hs-var">code2xx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; [Char] -&gt; (Int -&gt; Bool) -&gt; Response Blob -&gt; IO ()
</span><a href="IC.Test.Agent.html#codePred"><span class="hs-identifier hs-var">codePred</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;2xx&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679409836"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409836"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">200</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409836"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409836"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">300</span></span><span>
</span><span id="line-724"></span><span id="code202"><span class="annot"><span class="annottext">code202 :: HasCallStack =&gt; Response Blob -&gt; IO ()
</span><a href="IC.Test.Agent.html#code202"><span class="hs-identifier hs-var hs-var">code202</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; [Char] -&gt; (Int -&gt; Bool) -&gt; Response Blob -&gt; IO ()
</span><a href="IC.Test.Agent.html#codePred"><span class="hs-identifier hs-var">codePred</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;202&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679409829"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409829"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409829"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">202</span></span><span>
</span><span id="line-725"></span><span id="code4xx"><span class="annot"><span class="annottext">code4xx :: HasCallStack =&gt; Response Blob -&gt; IO ()
</span><a href="IC.Test.Agent.html#code4xx"><span class="hs-identifier hs-var hs-var">code4xx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; [Char] -&gt; (Int -&gt; Bool) -&gt; Response Blob -&gt; IO ()
</span><a href="IC.Test.Agent.html#codePred"><span class="hs-identifier hs-var">codePred</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;4xx&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679409821"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409821"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">400</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409821"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409821"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">500</span></span><span>
</span><span id="line-726"></span><span id="code202_or_4xx"><span class="annot"><span class="annottext">code202_or_4xx :: HasCallStack =&gt; Response Blob -&gt; IO ()
</span><a href="IC.Test.Agent.html#code202_or_4xx"><span class="hs-identifier hs-var hs-var">code202_or_4xx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; [Char] -&gt; (Int -&gt; Bool) -&gt; Response Blob -&gt; IO ()
</span><a href="IC.Test.Agent.html#codePred"><span class="hs-identifier hs-var">codePred</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;202 or 4xx&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679409811"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409811"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409811"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">202</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">400</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409811"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409811"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">500</span></span><span>
</span><span id="line-727"></span><span>
</span><span id="line-728"></span><span class="hs-comment">-- * CBOR decoding</span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span class="annot"><a href="IC.Test.Agent.html#okCBOR"><span class="hs-identifier hs-type">okCBOR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span>
</span><span id="line-731"></span><span id="okCBOR"><span class="annot"><span class="annottext">okCBOR :: HasCallStack =&gt; Response Blob -&gt; IO GenR
</span><a href="IC.Test.Agent.html#okCBOR"><span class="hs-identifier hs-var hs-var">okCBOR</span></a></span></span><span> </span><span id="local-6989586621679409803"><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679409803"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-732"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; Response Blob -&gt; IO ()
</span><a href="IC.Test.Agent.html#code2xx"><span class="hs-identifier hs-var">code2xx</span></a></span><span> </span><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679409803"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-733"></span><span>  </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Either Text a -&gt; IO a
</span><a href="IC.Test.Agent.html#asRight"><span class="hs-identifier hs-var">asRight</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Either Text GenR
</span><a href="IC.HTTP.CBOR.html#decode"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall body. Response body -&gt; body
</span><a href="file:///nix/store/7493mqmiqnnab286b97l8f2ixvhgjna9-http-client-0.7.13.1-doc/share/doc/http-client-0.7.13.1/html/src/Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier hs-var">responseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Response Blob
</span><a href="#local-6989586621679409803"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span class="hs-comment">-- * Response predicates and parsers</span><span>
</span><span id="line-736"></span><span>
</span><span id="line-737"></span><span class="annot"><a href="IC.Test.Agent.html#callResponse"><span class="hs-identifier hs-type">callResponse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span>
</span><span id="line-738"></span><span id="callResponse"><span class="annot"><span class="annottext">callResponse :: GenR -&gt; IO ReqResponse
</span><a href="IC.Test.Agent.html#callResponse"><span class="hs-identifier hs-var hs-var">callResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; ExceptT Text IO a -&gt; IO a
</span><a href="IC.Test.Agent.html#asExceptT"><span class="hs-identifier hs-var">asExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
RecordM m a -&gt; GenR -&gt; m a
</span><a href="IC.HTTP.GenR.Parse.html#record"><span class="hs-identifier hs-var">record</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-739"></span><span>  </span><span id="local-6989586621679409802"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409802"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m a
</span><a href="IC.HTTP.GenR.Parse.html#field"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">Field Natural
</span><a href="IC.HTTP.GenR.Parse.html#nat"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;reject_code&quot;</span></span><span>
</span><span id="line-740"></span><span>  </span><span id="local-6989586621679409795"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409795"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m a
</span><a href="IC.HTTP.GenR.Parse.html#field"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">Field Text
</span><a href="IC.HTTP.GenR.Parse.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;reject_message&quot;</span></span><span>
</span><span id="line-741"></span><span>  </span><span id="local-6989586621679409788"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679409788"><span class="hs-identifier hs-var">error_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m (Maybe a)
</span><a href="IC.HTTP.GenR.Parse.html#optionalField"><span class="hs-identifier hs-var">optionalField</span></a></span><span> </span><span class="annot"><span class="annottext">Field Text
</span><a href="IC.HTTP.GenR.Parse.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;error_code&quot;</span></span><span>
</span><span id="line-742"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Text -&gt; Maybe Text -&gt; ReqResponse
</span><a href="IC.Test.Agent.html#Reject"><span class="hs-identifier hs-var">Reject</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409802"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409795"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679409788"><span class="hs-identifier hs-var">error_code</span></a></span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span class="annot"><a href="IC.Test.Agent.html#queryResponse"><span class="hs-identifier hs-type">queryResponse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span>
</span><span id="line-745"></span><span id="queryResponse"><span class="annot"><span class="annottext">queryResponse :: GenR -&gt; IO ReqResponse
</span><a href="IC.Test.Agent.html#queryResponse"><span class="hs-identifier hs-var hs-var">queryResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; ExceptT Text IO a -&gt; IO a
</span><a href="IC.Test.Agent.html#asExceptT"><span class="hs-identifier hs-var">asExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
RecordM m a -&gt; GenR -&gt; m a
</span><a href="IC.HTTP.GenR.Parse.html#record"><span class="hs-identifier hs-var">record</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-746"></span><span>    </span><span id="local-6989586621679409781"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409781"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m a
</span><a href="IC.HTTP.GenR.Parse.html#field"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">Field Text
</span><a href="IC.HTTP.GenR.Parse.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;status&quot;</span></span><span>
</span><span id="line-747"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409781"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-748"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;replied&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-749"></span><span>        </span><span class="annot"><span class="annottext">Blob -&gt; ReqResponse
</span><a href="IC.Test.Agent.html#Reply"><span class="hs-identifier hs-var">Reply</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m a
</span><a href="IC.HTTP.GenR.Parse.html#field"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
RecordM m a -&gt; GenR -&gt; m a
</span><a href="IC.HTTP.GenR.Parse.html#record"><span class="hs-identifier hs-var">record</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m a
</span><a href="IC.HTTP.GenR.Parse.html#field"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">Field Blob
</span><a href="IC.HTTP.GenR.Parse.html#blob"><span class="hs-identifier hs-var">blob</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;arg&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;reply&quot;</span></span><span>
</span><span id="line-750"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;rejected&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-751"></span><span>        </span><span id="local-6989586621679409761"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409761"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m a
</span><a href="IC.HTTP.GenR.Parse.html#field"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">Field Natural
</span><a href="IC.HTTP.GenR.Parse.html#nat"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;reject_code&quot;</span></span><span>
</span><span id="line-752"></span><span>        </span><span id="local-6989586621679409755"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409755"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m a
</span><a href="IC.HTTP.GenR.Parse.html#field"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">Field Text
</span><a href="IC.HTTP.GenR.Parse.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;reject_message&quot;</span></span><span>
</span><span id="line-753"></span><span>        </span><span id="local-6989586621679409749"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679409749"><span class="hs-identifier hs-var">error_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m (Maybe a)
</span><a href="IC.HTTP.GenR.Parse.html#optionalField"><span class="hs-identifier hs-var">optionalField</span></a></span><span> </span><span class="annot"><span class="annottext">Field Text
</span><a href="IC.HTTP.GenR.Parse.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;error_code&quot;</span></span><span>
</span><span id="line-754"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Text -&gt; Maybe Text -&gt; ReqResponse
</span><a href="IC.Test.Agent.html#Reject"><span class="hs-identifier hs-var">Reject</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409761"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409755"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679409749"><span class="hs-identifier hs-var">error_code</span></a></span><span>
</span><span id="line-755"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/transformers-0.5.6.2/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Unexpected status &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409781"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span class="annot"><a href="IC.Test.Agent.html#isReject"><span class="hs-identifier hs-type">isReject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-bignum-1.2/src/GHC.Num.Natural.html#Natural"><span class="hs-identifier hs-type">Natural</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span id="isReject"><span class="annot"><span class="annottext">isReject :: HasCallStack =&gt; [Natural] -&gt; ReqResponse -&gt; IO ()
</span><a href="IC.Test.Agent.html#isReject"><span class="hs-identifier hs-var hs-var">isReject</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#Reply"><span class="hs-identifier hs-type">Reply</span></a></span><span> </span><span id="local-6989586621679409727"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409727"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-759"></span><span>  </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected reject, got reply:&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#prettyBlob"><span class="hs-identifier hs-var">prettyBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409727"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-760"></span><span class="annot"><a href="IC.Test.Agent.html#isReject"><span class="hs-identifier hs-var">isReject</span></a></span><span> </span><span id="local-6989586621679409726"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679409726"><span class="hs-identifier hs-var">codes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#Reject"><span class="hs-identifier hs-type">Reject</span></a></span><span> </span><span id="local-6989586621679409725"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409725"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679409724"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409724"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-761"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; [Char] -&gt; Bool -&gt; IO ()
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertBool"><span class="hs-identifier hs-var">assertBool</span></a></span><span>
</span><span id="line-762"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Reject code &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409725"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; not in &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679409726"><span class="hs-identifier hs-var">codes</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409724"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409725"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679409726"><span class="hs-identifier hs-var">codes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span id="local-6989586621679411269"><span class="annot"><a href="IC.Test.Agent.html#isErr4xx"><span class="hs-identifier hs-type">isErr4xx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411269"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-766"></span><span id="isErr4xx"><span class="annot"><span class="annottext">isErr4xx :: forall a. HasCallStack =&gt; HTTPErrOr a -&gt; IO ()
</span><a href="IC.Test.Agent.html#isErr4xx"><span class="hs-identifier hs-var hs-var">isErr4xx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679409709"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409709"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679409708"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409708"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-767"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">400</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409709"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409709"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">500</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-769"></span><span>        </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Status &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409709"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; is not 4xx:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409708"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-770"></span><span class="annot"><a href="IC.Test.Agent.html#isErr4xx"><span class="hs-identifier hs-var">isErr4xx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Got HTTP response, expected HTTP error&quot;</span></span><span>
</span><span id="line-771"></span><span>
</span><span id="line-772"></span><span class="annot"><a href="IC.Test.Agent.html#isErrOrReject"><span class="hs-identifier hs-type">isErrOrReject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-bignum-1.2/src/GHC.Num.Natural.html#Natural"><span class="hs-identifier hs-type">Natural</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span id="isErrOrReject"><span class="annot"><span class="annottext">isErrOrReject :: HasCallStack =&gt; [Natural] -&gt; HTTPErrOr ReqResponse -&gt; IO ()
</span><a href="IC.Test.Agent.html#isErrOrReject"><span class="hs-identifier hs-var hs-var">isErrOrReject</span></a></span></span><span> </span><span id="local-6989586621679409692"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679409692"><span class="hs-identifier hs-var">_codes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679409691"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409691"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679409690"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409690"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-774"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">400</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409691"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409691"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">600</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-776"></span><span>        </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Status &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409691"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; is not 4xx or 5xx:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409690"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-777"></span><span class="annot"><a href="IC.Test.Agent.html#isErrOrReject"><span class="hs-identifier hs-var">isErrOrReject</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ReqResponse
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Got HTTP response, expected HTTP error&quot;</span></span><span>
</span><span id="line-778"></span><span class="annot"><a href="IC.Test.Agent.html#isErrOrReject"><span class="hs-identifier hs-var">isErrOrReject</span></a></span><span> </span><span id="local-6989586621679409689"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679409689"><span class="hs-identifier hs-var">codes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679409688"><span class="annot"><span class="annottext">ReqResponse
</span><a href="#local-6989586621679409688"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; [Natural] -&gt; ReqResponse -&gt; IO ()
</span><a href="IC.Test.Agent.html#isReject"><span class="hs-identifier hs-var">isReject</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679409689"><span class="hs-identifier hs-var">codes</span></a></span><span> </span><span class="annot"><span class="annottext">ReqResponse
</span><a href="#local-6989586621679409688"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span class="annot"><a href="IC.Test.Agent.html#isNoErrReject"><span class="hs-identifier hs-type">isNoErrReject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-bignum-1.2/src/GHC.Num.Natural.html#Natural"><span class="hs-identifier hs-type">Natural</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-781"></span><span id="isNoErrReject"><span class="annot"><span class="annottext">isNoErrReject :: HasCallStack =&gt; [Natural] -&gt; HTTPErrOr ReqResponse -&gt; IO ()
</span><a href="IC.Test.Agent.html#isNoErrReject"><span class="hs-identifier hs-var hs-var">isNoErrReject</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679409669"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409669"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679409668"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409668"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected reject, got HTTP status &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409669"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409668"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-782"></span><span class="annot"><a href="IC.Test.Agent.html#isNoErrReject"><span class="hs-identifier hs-var">isNoErrReject</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#Reply"><span class="hs-identifier hs-type">Reply</span></a></span><span> </span><span id="local-6989586621679409667"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409667"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-783"></span><span>  </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected reject, got reply:&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#prettyBlob"><span class="hs-identifier hs-var">prettyBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409667"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-784"></span><span class="annot"><a href="IC.Test.Agent.html#isNoErrReject"><span class="hs-identifier hs-var">isNoErrReject</span></a></span><span> </span><span id="local-6989586621679409666"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679409666"><span class="hs-identifier hs-var">codes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#Reject"><span class="hs-identifier hs-type">Reject</span></a></span><span> </span><span id="local-6989586621679409665"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409665"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679409664"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409664"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-785"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; [Char] -&gt; Bool -&gt; IO ()
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertBool"><span class="hs-identifier hs-var">assertBool</span></a></span><span>
</span><span id="line-786"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Reject code &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409665"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; not in &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679409666"><span class="hs-identifier hs-var">codes</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409664"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-787"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409665"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679409666"><span class="hs-identifier hs-var">codes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span class="annot"><a href="IC.Test.Agent.html#isReply"><span class="hs-identifier hs-type">isReply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-790"></span><span id="isReply"><span class="annot"><span class="annottext">isReply :: HasCallStack =&gt; ReqResponse -&gt; IO Blob
</span><a href="IC.Test.Agent.html#isReply"><span class="hs-identifier hs-var hs-var">isReply</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#Reply"><span class="hs-identifier hs-type">Reply</span></a></span><span> </span><span id="local-6989586621679409655"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409655"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409655"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-791"></span><span class="annot"><a href="IC.Test.Agent.html#isReply"><span class="hs-identifier hs-var">isReply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#Reject"><span class="hs-identifier hs-type">Reject</span></a></span><span> </span><span id="local-6989586621679409654"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409654"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679409653"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409653"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679409652"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679409652"><span class="hs-identifier hs-var">error_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-792"></span><span>  </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Unexpected reject (code &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679409654"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="#local-6989586621679409650"><span class="hs-identifier hs-var">showErrCode</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679409652"><span class="hs-identifier hs-var">error_code</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;): &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409653"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679409650"><span class="annot"><span class="annottext">showErrCode :: Text -&gt; [Char]
</span><a href="#local-6989586621679409650"><span class="hs-identifier hs-var hs-var">showErrCode</span></a></span></span><span> </span><span id="local-6989586621679409647"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409647"><span class="hs-identifier hs-var">ec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;, error_code: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409647"><span class="hs-identifier hs-var">ec</span></a></span><span>
</span><span id="line-794"></span><span>
</span><span id="line-795"></span><span class="hs-comment">-- Convenience decoders</span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span class="annot"><a href="IC.Test.Agent.html#asWord32"><span class="hs-identifier hs-type">asWord32</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Word.html#Word32"><span class="hs-identifier hs-type">Word32</span></a></span><span>
</span><span id="line-798"></span><span id="asWord32"><span class="annot"><span class="annottext">asWord32 :: HasCallStack =&gt; Blob -&gt; IO Word32
</span><a href="IC.Test.Agent.html#asWord32"><span class="hs-identifier hs-var hs-var">asWord32</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Get a -&gt; Blob -&gt; IO a
</span><a href="IC.Test.Agent.html#runGet"><span class="hs-identifier hs-var">runGet</span></a></span><span> </span><span class="annot"><span class="annottext">Get Word32
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.html#getWord32le"><span class="hs-identifier hs-var">Get.getWord32le</span></a></span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span class="annot"><a href="IC.Test.Agent.html#asWord64"><span class="hs-identifier hs-type">asWord64</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span>
</span><span id="line-801"></span><span id="asWord64"><span class="annot"><span class="annottext">asWord64 :: HasCallStack =&gt; Blob -&gt; IO Word64
</span><a href="IC.Test.Agent.html#asWord64"><span class="hs-identifier hs-var hs-var">asWord64</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Get a -&gt; Blob -&gt; IO a
</span><a href="IC.Test.Agent.html#runGet"><span class="hs-identifier hs-var">runGet</span></a></span><span> </span><span class="annot"><span class="annottext">Get Word64
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.html#getWord64le"><span class="hs-identifier hs-var">Get.getWord64le</span></a></span><span>
</span><span id="line-802"></span><span>
</span><span id="line-803"></span><span class="annot"><a href="IC.Test.Agent.html#as2Word64"><span class="hs-identifier hs-type">as2Word64</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-804"></span><span id="as2Word64"><span class="annot"><span class="annottext">as2Word64 :: HasCallStack =&gt; Blob -&gt; IO (Word64, Word64)
</span><a href="IC.Test.Agent.html#as2Word64"><span class="hs-identifier hs-var hs-var">as2Word64</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Get a -&gt; Blob -&gt; IO a
</span><a href="IC.Test.Agent.html#runGet"><span class="hs-identifier hs-var">runGet</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Get Word64
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.html#getWord64le"><span class="hs-identifier hs-var">Get.getWord64le</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Get Word64
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.html#getWord64le"><span class="hs-identifier hs-var">Get.getWord64le</span></a></span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span class="annot"><a href="IC.Test.Agent.html#asWord64Word128"><span class="hs-identifier hs-type">asWord64Word128</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/4mqfmg1nf403ql59iwhdjfrnszspljb5-wide-word-0.1.5.0-doc/share/doc/wide-word-0.1.5.0/html/src/Data.WideWord.Word128.html#Word128"><span class="hs-identifier hs-type">Word128</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span id="asWord64Word128"><span class="annot"><span class="annottext">asWord64Word128 :: HasCallStack =&gt; Blob -&gt; IO (Word64, Word128)
</span><a href="IC.Test.Agent.html#asWord64Word128"><span class="hs-identifier hs-var hs-var">asWord64Word128</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Get a -&gt; Blob -&gt; IO a
</span><a href="IC.Test.Agent.html#runGet"><span class="hs-identifier hs-var">runGet</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-808"></span><span>    </span><span id="local-6989586621679409623"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679409623"><span class="hs-identifier hs-var">word64</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Get Word64
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.html#getWord64le"><span class="hs-identifier hs-var">Get.getWord64le</span></a></span><span>
</span><span id="line-809"></span><span>    </span><span id="local-6989586621679409622"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679409622"><span class="hs-identifier hs-var">low</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Get Word64
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.html#getWord64le"><span class="hs-identifier hs-var">Get.getWord64le</span></a></span><span>
</span><span id="line-810"></span><span>    </span><span id="local-6989586621679409621"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679409621"><span class="hs-identifier hs-var">high</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Get Word64
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.html#getWord64le"><span class="hs-identifier hs-var">Get.getWord64le</span></a></span><span>
</span><span id="line-811"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679409623"><span class="hs-identifier hs-var">word64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word128
</span><a href="file:///nix/store/4mqfmg1nf403ql59iwhdjfrnszspljb5-wide-word-0.1.5.0-doc/share/doc/wide-word-0.1.5.0/html/src/Data.WideWord.Word128.html#Word128"><span class="hs-identifier hs-var">Word128</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679409621"><span class="hs-identifier hs-var">high</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679409622"><span class="hs-identifier hs-var">low</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span class="annot"><a href="IC.Test.Agent.html#asWord128"><span class="hs-identifier hs-type">asWord128</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/4mqfmg1nf403ql59iwhdjfrnszspljb5-wide-word-0.1.5.0-doc/share/doc/wide-word-0.1.5.0/html/src/Data.WideWord.Word128.html#Word128"><span class="hs-identifier hs-type">Word128</span></a></span><span>
</span><span id="line-814"></span><span id="asWord128"><span class="annot"><span class="annottext">asWord128 :: HasCallStack =&gt; Blob -&gt; IO Word128
</span><a href="IC.Test.Agent.html#asWord128"><span class="hs-identifier hs-var hs-var">asWord128</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Get a -&gt; Blob -&gt; IO a
</span><a href="IC.Test.Agent.html#runGet"><span class="hs-identifier hs-var">runGet</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-815"></span><span>    </span><span id="local-6989586621679409613"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679409613"><span class="hs-identifier hs-var">low</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Get Word64
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.html#getWord64le"><span class="hs-identifier hs-var">Get.getWord64le</span></a></span><span>
</span><span id="line-816"></span><span>    </span><span id="local-6989586621679409612"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679409612"><span class="hs-identifier hs-var">high</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Get Word64
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.html#getWord64le"><span class="hs-identifier hs-var">Get.getWord64le</span></a></span><span>
</span><span id="line-817"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word128
</span><a href="file:///nix/store/4mqfmg1nf403ql59iwhdjfrnszspljb5-wide-word-0.1.5.0-doc/share/doc/wide-word-0.1.5.0/html/src/Data.WideWord.Word128.html#Word128"><span class="hs-identifier hs-var">Word128</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679409612"><span class="hs-identifier hs-var">high</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679409613"><span class="hs-identifier hs-var">low</span></a></span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span id="local-6989586621679411259"><span class="annot"><a href="IC.Test.Agent.html#bothSame"><span class="hs-identifier hs-type">bothSame</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411259"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411259"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679411259"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679411259"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#Assertion"><span class="hs-identifier hs-type">Assertion</span></a></span></span><span>
</span><span id="line-820"></span><span id="bothSame"><span class="annot"><span class="annottext">bothSame :: forall a. (Eq a, Show a) =&gt; (a, a) -&gt; IO ()
</span><a href="IC.Test.Agent.html#bothSame"><span class="hs-identifier hs-var hs-var">bothSame</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679409605"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409605"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679409604"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409604"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409605"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (Eq a, Show a, HasCallStack) =&gt; a -&gt; a -&gt; IO ()
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#%40%3F%3D"><span class="hs-operator hs-var">@?=</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409604"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-821"></span><span>
</span><span id="line-822"></span><span id="local-6989586621679411265"><span class="annot"><a href="IC.Test.Agent.html#runGet"><span class="hs-identifier hs-type">runGet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.Internal.html#Get"><span class="hs-identifier hs-type">Get.Get</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411265"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411265"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-823"></span><span id="runGet"><span class="annot"><span class="annottext">runGet :: forall a. HasCallStack =&gt; Get a -&gt; Blob -&gt; IO a
</span><a href="IC.Test.Agent.html#runGet"><span class="hs-identifier hs-var hs-var">runGet</span></a></span></span><span> </span><span id="local-6989586621679409595"><span class="annot"><span class="annottext">Get a
</span><a href="#local-6989586621679409595"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679409594"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409594"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span>  </span><span class="annot"><span class="annottext">forall a.
Get a -&gt; Blob -&gt; Either (Blob, Int64, [Char]) (Blob, Int64, a)
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.html#runGetOrFail"><span class="hs-identifier hs-var">Get.runGetOrFail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Get a
</span><a href="#local-6989586621679409595"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3C%2A"><span class="hs-operator hs-var">&lt;*</span></a></span><span> </span><span class="annot"><span class="annottext">Get ()
</span><a href="#local-6989586621679409591"><span class="hs-identifier hs-var">done</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409594"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-824"></span><span>    </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int64
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679409590"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409590"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-825"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Control.Monad.Fail.html#fail"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Could not parse &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409594"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409590"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-826"></span><span>    </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blob
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int64
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679409589"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409589"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409589"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-827"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-828"></span><span>    </span><span id="local-6989586621679409591"><span class="annot"><span class="annottext">done :: Get ()
</span><a href="#local-6989586621679409591"><span class="hs-identifier hs-var hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-829"></span><span>        </span><span id="local-6989586621679409584"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679409584"><span class="hs-identifier hs-var">nothing_left</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Get Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.Internal.html#isEmpty"><span class="hs-identifier hs-var">Get.isEmpty</span></a></span><span>
</span><span id="line-830"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679409584"><span class="hs-identifier hs-var">nothing_left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Control.Monad.Fail.html#fail"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;left-over bytes&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-831"></span><span>
</span><span id="line-832"></span><span class="hs-comment">-- * Status endpoint parsing</span><span>
</span><span id="line-833"></span><span>
</span><span id="line-834"></span><span class="hs-keyword">data</span><span> </span><span id="StatusResponse"><span class="annot"><a href="IC.Test.Agent.html#StatusResponse"><span class="hs-identifier hs-var">StatusResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StatusResponse"><span class="annot"><a href="IC.Test.Agent.html#StatusResponse"><span class="hs-identifier hs-var">StatusResponse</span></a></span></span><span>
</span><span id="line-835"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="status_api_version"><span class="annot"><span class="annottext">StatusResponse -&gt; Text
</span><a href="IC.Test.Agent.html#status_api_version"><span class="hs-identifier hs-var hs-var">status_api_version</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">T.Text</span></a></span><span>
</span><span id="line-836"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="status_root_key"><span class="annot"><span class="annottext">StatusResponse -&gt; Blob
</span><a href="IC.Test.Agent.html#status_root_key"><span class="hs-identifier hs-var hs-var">status_root_key</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span>
</span><span id="line-837"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-838"></span><span>
</span><span id="line-839"></span><span class="annot"><a href="IC.Test.Agent.html#statusResonse"><span class="hs-identifier hs-type">statusResonse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.HTTP.GenR.html#GenR"><span class="hs-identifier hs-type">GenR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#StatusResponse"><span class="hs-identifier hs-type">StatusResponse</span></a></span><span>
</span><span id="line-840"></span><span id="statusResonse"><span class="annot"><span class="annottext">statusResonse :: HasCallStack =&gt; GenR -&gt; IO StatusResponse
</span><a href="IC.Test.Agent.html#statusResonse"><span class="hs-identifier hs-var hs-var">statusResonse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; ExceptT Text IO a -&gt; IO a
</span><a href="IC.Test.Agent.html#asExceptT"><span class="hs-identifier hs-var">asExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
RecordM m a -&gt; GenR -&gt; m a
</span><a href="IC.HTTP.GenR.Parse.html#record"><span class="hs-identifier hs-var">record</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-841"></span><span>    </span><span id="local-6989586621679409547"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409547"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m a
</span><a href="IC.HTTP.GenR.Parse.html#field"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">Field Text
</span><a href="IC.HTTP.GenR.Parse.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ic_api_version&quot;</span></span><span>
</span><span id="line-842"></span><span>    </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m (Maybe a)
</span><a href="IC.HTTP.GenR.Parse.html#optionalField"><span class="hs-identifier hs-var">optionalField</span></a></span><span> </span><span class="annot"><span class="annottext">Field Text
</span><a href="IC.HTTP.GenR.Parse.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;impl_source&quot;</span></span><span>
</span><span id="line-843"></span><span>    </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m (Maybe a)
</span><a href="IC.HTTP.GenR.Parse.html#optionalField"><span class="hs-identifier hs-var">optionalField</span></a></span><span> </span><span class="annot"><span class="annottext">Field Text
</span><a href="IC.HTTP.GenR.Parse.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;impl_version&quot;</span></span><span>
</span><span id="line-844"></span><span>    </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m (Maybe a)
</span><a href="IC.HTTP.GenR.Parse.html#optionalField"><span class="hs-identifier hs-var">optionalField</span></a></span><span> </span><span class="annot"><span class="annottext">Field Text
</span><a href="IC.HTTP.GenR.Parse.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;impl_revision&quot;</span></span><span>
</span><span id="line-845"></span><span>    </span><span id="local-6989586621679409526"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409526"><span class="hs-identifier hs-var">pk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, Parse m) =&gt;
Field a -&gt; Text -&gt; RecordM m a
</span><a href="IC.HTTP.GenR.Parse.html#field"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">Field Blob
</span><a href="IC.HTTP.GenR.Parse.html#blob"><span class="hs-identifier hs-var">blob</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;root_key&quot;</span></span><span>
</span><span id="line-846"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; RecordM m ()
</span><a href="IC.HTTP.GenR.Parse.html#swallowAllFields"><span class="hs-identifier hs-var">swallowAllFields</span></a></span><span> </span><span class="hs-comment">-- More fields are explicitly allowed</span><span>
</span><span id="line-847"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#StatusResponse"><span class="hs-identifier hs-type">StatusResponse</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">status_api_version :: Text
</span><a href="IC.Test.Agent.html#status_api_version"><span class="hs-identifier hs-var">status_api_version</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409547"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">status_root_key :: Blob
</span><a href="IC.Test.Agent.html#status_root_key"><span class="hs-identifier hs-var">status_root_key</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409526"><span class="hs-identifier hs-var">pk</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span class="hs-comment">-- * Interacting with aaaaa-aa (via HTTP)</span><span>
</span><span id="line-850"></span><span>
</span><span id="line-851"></span><span class="hs-comment">{-
The code below has some repetition. That&#8217;s because we have

 A) multiple ways of _calling_ the Management Canister
    (as default user, as specific user, via canister, with or without cycles),
 B) different things we want to know
    (just the Candid-decoded reply, or the response, or even the HTTP error)
 C) and then of course different methods (which affect response decoding)

So far, there is some duplication here because of that. Eventually, this should
be refactored so that the test can declarative pick A, B and C separately.
-}</span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span class="hs-comment">-- how to reach the management canister</span><span>
</span><span id="line-865"></span><span class="hs-keyword">type</span><span> </span><span id="IC00"><span class="annot"><a href="IC.Test.Agent.html#IC00"><span class="hs-identifier hs-var">IC00</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">T.Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span>
</span><span id="line-866"></span><span class="hs-keyword">type</span><span> </span><span id="IC00WithCycles"><span class="annot"><a href="IC.Test.Agent.html#IC00WithCycles"><span class="hs-identifier hs-var">IC00WithCycles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#IC00"><span class="hs-identifier hs-type">IC00</span></a></span><span>
</span><span id="line-867"></span><span class="hs-keyword">type</span><span> </span><span id="IC00%27"><span class="annot"><a href="IC.Test.Agent.html#IC00%27"><span class="hs-identifier hs-var">IC00'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">T.Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>
</span><span id="line-869"></span><span class="annot"><a href="IC.Test.Agent.html#ic00as"><span class="hs-identifier hs-type">ic00as</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#IC00"><span class="hs-identifier hs-type">IC00</span></a></span><span>
</span><span id="line-870"></span><span id="ic00as"><span class="annot"><span class="annottext">ic00as :: (HasAgentConfig, HasCallStack) =&gt; Blob -&gt; IC00
</span><a href="IC.Test.Agent.html#ic00as"><span class="hs-identifier hs-var hs-var">ic00as</span></a></span></span><span> </span><span id="local-6989586621679409507"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409507"><span class="hs-identifier hs-var">user</span></a></span></span><span> </span><span id="local-6989586621679409506"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409506"><span class="hs-identifier hs-var">ecid</span></a></span></span><span> </span><span id="local-6989586621679409505"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409505"><span class="hs-identifier hs-var">method_name</span></a></span></span><span> </span><span id="local-6989586621679409504"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409504"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt; Blob -&gt; GenR -&gt; IO ReqResponse
</span><a href="IC.Test.Agent.html#awaitCall"><span class="hs-identifier hs-var">awaitCall</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409506"><span class="hs-identifier hs-var">ecid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[HashMap Text GenR] -&gt; GenR
</span><a href="IC.HTTP.GenR.html#rec"><span class="hs-identifier hs-var">rec</span></a></span><span>
</span><span id="line-871"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;request_type&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GText"><span class="hs-identifier hs-var">GText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;call&quot;</span></span><span>
</span><span id="line-872"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sender&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409507"><span class="hs-identifier hs-var">user</span></a></span><span>
</span><span id="line-873"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;canister_id&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-874"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;method_name&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GText"><span class="hs-identifier hs-var">GText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409505"><span class="hs-identifier hs-var">method_name</span></a></span><span>
</span><span id="line-875"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409504"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-876"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span class="annot"><a href="IC.Test.Agent.html#ic00"><span class="hs-identifier hs-type">ic00</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#IC00"><span class="hs-identifier hs-type">IC00</span></a></span><span>
</span><span id="line-879"></span><span id="ic00"><span class="annot"><span class="annottext">ic00 :: HasAgentConfig =&gt; IC00
</span><a href="IC.Test.Agent.html#ic00"><span class="hs-identifier hs-var hs-var">ic00</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HasAgentConfig, HasCallStack) =&gt; Blob -&gt; IC00
</span><a href="IC.Test.Agent.html#ic00as"><span class="hs-identifier hs-var">ic00as</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="IC.Test.Agent.html#defaultUser"><span class="hs-identifier hs-var">defaultUser</span></a></span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span class="hs-comment">-- A variant that allows non-200 responses to submit</span><span>
</span><span id="line-882"></span><span class="annot"><a href="IC.Test.Agent.html#ic00WithSubnetas%27"><span class="hs-identifier hs-type">ic00WithSubnetas'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">T.Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span id="ic00WithSubnetas%27"><span class="annot"><span class="annottext">ic00WithSubnetas' :: HasAgentConfig =&gt;
Blob -&gt; Blob -&gt; Blob -&gt; Text -&gt; Blob -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#ic00WithSubnetas%27"><span class="hs-identifier hs-var hs-var">ic00WithSubnetas'</span></a></span></span><span> </span><span id="local-6989586621679409489"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409489"><span class="hs-identifier hs-var">subnet_id</span></a></span></span><span> </span><span id="local-6989586621679409488"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409488"><span class="hs-identifier hs-var">user</span></a></span></span><span> </span><span id="local-6989586621679409487"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409487"><span class="hs-identifier hs-var">ecid</span></a></span></span><span> </span><span id="local-6989586621679409486"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409486"><span class="hs-identifier hs-var">method_name</span></a></span></span><span> </span><span id="local-6989586621679409485"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409485"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, HasAgentConfig) =&gt;
Blob -&gt; GenR -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#awaitCall%27"><span class="hs-identifier hs-var">awaitCall'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409487"><span class="hs-identifier hs-var">ecid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[HashMap Text GenR] -&gt; GenR
</span><a href="IC.HTTP.GenR.html#rec"><span class="hs-identifier hs-var">rec</span></a></span><span>
</span><span id="line-884"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;request_type&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GText"><span class="hs-identifier hs-var">GText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;call&quot;</span></span><span>
</span><span id="line-885"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sender&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409488"><span class="hs-identifier hs-var">user</span></a></span><span>
</span><span id="line-886"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;canister_id&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409489"><span class="hs-identifier hs-var">subnet_id</span></a></span><span>
</span><span id="line-887"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;method_name&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GText"><span class="hs-identifier hs-var">GText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679409486"><span class="hs-identifier hs-var">method_name</span></a></span><span>
</span><span id="line-888"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Text -&gt; v -&gt; HashMap Text v
</span><a href="IC.HTTP.GenR.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; GenR
</span><a href="IC.HTTP.GenR.html#GBlob"><span class="hs-identifier hs-var">GBlob</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409485"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-889"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-890"></span><span>
</span><span id="line-891"></span><span class="annot"><a href="IC.Test.Agent.html#ic00as%27"><span class="hs-identifier hs-type">ic00as'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">T.Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-892"></span><span id="ic00as%27"><span class="annot"><span class="annottext">ic00as' :: HasAgentConfig =&gt;
Blob -&gt; Blob -&gt; Text -&gt; Blob -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#ic00as%27"><span class="hs-identifier hs-var hs-var">ic00as'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt;
Blob -&gt; Blob -&gt; Blob -&gt; Text -&gt; Blob -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#ic00WithSubnetas%27"><span class="hs-identifier hs-var">ic00WithSubnetas'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-893"></span><span>
</span><span id="line-894"></span><span class="annot"><a href="IC.Test.Agent.html#ic00%27"><span class="hs-identifier hs-type">ic00'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#IC00%27"><span class="hs-identifier hs-type">IC00'</span></a></span><span>
</span><span id="line-895"></span><span id="ic00%27"><span class="annot"><span class="annottext">ic00' :: HasAgentConfig =&gt;
Blob -&gt; Text -&gt; Blob -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#ic00%27"><span class="hs-identifier hs-var hs-var">ic00'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt;
Blob -&gt; Blob -&gt; Text -&gt; Blob -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#ic00as%27"><span class="hs-identifier hs-var">ic00as'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="IC.Test.Agent.html#defaultUser"><span class="hs-identifier hs-var">defaultUser</span></a></span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span class="hs-comment">-- Now wrapping the concrete calls</span><span>
</span><span id="line-898"></span><span class="hs-comment">-- (using Candid.toCandidService is tricky because of all stuff like passing through the effective canister id)</span><span>
</span><span id="line-899"></span><span class="hs-comment">--</span><span>
</span><span id="line-900"></span><span class="annot"><a href="IC.Test.Agent.html#callIC"><span class="hs-identifier hs-type">callIC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679411243"><span class="annot"><a href="#local-6989586621679411243"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679411242"><span class="annot"><a href="#local-6989586621679411242"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679411241"><span class="annot"><a href="#local-6989586621679411241"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-901"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-902"></span><span>  </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.TypeLits.html#KnownSymbol"><span class="hs-identifier hs-type">KnownSymbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411243"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-903"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679411242"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411241"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411243"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-904"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#CandidArg"><span class="hs-identifier hs-type">Candid.CandidArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411242"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#CandidArg"><span class="hs-identifier hs-type">Candid.CandidArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411241"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-905"></span><span>  </span><span class="annot"><a href="IC.Test.Agent.html#IC00"><span class="hs-identifier hs-type">IC00</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411243"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679411242"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411241"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-906"></span><span id="callIC"><span class="annot"><span class="annottext">callIC :: forall (s :: Symbol) a b.
(HasCallStack, HasAgentConfig, KnownSymbol s,
 (a -&gt; IO b) ~ (ICManagement IO .! s), CandidArg a, CandidArg b) =&gt;
IC00 -&gt; Blob -&gt; Label s -&gt; a -&gt; IO b
</span><a href="IC.Test.Agent.html#callIC"><span class="hs-identifier hs-var hs-var">callIC</span></a></span></span><span> </span><span id="local-6989586621679409461"><span class="annot"><span class="annottext">IC00
</span><a href="#local-6989586621679409461"><span class="hs-identifier hs-var">ic00</span></a></span></span><span> </span><span id="local-6989586621679409460"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409460"><span class="hs-identifier hs-var">ecid</span></a></span></span><span> </span><span id="local-6989586621679409459"><span class="annot"><span class="annottext">Label s
</span><a href="#local-6989586621679409459"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679409458"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409458"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-907"></span><span>    </span><span id="local-6989586621679409457"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409457"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IC00
</span><a href="#local-6989586621679409461"><span class="hs-identifier hs-var">ic00</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409460"><span class="hs-identifier hs-var">ecid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (n :: Symbol) (proxy :: Symbol -&gt; *).
KnownSymbol n =&gt;
proxy n -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.TypeLits.html#symbolVal"><span class="hs-identifier hs-var">symbolVal</span></a></span><span> </span><span class="annot"><span class="annottext">Label s
</span><a href="#local-6989586621679409459"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. CandidArg a =&gt; a -&gt; Blob
</span><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#encode"><span class="hs-identifier hs-var">Candid.encode</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409458"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; ReqResponse -&gt; IO Blob
</span><a href="IC.Test.Agent.html#isReply"><span class="hs-identifier hs-var">isReply</span></a></span><span>
</span><span id="line-908"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. CandidArg a =&gt; Blob -&gt; Either [Char] a
</span><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#decode"><span class="hs-identifier hs-var">Candid.decode</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409457"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-909"></span><span>        </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679409453"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409453"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; IO a
</span><a href="file:///nix/store/x8f35h2bgw8yxq58j3fhkgy1j7ipa21h-tasty-hunit-0.10.0.3-doc/share/doc/tasty-hunit-0.10.0.3/html/src/Test.Tasty.HUnit.Orig.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Candid decoding error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409453"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-910"></span><span>        </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679409452"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679409452"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679409452"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span class="hs-comment">-- Primed variants return the response (reply or reject)</span><span>
</span><span id="line-913"></span><span class="annot"><a href="IC.Test.Agent.html#callIC%27"><span class="hs-identifier hs-type">callIC'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679411229"><span class="annot"><a href="#local-6989586621679411229"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679411228"><span class="annot"><a href="#local-6989586621679411228"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679411227"><span class="annot"><a href="#local-6989586621679411227"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-914"></span><span>  </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-915"></span><span>  </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.TypeLits.html#KnownSymbol"><span class="hs-identifier hs-type">KnownSymbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411229"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-916"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679411228"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411227"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411229"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-917"></span><span>  </span><span class="annot"><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#CandidArg"><span class="hs-identifier hs-type">Candid.CandidArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411228"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-918"></span><span>  </span><span class="annot"><a href="IC.Test.Agent.html#IC00"><span class="hs-identifier hs-type">IC00</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411229"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679411228"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span>
</span><span id="line-919"></span><span id="callIC%27"><span class="annot"><span class="annottext">callIC' :: forall (s :: Symbol) a b.
(HasAgentConfig, KnownSymbol s,
 (a -&gt; IO b) ~ (ICManagement IO .! s), CandidArg a) =&gt;
IC00 -&gt; Blob -&gt; Label s -&gt; a -&gt; IO ReqResponse
</span><a href="IC.Test.Agent.html#callIC%27"><span class="hs-identifier hs-var hs-var">callIC'</span></a></span></span><span> </span><span id="local-6989586621679409445"><span class="annot"><span class="annottext">IC00
</span><a href="#local-6989586621679409445"><span class="hs-identifier hs-var">ic00</span></a></span></span><span> </span><span id="local-6989586621679409444"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409444"><span class="hs-identifier hs-var">ecid</span></a></span></span><span> </span><span id="local-6989586621679409443"><span class="annot"><span class="annottext">Label s
</span><a href="#local-6989586621679409443"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679409442"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409442"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IC00
</span><a href="#local-6989586621679409445"><span class="hs-identifier hs-var">ic00</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409444"><span class="hs-identifier hs-var">ecid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (n :: Symbol) (proxy :: Symbol -&gt; *).
KnownSymbol n =&gt;
proxy n -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.TypeLits.html#symbolVal"><span class="hs-identifier hs-var">symbolVal</span></a></span><span> </span><span class="annot"><span class="annottext">Label s
</span><a href="#local-6989586621679409443"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. CandidArg a =&gt; a -&gt; Blob
</span><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#encode"><span class="hs-identifier hs-var">Candid.encode</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409442"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-920"></span><span>
</span><span id="line-921"></span><span class="hs-comment">-- Double primed variants are only for requests from users (so they take the user,</span><span>
</span><span id="line-922"></span><span class="hs-comment">-- not a generic ic00 thing), and return the HTTP error code or the response</span><span>
</span><span id="line-923"></span><span class="hs-comment">-- (reply or reject)</span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span class="annot"><a href="IC.Test.Agent.html#callICWithSubnet%27%27"><span class="hs-identifier hs-type">callICWithSubnet''</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679411223"><span class="annot"><a href="#local-6989586621679411223"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679411222"><span class="annot"><a href="#local-6989586621679411222"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679411221"><span class="annot"><a href="#local-6989586621679411221"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-926"></span><span>  </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-927"></span><span>  </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.TypeLits.html#KnownSymbol"><span class="hs-identifier hs-type">KnownSymbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411223"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-928"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679411222"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411221"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411223"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-929"></span><span>  </span><span class="annot"><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#CandidArg"><span class="hs-identifier hs-type">Candid.CandidArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411222"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-930"></span><span>  </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411223"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679411222"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span id="callICWithSubnet%27%27"><span class="annot"><span class="annottext">callICWithSubnet'' :: forall (s :: Symbol) a b.
(HasAgentConfig, KnownSymbol s,
 (a -&gt; IO b) ~ (ICManagement IO .! s), CandidArg a) =&gt;
Blob -&gt; Blob -&gt; Blob -&gt; Label s -&gt; a -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#callICWithSubnet%27%27"><span class="hs-identifier hs-var hs-var">callICWithSubnet''</span></a></span></span><span> </span><span id="local-6989586621679409434"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409434"><span class="hs-identifier hs-var">subnet_id</span></a></span></span><span> </span><span id="local-6989586621679409433"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409433"><span class="hs-identifier hs-var">user</span></a></span></span><span> </span><span id="local-6989586621679409432"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409432"><span class="hs-identifier hs-var">ecid</span></a></span></span><span> </span><span id="local-6989586621679409431"><span class="annot"><span class="annottext">Label s
</span><a href="#local-6989586621679409431"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679409430"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409430"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasAgentConfig =&gt;
Blob -&gt; Blob -&gt; Blob -&gt; Text -&gt; Blob -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#ic00WithSubnetas%27"><span class="hs-identifier hs-var">ic00WithSubnetas'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409434"><span class="hs-identifier hs-var">subnet_id</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409433"><span class="hs-identifier hs-var">user</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409432"><span class="hs-identifier hs-var">ecid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (n :: Symbol) (proxy :: Symbol -&gt; *).
KnownSymbol n =&gt;
proxy n -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.TypeLits.html#symbolVal"><span class="hs-identifier hs-var">symbolVal</span></a></span><span> </span><span class="annot"><span class="annottext">Label s
</span><a href="#local-6989586621679409431"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. CandidArg a =&gt; a -&gt; Blob
</span><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#encode"><span class="hs-identifier hs-var">Candid.encode</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409430"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-932"></span><span>
</span><span id="line-933"></span><span class="annot"><a href="IC.Test.Agent.html#callIC%27%27"><span class="hs-identifier hs-type">callIC''</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679411217"><span class="annot"><a href="#local-6989586621679411217"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679411216"><span class="annot"><a href="#local-6989586621679411216"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679411215"><span class="annot"><a href="#local-6989586621679411215"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-934"></span><span>  </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-935"></span><span>  </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.TypeLits.html#KnownSymbol"><span class="hs-identifier hs-type">KnownSymbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411217"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-936"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679411216"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411215"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411217"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-937"></span><span>  </span><span class="annot"><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#CandidArg"><span class="hs-identifier hs-type">Candid.CandidArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411216"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-938"></span><span>  </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411217"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679411216"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-939"></span><span id="callIC%27%27"><span class="annot"><span class="annottext">callIC'' :: forall (s :: Symbol) a b.
(HasAgentConfig, KnownSymbol s,
 (a -&gt; IO b) ~ (ICManagement IO .! s), CandidArg a) =&gt;
Blob -&gt; Blob -&gt; Label s -&gt; a -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#callIC%27%27"><span class="hs-identifier hs-var hs-var">callIC''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (s :: Symbol) a b.
(HasAgentConfig, KnownSymbol s,
 (a -&gt; IO b) ~ (ICManagement IO .! s), CandidArg a) =&gt;
Blob -&gt; Blob -&gt; Blob -&gt; Label s -&gt; a -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#callICWithSubnet%27%27"><span class="hs-identifier hs-var">callICWithSubnet''</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span class="hs-comment">-- Triple primed variants return the response (reply or reject) and allow HTTP errors</span><span>
</span><span id="line-942"></span><span class="annot"><a href="IC.Test.Agent.html#callIC%27%27%27"><span class="hs-identifier hs-type">callIC'''</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679411200"><span class="annot"><a href="#local-6989586621679411200"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679411199"><span class="annot"><a href="#local-6989586621679411199"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679411198"><span class="annot"><a href="#local-6989586621679411198"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-943"></span><span>  </span><span class="annot"><a href="IC.Test.Agent.html#HasAgentConfig"><span class="hs-identifier hs-type">HasAgentConfig</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-944"></span><span>  </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.TypeLits.html#KnownSymbol"><span class="hs-identifier hs-type">KnownSymbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411200"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-945"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679411199"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411198"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411200"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-946"></span><span>  </span><span class="annot"><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#CandidArg"><span class="hs-identifier hs-type">Candid.CandidArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411199"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-947"></span><span>  </span><span class="annot"><a href="IC.Test.Agent.html#IC00%27"><span class="hs-identifier hs-type">IC00'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411200"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679411199"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Test.Agent.html#HTTPErrOr"><span class="hs-identifier hs-type">HTTPErrOr</span></a></span><span> </span><span class="annot"><a href="IC.Test.Agent.html#ReqResponse"><span class="hs-identifier hs-type">ReqResponse</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span id="callIC%27%27%27"><span class="annot"><span class="annottext">callIC''' :: forall (s :: Symbol) a b.
(HasAgentConfig, KnownSymbol s,
 (a -&gt; IO b) ~ (ICManagement IO .! s), CandidArg a) =&gt;
(Blob -&gt; Text -&gt; Blob -&gt; IO (HTTPErrOr ReqResponse))
-&gt; Blob -&gt; Label s -&gt; a -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="IC.Test.Agent.html#callIC%27%27%27"><span class="hs-identifier hs-var hs-var">callIC'''</span></a></span></span><span> </span><span id="local-6989586621679409410"><span class="annot"><span class="annottext">Blob -&gt; Text -&gt; Blob -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="#local-6989586621679409410"><span class="hs-identifier hs-var">ic00'</span></a></span></span><span> </span><span id="local-6989586621679409409"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409409"><span class="hs-identifier hs-var">ecid</span></a></span></span><span> </span><span id="local-6989586621679409408"><span class="annot"><span class="annottext">Label s
</span><a href="#local-6989586621679409408"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679409407"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409407"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Text -&gt; Blob -&gt; IO (HTTPErrOr ReqResponse)
</span><a href="#local-6989586621679409410"><span class="hs-identifier hs-var">ic00'</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409409"><span class="hs-identifier hs-var">ecid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (n :: Symbol) (proxy :: Symbol -&gt; *).
KnownSymbol n =&gt;
proxy n -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.TypeLits.html#symbolVal"><span class="hs-identifier hs-var">symbolVal</span></a></span><span> </span><span class="annot"><span class="annottext">Label s
</span><a href="#local-6989586621679409408"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. CandidArg a =&gt; a -&gt; Blob
</span><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#encode"><span class="hs-identifier hs-var">Candid.encode</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679409407"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-949"></span><span>
</span><span id="line-950"></span><span class="hs-comment">-- Convenience around Data.Row.Variants used as enums</span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span id="local-6989586621679411191"><span id="local-6989586621679411193"><span class="annot"><a href="IC.Test.Agent.html#enum"><span class="hs-identifier hs-type">enum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#AllUniqueLabels"><span class="hs-identifier hs-type">AllUniqueLabels</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411193"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.TypeLits.html#KnownSymbol"><span class="hs-identifier hs-type">KnownSymbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411191"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679411193"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411191"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411191"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Variants.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679411193"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-953"></span><span id="enum"><span class="annot"><span class="annottext">enum :: forall (r :: Row (*)) (l :: Symbol).
(AllUniqueLabels r, KnownSymbol l, (r .! l) ~ ()) =&gt;
Label l -&gt; Var r
</span><a href="IC.Test.Agent.html#enum"><span class="hs-identifier hs-var hs-var">enum</span></a></span></span><span> </span><span id="local-6989586621679409400"><span class="annot"><span class="annottext">Label l
</span><a href="#local-6989586621679409400"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (l :: Symbol) (r :: Row (*)).
(AllUniqueLabels r, KnownSymbol l) =&gt;
Label l -&gt; (r .! l) -&gt; Var r
</span><a href="file:///nix/store/nnzz8gzyw0qnn3bhw2mz58w4is6jbk20-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Variants.html#IsJust"><span class="hs-identifier hs-var">V.IsJust</span></a></span><span> </span><span class="annot"><span class="annottext">Label l
</span><a href="#local-6989586621679409400"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span class="hs-comment">-- Other utilities</span><span>
</span><span id="line-956"></span><span>
</span><span id="line-957"></span><span class="annot"><a href="IC.Test.Agent.html#asHex"><span class="hs-identifier hs-type">asHex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-958"></span><span id="asHex"><span class="annot"><span class="annottext">asHex :: Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#asHex"><span class="hs-identifier hs-var hs-var">asHex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="file:///nix/store/i7ini5k617kyy6apg2mvp4sspvaaqgb7-hex-text-0.1.0.8-doc/share/doc/hex-text-0.1.0.8/html/src/Text.Hex.html#encodeHex"><span class="hs-identifier hs-var">H.encodeHex</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; ByteString
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.Internal.html#toStrict"><span class="hs-identifier hs-var">BS.toStrict</span></a></span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span class="annot"><a href="IC.Test.Agent.html#textual"><span class="hs-identifier hs-type">textual</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-961"></span><span id="textual"><span class="annot"><span class="annottext">textual :: Blob -&gt; [Char]
</span><a href="IC.Test.Agent.html#textual"><span class="hs-identifier hs-var hs-var">textual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/text-1.2.5.0/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Principal -&gt; Text
</span><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Data.html#prettyPrincipal"><span class="hs-identifier hs-var">prettyPrincipal</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; Principal
</span><a href="file:///nix/store/jkxjsrg5143afynhvaz1h65p40k9xpg6-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Data.html#Principal"><span class="hs-identifier hs-var">Principal</span></a></span><span>
</span><span id="line-962"></span><span>
</span><span id="line-963"></span><span class="annot"><a href="IC.Test.Agent.html#shorten"><span class="hs-identifier hs-type">shorten</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-964"></span><span id="shorten"><span class="annot"><span class="annottext">shorten :: Int -&gt; ShowS
</span><a href="IC.Test.Agent.html#shorten"><span class="hs-identifier hs-var hs-var">shorten</span></a></span></span><span> </span><span id="local-6989586621679409396"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409396"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679409395"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409395"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409394"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409393"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;...&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-965"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679409394"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409394"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679409393"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409393"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.List.html#splitAt"><span class="hs-identifier hs-var">splitAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679409396"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679409395"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-966"></span><span>
</span><span id="line-967"></span><span class="annot"><a href="IC.Test.Agent.html#toHash256"><span class="hs-identifier hs-type">toHash256</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/rhiqcd24sdmvg84cxzww8z37wc9fw3bl-haskoin-core-0.21.2-doc/share/doc/haskoin-core-0.21.2/html/src/Haskoin.Crypto.Hash.html#Hash256"><span class="hs-identifier hs-type">Haskoin.Hash256</span></a></span><span>
</span><span id="line-968"></span><span id="toHash256"><span class="annot"><span class="annottext">toHash256 :: Blob -&gt; Hash256
</span><a href="IC.Test.Agent.html#toHash256"><span class="hs-identifier hs-var hs-var">toHash256</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Get a -&gt; Blob -&gt; a
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Get.html#runGet"><span class="hs-identifier hs-var">Get.runGet</span></a></span><span> </span><span class="annot"><span class="annottext">forall t. Binary t =&gt; Get t
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/binary-0.8.9.0/src/Data.Binary.Class.html#get"><span class="hs-identifier hs-var">Get.get</span></a></span><span>
</span><span id="line-969"></span><span>
</span><span id="line-970"></span><span class="annot"><a href="IC.Test.Agent.html#verifySignature"><span class="hs-identifier hs-type">verifySignature</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Id.Forms.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-971"></span><span id="verifySignature"><span class="annot"><span class="annottext">verifySignature :: Blob -&gt; Blob -&gt; Blob -&gt; Bool
</span><a href="IC.Test.Agent.html#verifySignature"><span class="hs-identifier hs-var hs-var">verifySignature</span></a></span></span><span> </span><span id="local-6989586621679409388"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409388"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679409387"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409387"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span id="local-6989586621679409386"><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409386"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash256 -&gt; Sig -&gt; PubKey -&gt; Bool
</span><a href="file:///nix/store/rhiqcd24sdmvg84cxzww8z37wc9fw3bl-haskoin-core-0.21.2-doc/share/doc/haskoin-core-0.21.2/html/src/Haskoin.Crypto.Signature.html#verifyHashSig"><span class="hs-identifier hs-var">Haskoin.verifyHashSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blob -&gt; Hash256
</span><a href="IC.Test.Agent.html#toHash256"><span class="hs-identifier hs-var">toHash256</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409388"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Sig
</span><a href="#local-6989586621679409384"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679409383"><span class="hs-identifier hs-var">pk</span></a></span><span>
</span><span id="line-972"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679409383"><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679409383"><span class="hs-identifier hs-var">pk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe PubKey
</span><a href="file:///nix/store/ygr8cxkpyicalz5861d11w6a6q6qjjv2-secp256k1-haskell-0.6.1-doc/share/doc/secp256k1-haskell-0.6.1/html/src/Crypto.Secp256k1.html#importPubKey"><span class="hs-identifier hs-var">Haskoin.importPubKey</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; ByteString
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.Internal.html#toStrict"><span class="hs-identifier hs-var">BS.toStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409386"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-973"></span><span>        </span><span class="annot"><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679409384"><span class="annot"><span class="annottext">Sig
</span><a href="#local-6989586621679409384"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Sig
</span><a href="file:///nix/store/rhiqcd24sdmvg84cxzww8z37wc9fw3bl-haskoin-core-0.21.2-doc/share/doc/haskoin-core-0.21.2/html/src/Haskoin.Crypto.Signature.html#decodeStrictSig"><span class="hs-identifier hs-var">Haskoin.decodeStrictSig</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Blob -&gt; ByteString
</span><a href="file:///nix/store/n4nbngkdp72aigvzs0xc8cy88z0ydbfv-ghc-9.2.8-doc/share/doc/ghc/html/libraries/bytestring-0.11.4.0/src/Data.ByteString.Lazy.Internal.html#toStrict"><span class="hs-identifier hs-var">BS.toStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Blob
</span><a href="#local-6989586621679409387"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-974"></span></pre></body></html>